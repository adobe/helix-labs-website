var __defProp=Object.defineProperty,__defNormalProp=(e,t,i)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,__publicField=(e,t,i)=>(__defNormalProp(e,"symbol"!=typeof t?t+"":t,i),i),MediaLibrary=function(e){var t;const i=globalThis,a=i.ShadowRoot&&(void 0===i.ShadyCSS||i.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,s=Symbol(),r=new WeakMap;let n=class{constructor(e,t,i){if(this._$cssResult$=!0,i!==s)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(a&&void 0===e){const i=void 0!==t&&1===t.length;i&&(e=r.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&r.set(t,e))}return e}toString(){return this.cssText}};const o=a?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return(e=>new n("string"==typeof e?e:e+"",void 0,s))(t)})(e):e,{is:l,defineProperty:c,getOwnPropertyDescriptor:d,getOwnPropertyNames:h,getOwnPropertySymbols:u,getPrototypeOf:p}=Object,g=globalThis,f=g.trustedTypes,m=f?f.emptyScript:"",b=g.reactiveElementPolyfillSupport,y=(e,t)=>e,v={toAttribute(e,t){switch(t){case Boolean:e=e?m:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=null!==e;break;case Number:i=null===e?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(a){i=null}}return i}},w=(e,t)=>!l(e,t),x={attribute:!0,type:String,converter:v,reflect:!1,useDefault:!1,hasChanged:w};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),g.litPropertyMetadata??(g.litPropertyMetadata=new WeakMap);let S=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=x){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const i=Symbol(),a=this.getPropertyDescriptor(e,i,t);void 0!==a&&c(this.prototype,e,a)}}static getPropertyDescriptor(e,t,i){const{get:a,set:s}=d(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:a,set(t){const r=null==a?void 0:a.call(this);null==s||s.call(this,t),this.requestUpdate(e,r,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??x}static _$Ei(){if(this.hasOwnProperty(y("elementProperties")))return;const e=p(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(y("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(y("properties"))){const e=this.properties,t=[...h(e),...u(e)];for(const i of t)this.createProperty(i,e[i])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,i]of t)this.elementProperties.set(e,i)}this._$Eh=new Map;for(const[t,i]of this.elementProperties){const e=this._$Eu(t,i);void 0!==e&&this._$Eh.set(e,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift(o(e))}else void 0!==e&&t.push(o(e));return t}static _$Eu(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),null==(e=this.constructor.l)||e.forEach(e=>e(this))}addController(e){var t;(this._$EO??(this._$EO=new Set)).add(e),void 0!==this.renderRoot&&this.isConnected&&(null==(t=e.hostConnected)||t.call(e))}removeController(e){var t;null==(t=this._$EO)||t.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const i of t.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(a)e.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const a of t){const t=document.createElement("style"),s=i.litNonce;void 0!==s&&t.setAttribute("nonce",s),t.textContent=a.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null==(e=this._$EO)||e.forEach(e=>{var t;return null==(t=e.hostConnected)?void 0:t.call(e)})}enableUpdating(e){}disconnectedCallback(){var e;null==(e=this._$EO)||e.forEach(e=>{var t;return null==(t=e.hostDisconnected)?void 0:t.call(e)})}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$ET(e,t){var i;const a=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,a);if(void 0!==s&&!0===a.reflect){const r=(void 0!==(null==(i=a.converter)?void 0:i.toAttribute)?a.converter:v).toAttribute(t,a.type);this._$Em=e,null==r?this.removeAttribute(s):this.setAttribute(s,r),this._$Em=null}}_$AK(e,t){var i,a;const s=this.constructor,r=s._$Eh.get(e);if(void 0!==r&&this._$Em!==r){const e=s.getPropertyOptions(r),n="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==(null==(i=e.converter)?void 0:i.fromAttribute)?e.converter:v;this._$Em=r;const o=n.fromAttribute(t,e.type);this[r]=o??(null==(a=this._$Ej)?void 0:a.get(r))??o,this._$Em=null}}requestUpdate(e,t,i){var a;if(void 0!==e){const s=this.constructor,r=this[e];if(i??(i=s.getPropertyOptions(e)),!((i.hasChanged??w)(r,t)||i.useDefault&&i.reflect&&r===(null==(a=this._$Ej)?void 0:a.get(e))&&!this.hasAttribute(s._$Eu(e,i))))return;this.C(e,t,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:i,reflect:a,wrapped:s},r){i&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,r??t??this[e]),!0!==s||void 0!==r)||(this._$AL.has(e)||(this.hasUpdated||i||(t=void 0),this._$AL.set(e,t)),!0===a&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,i]of e){const{wrapped:e}=i,a=this[t];!0!==e||this._$AL.has(t)||void 0===a||this.C(t,void 0,i,a)}}let t=!1;const i=this._$AL;try{t=this.shouldUpdate(i),t?(this.willUpdate(i),null==(e=this._$EO)||e.forEach(e=>{var t;return null==(t=e.hostUpdate)?void 0:t.call(e)}),this.update(i)):this._$EM()}catch(a){throw t=!1,this._$EM(),a}t&&this._$AE(i)}willUpdate(e){}_$AE(e){var t;null==(t=this._$EO)||t.forEach(e=>{var t;return null==(t=e.hostUpdated)?void 0:t.call(e)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(e=>this._$ET(e,this[e]))),this._$EM()}updated(e){}firstUpdated(e){}};S.elementStyles=[],S.shadowRootOptions={mode:"open"},S[y("elementProperties")]=new Map,S[y("finalized")]=new Map,null==b||b({ReactiveElement:S}),(g.reactiveElementVersions??(g.reactiveElementVersions=[])).push("2.1.1");const C=globalThis,A=C.trustedTypes,k=A?A.createPolicy("lit-html",{createHTML:e=>e}):void 0,I="$lit$",D=`lit$${Math.random().toFixed(9).slice(2)}$`,P="?"+D,T=`<${P}>`,_=document,M=()=>_.createComment(""),E=e=>null===e||"object"!=typeof e&&"function"!=typeof e,$=Array.isArray,L=e=>$(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]),F="[ \t\n\f\r]",U=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,O=/-->/g,R=/>/g,N=RegExp(`>|${F}(?:([^\\s"'>=/]+)(${F}*=${F}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),B=/'/g,z=/"/g,V=/^(?:script|style|textarea|title)$/i,j=(e,...t)=>({_$litType$:1,strings:e,values:t}),H=Symbol.for("lit-noChange"),G=Symbol.for("lit-nothing"),W=new WeakMap,q=_.createTreeWalker(_,129);function K(e,t){if(!$(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==k?k.createHTML(t):t}const Q=(e,t)=>{const i=e.length-1,a=[];let s,r=2===t?"<svg>":3===t?"<math>":"",n=U;for(let o=0;o<i;o++){const t=e[o];let i,l,c=-1,d=0;for(;d<t.length&&(n.lastIndex=d,l=n.exec(t),null!==l);)d=n.lastIndex,n===U?"!--"===l[1]?n=O:void 0!==l[1]?n=R:void 0!==l[2]?(V.test(l[2])&&(s=RegExp("</"+l[2],"g")),n=N):void 0!==l[3]&&(n=N):n===N?">"===l[0]?(n=s??U,c=-1):void 0===l[1]?c=-2:(c=n.lastIndex-l[2].length,i=l[1],n=void 0===l[3]?N:'"'===l[3]?z:B):n===z||n===B?n=N:n===O||n===R?n=U:(n=N,s=void 0);const h=n===N&&e[o+1].startsWith("/>")?" ":"";r+=n===U?t+T:c>=0?(a.push(i),t.slice(0,c)+I+t.slice(c)+D+h):t+D+(-2===c?o:h)}return[K(e,r+(e[i]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),a]};let X=class e{constructor({strings:t,_$litType$:i},a){let s;this.parts=[];let r=0,n=0;const o=t.length-1,l=this.parts,[c,d]=Q(t,i);if(this.el=e.createElement(c,a),q.currentNode=this.el.content,2===i||3===i){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(s=q.nextNode())&&l.length<o;){if(1===s.nodeType){if(s.hasAttributes())for(const e of s.getAttributeNames())if(e.endsWith(I)){const t=d[n++],i=s.getAttribute(e).split(D),a=/([.?@])?(.*)/.exec(t);l.push({type:1,index:r,name:a[2],strings:i,ctor:"."===a[1]?te:"?"===a[1]?ie:"@"===a[1]?ae:ee}),s.removeAttribute(e)}else e.startsWith(D)&&(l.push({type:6,index:r}),s.removeAttribute(e));if(V.test(s.tagName)){const e=s.textContent.split(D),t=e.length-1;if(t>0){s.textContent=A?A.emptyScript:"";for(let i=0;i<t;i++)s.append(e[i],M()),q.nextNode(),l.push({type:2,index:++r});s.append(e[t],M())}}}else if(8===s.nodeType)if(s.data===P)l.push({type:2,index:r});else{let e=-1;for(;-1!==(e=s.data.indexOf(D,e+1));)l.push({type:7,index:r}),e+=D.length-1}r++}}static createElement(e,t){const i=_.createElement("template");return i.innerHTML=e,i}};function Y(e,t,i=e,a){var s,r;if(t===H)return t;let n=void 0!==a?null==(s=i._$Co)?void 0:s[a]:i._$Cl;const o=E(t)?void 0:t._$litDirective$;return(null==n?void 0:n.constructor)!==o&&(null==(r=null==n?void 0:n._$AO)||r.call(n,!1),void 0===o?n=void 0:(n=new o(e),n._$AT(e,i,a)),void 0!==a?(i._$Co??(i._$Co=[]))[a]=n:i._$Cl=n),void 0!==n&&(t=Y(e,n._$AS(e,t.values),n,a)),t}let J=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:i}=this._$AD,a=((null==e?void 0:e.creationScope)??_).importNode(t,!0);q.currentNode=a;let s=q.nextNode(),r=0,n=0,o=i[0];for(;void 0!==o;){if(r===o.index){let t;2===o.type?t=new Z(s,s.nextSibling,this,e):1===o.type?t=new o.ctor(s,o.name,o.strings,this,e):6===o.type&&(t=new se(s,this,e)),this._$AV.push(t),o=i[++n]}r!==(null==o?void 0:o.index)&&(s=q.nextNode(),r++)}return q.currentNode=_,a}p(e){let t=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}},Z=class e{get _$AU(){var e;return(null==(e=this._$AM)?void 0:e._$AU)??this._$Cv}constructor(e,t,i,a){this.type=2,this._$AH=G,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=a,this._$Cv=(null==a?void 0:a.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===(null==e?void 0:e.nodeType)&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Y(this,e,t),E(e)?e===G||null==e||""===e?(this._$AH!==G&&this._$AR(),this._$AH=G):e!==this._$AH&&e!==H&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):L(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==G&&E(this._$AH)?this._$AA.nextSibling.data=e:this.T(_.createTextNode(e)),this._$AH=e}$(e){var t;const{values:i,_$litType$:a}=e,s="number"==typeof a?this._$AC(e):(void 0===a.el&&(a.el=X.createElement(K(a.h,a.h[0]),this.options)),a);if((null==(t=this._$AH)?void 0:t._$AD)===s)this._$AH.p(i);else{const e=new J(s,this),t=e.u(this.options);e.p(i),this.T(t),this._$AH=e}}_$AC(e){let t=W.get(e.strings);return void 0===t&&W.set(e.strings,t=new X(e)),t}k(t){$(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let a,s=0;for(const r of t)s===i.length?i.push(a=new e(this.O(M()),this.O(M()),this,this.options)):a=i[s],a._$AI(r),s++;s<i.length&&(this._$AR(a&&a._$AB.nextSibling,s),i.length=s)}_$AR(e=this._$AA.nextSibling,t){var i;for(null==(i=this._$AP)||i.call(this,!1,!0,t);e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cv=e,null==(t=this._$AP)||t.call(this,e))}},ee=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,a,s){this.type=1,this._$AH=G,this._$AN=void 0,this.element=e,this.name=t,this._$AM=a,this.options=s,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=G}_$AI(e,t=this,i,a){const s=this.strings;let r=!1;if(void 0===s)e=Y(this,e,t,0),r=!E(e)||e!==this._$AH&&e!==H,r&&(this._$AH=e);else{const a=e;let n,o;for(e=s[0],n=0;n<s.length-1;n++)o=Y(this,a[i+n],t,n),o===H&&(o=this._$AH[n]),r||(r=!E(o)||o!==this._$AH[n]),o===G?e=G:e!==G&&(e+=(o??"")+s[n+1]),this._$AH[n]=o}r&&!a&&this.j(e)}j(e){e===G?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},te=class extends ee{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===G?void 0:e}},ie=class extends ee{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==G)}},ae=class extends ee{constructor(e,t,i,a,s){super(e,t,i,a,s),this.type=5}_$AI(e,t=this){if((e=Y(this,e,t,0)??G)===H)return;const i=this._$AH,a=e===G&&i!==G||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,s=e!==G&&(i===G||a);a&&this.element.removeEventListener(this.name,this,i),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t;"function"==typeof this._$AH?this._$AH.call((null==(t=this.options)?void 0:t.host)??this.element,e):this._$AH.handleEvent(e)}},se=class{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){Y(this,e)}};const re={M:I,P:D,A:P,C:1,L:Q,R:J,D:L,V:Y,I:Z,H:ee,N:ie,U:ae,B:te,F:se},ne=C.litHtmlPolyfillSupport;null==ne||ne(X,Z),(C.litHtmlVersions??(C.litHtmlVersions=[])).push("3.3.1");const oe=globalThis;let le=class extends S{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e;const t=super.createRenderRoot();return(e=this.renderOptions).renderBefore??(e.renderBefore=t.firstChild),t}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,i)=>{const a=(null==i?void 0:i.renderBefore)??t;let s=a._$litPart$;if(void 0===s){const e=(null==i?void 0:i.renderBefore)??null;a._$litPart$=s=new Z(t.insertBefore(M(),e),e,void 0,i??{})}return s._$AI(e),s})(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null==(e=this._$Do)||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null==(e=this._$Do)||e.setConnected(!1)}render(){return H}};le._$litElement$=!0,le.finalized=!0,null==(t=oe.litElementHydrateSupport)||t.call(oe,{LitElement:le});const ce=oe.litElementPolyfillSupport;null==ce||ce({LitElement:le}),(oe.litElementVersions??(oe.litElementVersions=[])).push("4.2.1");const de={common:{loading:"Loading...",error:"Error",success:"Success",cancel:"Cancel",save:"Save",delete:"Delete",edit:"Edit",close:"Close",search:"Search",filter:"Filter",clear:"Clear",all:"All"},COMMON:{FILTER:"Filter"},mediaLibrary:{title:"Media Library",searchPlaceholder:"Search media, doc:path, folder:path, or / for root files...",searchDisabledDuringScan:"Search disabled during scan...",noResults:"No media found",loadingMedia:"Loading media...",scanProgress:"Scanning {{current}} of {{total}} pages...",scanStarting:"Starting scan...",scanComplete:"Scan complete! Found {{count}} media files.",scanning:"Scanning...",scanButton:"Scan Media",manualSitemap:"Manual Sitemap URL",sitemapPlaceholder:"Enter sitemap URL manually",analysisEnabled:"Analysis ON",analysisDisabled:"Analysis OFF",analysisTooltip:"Toggle EXIF data extraction (camera info, date taken, natural dimensions) - OFF for faster scanning"},filters:{all:"All Media",images:"Images",videos:"Videos",documents:"Documents",links:"Links",icons:"SVGs",missingAlt:"Missing Alt Text",decorative:"Decorative",filled:"With Alt Text",unused:"Unused",landscape:"Landscape",portrait:"Portrait",square:"Square",lcpCandidate:"LCP Candidates",aboveFold:"Above Fold",belowFold:"Below Fold",needsOptimization:"Needs Optimization",fullyOptimized:"Fully Optimized",noSrcset:"No Srcset",hasSrcset:"Has Srcset",legacyFormat:"Legacy Format",modernFormat:"Modern Format",noLazyLoading:"No Lazy Loading",lazyLoading:"Lazy Loading",socialImage:"Social Images",ogImage:"OG Images",performanceIssue:"Performance Issues",screenshots:"Graphics & UI",logos:"Logos","people-photos":"People",products:"Products","404-media":"404 Media"},views:{grid:"Grid View",list:"List View"},categories:{title:"Categories","hero-banner":"Hero/Banner","team-member":"Team/People",testimonials:"Testimonials","navigation-ui":"Navigation/UI","article-content":"Article/Content","product-service":"Product/Service","decorative-background":"Decorative/Background","social-sharing":"Social/Sharing","document-pdf":"Document/PDF","logo-brand":"Logo/Brand","screenshot-demo":"Screenshot/Demo"},media:{altText:"Alt Text",fileName:"File Name",fileSize:"File Size",lastModified:"Last Modified",usedIn:"Used in {{count}} documents",notUsed:"Not used",copyUrl:"Copy URL",copyImage:"Copy Image",download:"Download",editAltText:"Edit Alt Text"},units:{bytes:"bytes",KB:"KB",MB:"MB",GB:"GB"},errors:{loadFailed:"Failed to load media data",scanFailed:"Failed to scan media",saveFailed:"Failed to save changes",networkError:"Network error occurred",invalidSource:"Invalid source URL",parseError:"Failed to parse data"}},he={common:{loading:"Cargando...",error:"Error",success:"Éxito",cancel:"Cancelar",save:"Guardar",delete:"Eliminar",edit:"Editar",close:"Cerrar",search:"Buscar",filter:"Filtrar",clear:"Limpiar",all:"Todos"},COMMON:{FILTER:"Filtrar"},mediaLibrary:{title:"Biblioteca de Medios",searchPlaceholder:"Buscar medios, doc:ruta, folder:ruta, o / para archivos raíz...",noResults:"No se encontraron medios",loadingMedia:"Cargando medios...",scanProgress:"Escaneando {{current}} de {{total}} páginas...",scanStarting:"Iniciando escaneo...",scanComplete:"¡Escaneo completo! Se encontraron {{count}} archivos de medios.",scanning:"Escaneando...",scanButton:"Escanear Medios",manualSitemap:"URL de Sitemap Manual",sitemapPlaceholder:"Ingrese la URL del sitemap manualmente",analysisEnabled:"Análisis ON",analysisDisabled:"Análisis OFF",analysisTooltip:"Alternar análisis de imagen (orientación, categorización, datos EXIF) - ON por defecto para mejor categorización"},filters:{all:"Todos los Medios",images:"Imágenes",videos:"Videos",documents:"Documentos",links:"Enlaces",icons:"SVGs",missingAlt:"Falta Texto Alt",decorative:"Decorativo",filled:"Con Texto Alt",unused:"No Utilizado",landscape:"Horizontal",portrait:"Vertical",square:"Cuadrado",lcpCandidate:"Candidatos LCP",aboveFold:"Arriba del Pliegue",belowFold:"Debajo del Pliegue",needsOptimization:"Necesita Optimización",fullyOptimized:"Totalmente Optimizado",noSrcset:"Sin Srcset",hasSrcset:"Con Srcset",legacyFormat:"Formato Legacy",modernFormat:"Formato Moderno",noLazyLoading:"Sin Carga Perezosa",lazyLoading:"Carga Perezosa",socialImage:"Imágenes Sociales",ogImage:"Imágenes OG",performanceIssue:"Problemas de Rendimiento",screenshots:"Capturas de Pantalla",logos:"Logotipos","people-photos":"Fotos de Personas",products:"Productos","404-media":"Medios 404"},views:{grid:"Vista de Cuadrícula",list:"Vista de Lista"},categories:{title:"Categorías","hero-banner":"Hero/Banner","team-member":"Equipo/Personas",testimonials:"Testimonios","navigation-ui":"Navegación/UI","article-content":"Artículo/Contenido","product-service":"Producto/Servicio","decorative-background":"Decorativo/Fondo","social-sharing":"Social/Compartir","document-pdf":"Documento/PDF","logo-brand":"Logo/Marca","screenshot-demo":"Captura/Demo"},media:{altText:"Texto Alt",fileName:"Nombre del Archivo",fileSize:"Tamaño del Archivo",lastModified:"Última Modificación",usedIn:"Usado en {{count}} documentos",notUsed:"No usado",copyUrl:"Copiar URL",copyImage:"Copiar Imagen",download:"Descargar",editAltText:"Editar Texto Alt"},units:{bytes:"bytes",KB:"KB",MB:"MB",GB:"GB"},errors:{loadFailed:"Error al cargar datos de medios",scanFailed:"Error al escanear medios",saveFailed:"Error al guardar cambios",networkError:"Error de red",invalidSource:"URL de origen inválida",parseError:"Error al analizar datos"}},ue={common:{loading:"Laden...",error:"Fehler",success:"Erfolg",cancel:"Abbrechen",save:"Speichern",delete:"Löschen",edit:"Bearbeiten",close:"Schließen",search:"Suchen",filter:"Filtern",clear:"Löschen",all:"Alle"},COMMON:{FILTER:"Filtern"},mediaLibrary:{title:"Medienbibliothek",searchPlaceholder:"Medien suchen, doc:pfad, folder:pfad, oder / für Root-Dateien...",noResults:"Keine Medien gefunden",loadingMedia:"Medien werden geladen...",scanProgress:"Scanne {{current}} von {{total}} Seiten...",scanStarting:"Scan wird gestartet...",scanComplete:"Scan abgeschlossen! {{count}} Mediendateien gefunden.",scanning:"Scannen...",scanButton:"Medien Scannen",manualSitemap:"Manuelle Sitemap-URL",sitemapPlaceholder:"Sitemap-URL manuell eingeben",analysisEnabled:"Analyse AN",analysisDisabled:"Analyse AUS",analysisTooltip:"Bildanalyse umschalten (Orientierung, Kategorisierung, EXIF-Daten) - Standardmäßig AN für bessere Kategorisierung"},filters:{all:"Alle Medien",images:"Bilder",videos:"Videos",documents:"Dokumente",links:"Links",icons:"SVGs",missingAlt:"Fehlender Alt-Text",decorative:"Dekorativ",filled:"Mit Alt-Text",unused:"Ungenutzt",landscape:"Querformat",portrait:"Hochformat",square:"Quadratisch",lcpCandidate:"LCP-Kandidaten",aboveFold:"Oberhalb der Falz",belowFold:"Unterhalb der Falz",needsOptimization:"Optimierung erforderlich",fullyOptimized:"Vollständig optimiert",noSrcset:"Kein Srcset",hasSrcset:"Mit Srcset",legacyFormat:"Legacy-Format",modernFormat:"Modernes Format",noLazyLoading:"Kein Lazy Loading",lazyLoading:"Lazy Loading",socialImage:"Social Images",ogImage:"OG Images",performanceIssue:"Leistungsprobleme",screenshots:"Screenshots",logos:"Logos","people-photos":"Personenfotos",products:"Produkte","404-media":"404-Medien"},views:{grid:"Rasteransicht",list:"Listenansicht"},categories:{title:"Kategorien","hero-banner":"Hero/Banner","team-member":"Team/Personen",testimonials:"Testimonials","navigation-ui":"Navigation/UI","article-content":"Artikel/Inhalt","product-service":"Produkt/Service","decorative-background":"Dekorativ/Hintergrund","social-sharing":"Social/Teilen","document-pdf":"Dokument/PDF","logo-brand":"Logo/Marke","screenshot-demo":"Screenshot/Demo"},media:{altText:"Alt-Text",fileName:"Dateiname",fileSize:"Dateigröße",lastModified:"Zuletzt geändert",usedIn:"Verwendet in {{count}} Dokumenten",notUsed:"Nicht verwendet",copyUrl:"URL kopieren",copyImage:"Bild kopieren",download:"Herunterladen",editAltText:"Alt-Text bearbeiten"},units:{bytes:"Bytes",KB:"KB",MB:"MB",GB:"GB"},errors:{loadFailed:"Fehler beim Laden der Mediendaten",scanFailed:"Fehler beim Scannen der Medien",saveFailed:"Fehler beim Speichern der Änderungen",networkError:"Netzwerkfehler aufgetreten",invalidSource:"Ungültige Quell-URL",parseError:"Fehler beim Analysieren der Daten"}},pe={common:{loading:"Chargement...",error:"Erreur",success:"Succès",cancel:"Annuler",save:"Enregistrer",delete:"Supprimer",edit:"Modifier",close:"Fermer",search:"Rechercher",filter:"Filtrer",clear:"Effacer",all:"Tous"},COMMON:{FILTER:"Filtrer"},mediaLibrary:{title:"Bibliothèque de Médias",searchPlaceholder:"Rechercher des médias, doc:chemin, folder:chemin, ou / pour fichiers racine...",noResults:"Aucun média trouvé",loadingMedia:"Chargement des médias...",scanProgress:"Analyse de {{current}} sur {{total}} pages...",scanStarting:"Démarrage de l'analyse...",scanComplete:"Analyse terminée ! {{count}} fichiers multimédias trouvés.",scanning:"Analyse en cours...",scanButton:"Analyser les Médias",manualSitemap:"URL de Sitemap Manuelle",sitemapPlaceholder:"Saisir l'URL du sitemap manuellement",analysisEnabled:"Analyse ON",analysisDisabled:"Analyse OFF",analysisTooltip:"Basculer l'analyse d'image (orientation, catégorisation, données EXIF) - ON par défaut pour une meilleure catégorisation"},filters:{all:"Tous les Médias",images:"Images",videos:"Vidéos",documents:"Documents",links:"Liens",icons:"SVGs",missingAlt:"Texte Alt Manquant",decorative:"Décoratif",filled:"Avec Texte Alt",unused:"Non Utilisé",landscape:"Paysage",portrait:"Portrait",square:"Carré",lcpCandidate:"Candidats LCP",aboveFold:"Au-dessus du Pli",belowFold:"En-dessous du Pli",needsOptimization:"Nécessite une Optimisation",fullyOptimized:"Entièrement Optimisé",noSrcset:"Pas de Srcset",hasSrcset:"Avec Srcset",legacyFormat:"Format Legacy",modernFormat:"Format Moderne",noLazyLoading:"Pas de Lazy Loading",lazyLoading:"Lazy Loading",socialImage:"Images Sociales",ogImage:"Images OG",performanceIssue:"Problèmes de Performance",screenshots:"Captures d'Écran",logos:"Logos","people-photos":"Photos de Personnes",products:"Produits","404-media":"Médias 404"},views:{grid:"Vue Grille",list:"Vue Liste"},categories:{title:"Catégories","hero-banner":"Hero/Bannière","team-member":"Équipe/Personnes",testimonials:"Témoignages","navigation-ui":"Navigation/UI","article-content":"Article/Contenu","product-service":"Produit/Service","decorative-background":"Décoratif/Arrière-plan","social-sharing":"Social/Partage","document-pdf":"Document/PDF","logo-brand":"Logo/Marque","screenshot-demo":"Capture/Démo"},media:{altText:"Texte Alt",fileName:"Nom du Fichier",fileSize:"Taille du Fichier",lastModified:"Dernière Modification",usedIn:"Utilisé dans {{count}} documents",notUsed:"Non utilisé",copyUrl:"Copier l'URL",copyImage:"Copier l'Image",download:"Télécharger",editAltText:"Modifier le Texte Alt"},units:{bytes:"octets",KB:"Ko",MB:"Mo",GB:"Go"},errors:{loadFailed:"Échec du chargement des données multimédias",scanFailed:"Échec de l'analyse des médias",saveFailed:"Échec de l'enregistrement des modifications",networkError:"Erreur réseau survenue",invalidSource:"URL source invalide",parseError:"Échec de l'analyse des données"}};class ge extends EventTarget{constructor(){super(),this.currentLocale="en",this.translations=new Map,this.fallbackLocale="en",this.translations.set("en",de),this.translations.set("es",he),this.translations.set("de",ue),this.translations.set("fr",pe)}async loadLocale(e){if(this.translations.has(e))return this.translations.get(e);try{return"en"===e?(this.translations.set(e,de),de):"es"===e?(this.translations.set(e,he),he):"de"===e?(this.translations.set(e,ue),ue):"fr"===e?(this.translations.set(e,pe),pe):this.translations.get(this.fallbackLocale)||{}}catch(t){return this.translations.get(this.fallbackLocale)||{}}}setLocale(e){this.currentLocale=e,this.dispatchEvent(new CustomEvent("locale-changed",{detail:{locale:e}}))}t(e,t={}){const i=this.translations.get(this.currentLocale)||{};let a=this.getNestedValue(i,e);if(!a){const t=this.translations.get(this.fallbackLocale)||{};a=this.getNestedValue(t,e)}return a?this.replaceParams(a,t):e}getNestedValue(e,t){return t.split(".").reduce((e,t)=>null==e?void 0:e[t],e)}replaceParams(e,t){return e.replace(/\{\{(\w+)\}\}/g,(e,i)=>t[i]||e)}formatNumber(e,t={}){return new Intl.NumberFormat(this.currentLocale,t).format(e)}formatDate(e,t={}){return new Intl.DateTimeFormat(this.currentLocale,t).format(e)}formatFileSize(e){const t=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/1024**t).toFixed(2))} ${this.t(`units.${["bytes","KB","MB","GB"][t]}`)}`}}const fe=new ge;class me extends le{constructor(){super(),__publicField(this,"handleLocaleChange",()=>{this.requestUpdate()}),this.t=fe.t.bind(fe),this.formatNumber=fe.formatNumber.bind(fe),this.formatDate=fe.formatDate.bind(fe),this.formatFileSize=fe.formatFileSize.bind(fe)}connectedCallback(){super.connectedCallback(),fe.addEventListener("locale-changed",this.handleLocaleChange)}disconnectedCallback(){super.disconnectedCallback(),fe.removeEventListener("locale-changed",this.handleLocaleChange)}}const be=new class{constructor(){this.logLevel=this.getLogLevel(),this.isDevelopment=this.isDevelopmentEnvironment()}getLogLevel(){var e;const t="undefined"!=typeof process&&(null==(e=process.env)?void 0:e.LOG_LEVEL);return t?t.toLowerCase():this.isDevelopmentEnvironment()?"debug":"info"}isDevelopmentEnvironment(){var e,t,i;return"undefined"!=typeof window&&"localhost"===(null==(e=window.location)?void 0:e.hostname)||"undefined"!=typeof process&&"development"===(null==(t=process.env)?void 0:t.NODE_ENV)||"undefined"!=typeof process&&"dev"===(null==(i=process.env)?void 0:i.NODE_ENV)}shouldLog(e){const t=["error","warn","info","debug"],i=t.indexOf(this.logLevel);return t.indexOf(e)<=i}error(e,...t){this.shouldLog("error")}warn(e,...t){this.shouldLog("warn")}info(e,...t){this.shouldLog("info")}debug(e,...t){this.shouldLog("debug")}log(e,...t){this.info(e,...t)}logWithContext(e,t,i,...a){const s=`[${e}] ${i}`;this[t](s,...a)}setLogLevel(e){const t=["error","warn","info","debug"];t.includes(e.toLowerCase())?this.logLevel=e.toLowerCase():this.warn(`Invalid log level: ${e}. Valid levels are: ${t.join(", ")}`)}setEnabled(e){this.enabled=e}createContextLogger(e){return{error:(t,...i)=>this.logWithContext(e,"error",t,...i),warn:(t,...i)=>this.logWithContext(e,"warn",t,...i),info:(t,...i)=>this.logWithContext(e,"info",t,...i),debug:(t,...i)=>this.logWithContext(e,"debug",t,...i),log:(t,...i)=>this.logWithContext(e,"info",t,...i)}}};class ye{constructor(e){this.apiUrl=e.apiUrl}async putObject(e,t){const i=await fetch(`${this.apiUrl}/api/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e,data:t})});if(!i.ok)throw new Error(`R2 API PUT failed: ${i.status} ${i.statusText}`);return i.json()}async getObject(e){const t=await fetch(`${this.apiUrl}/api/load?key=${encodeURIComponent(e)}`,{method:"GET"});if(!t.ok){if(404===t.status)return null;throw new Error(`R2 API GET failed: ${t.status} ${t.statusText}`)}return t.json()}async deleteObject(e){const t=await fetch(`${this.apiUrl}/api/delete`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e})});if(!t.ok)throw new Error(`R2 API DELETE failed: ${t.status} ${t.statusText}`);return t.json()}async listObjects(e=""){const t=await fetch(`${this.apiUrl}/api/list?prefix=${encodeURIComponent(e)}`,{method:"GET"});if(!t.ok)throw new Error(`R2 API LIST failed: ${t.status} ${t.statusText}`);return(await t.json()).objects||[]}async batchSave(e,t="preview"){const i=await fetch(`${this.apiUrl}/api/batch-save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mediaUsages:e,mode:t})});if(!i.ok)throw new Error(`R2 API BATCH SAVE failed: ${i.status} ${i.statusText}`);return i.json()}async batchLoad(e){const t=await fetch(`${this.apiUrl}/api/batch-load`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({keys:e})});if(!t.ok)throw new Error(`R2 API BATCH LOAD failed: ${t.status} ${t.statusText}`);return(await t.json()).results||[]}async batchDelete(e){const t=await fetch(`${this.apiUrl}/api/batch-delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({keys:e})});if(!t.ok)throw new Error(`R2 API BATCH DELETE failed: ${t.status} ${t.statusText}`);return t.json()}}function ve(e,t){const i=[];for(let a=0;a<e.length;a+=t)i.push(e.slice(a,a+t));return i}class we{constructor(e="r2",t=null){this.type=e,this.siteKey=t,this.mode="live",this.r2API=new ye({apiUrl:"https://r2-api-worker.kiran-murugulla.workers.dev"})}async saveMediaUsages(e,t="live"){try{const a=ve(e,100);for(let e=0;e<a.length;e+=1){const s=a[e];try{await this.r2API.batchSave(s,t),await new Promise(e=>{setTimeout(e,10)})}catch(i){throw be.error(`Failed to save batch ${e+1}:`,i),i}}}catch(i){throw be.error("Failed to save media usages to R2:",i),i}}async loadMediaUsages(e=null){const t=null===e?this.mode:e;try{const e=(await this.r2API.listObjects(`${t}/`)).filter(e=>e.endsWith(".json"));if(0===e.length)return[];const a=ve(e,100),s=[];for(let t=0;t<a.length;t+=1){const e=a[t];try{const t=(await this.r2API.batchLoad(e)).filter(e=>null!==e);s.push(...t),await new Promise(e=>{setTimeout(e,10)})}catch(i){be.error(`Failed to load batch ${t+1}:`,i)}}return s}catch(i){return be.error("Failed to load media usages from R2:",i),[]}}async loadMediaUsagesProgressive(e=null,t=100,i=null){const a=null===e?this.mode:e;try{const e=(await this.r2API.listObjects(`${a}/`)).filter(e=>e.endsWith(".json"));if(0===e.length)return[];const r=[],n=ve(e,t);for(let t=0;t<n.length;t+=1){const e=n[t];try{const a=(await this.r2API.batchLoad(e)).filter(e=>null!==e);r.push(...a),i&&i((t+1)/n.length*100),await new Promise(e=>{setTimeout(e,10)})}catch(s){be.error(`Failed to load batch ${t+1}:`,s)}}return r}catch(s){return be.error("Failed to load media usages progressively from R2:",s),[]}}async saveMediaUsage(e,t="live"){try{const i=`${e.hash}.json`;await this.r2API.putObject(`${t}/${i}`,e)}catch(i){throw be.error("Failed to save media usage to R2:",i),i}}async loadMediaUsage(e,t="live"){try{const i=`${e}.json`;return await this.r2API.getObject(`${t}/${i}`)}catch(i){return be.error("Failed to load media usage from R2:",i),null}}async updateMediaUsage(e,t,i="live"){try{const a=`${e}.json`;await this.r2API.putObject(`${i}/${a}`,t)}catch(a){throw be.error("Failed to update media usage in R2:",a),a}}async deleteMediaUsage(e,t="live"){try{const i=`${e}.json`;await this.r2API.deleteObject(`${t}/${i}`)}catch(i){throw be.error("Failed to delete media usage from R2:",i),i}}async handleIncrementalChanges(e,t="live"){try{const i=[];for(const a of e.addedUsages||[])i.push(this.saveMediaUsage(a,t));for(const a of e.updatedUsages||[])i.push(this.updateMediaUsage(a.hash,a,t));for(const a of e.deletedUsages||[])i.push(this.deleteMediaUsage(a.hash,t));await Promise.all(i),be.info(`Applied ${i.length} incremental changes to ${t} mode`)}catch(i){throw be.error("Failed to handle incremental changes in R2:",i),i}}async getMediaUsagesByDocument(e,t="live"){try{return(await this.loadMediaUsages(t)).filter(t=>t.doc===e)}catch(i){return be.error("Failed to get media usages by document from R2:",i),[]}}async getMediaUsagesByUrl(e,t="live"){try{return(await this.loadMediaUsages(t)).filter(t=>t.url.split(/[?#]/)[0]===e)}catch(i){return be.error("Failed to get media usages by URL from R2:",i),[]}}async getMediaUsageStats(e="live"){try{const t=await this.loadMediaUsages(e),i={totalUsages:t.length,uniqueMedia:new Set(t.map(e=>e.url.split(/[?#]/)[0])).size,uniqueDocuments:new Set(t.map(e=>e.doc)).size,byType:{},byDocument:{}};return t.forEach(e=>{var t;const a=(null==(t=e.type)?void 0:t.split(" > ")[0])||"unknown";i.byType[a]=(i.byType[a]||0)+1}),t.forEach(e=>{i.byDocument[e.doc]=(i.byDocument[e.doc]||0)+1}),i}catch(t){return be.error("Failed to get media usage stats from R2:",t),{totalUsages:0,uniqueMedia:0,uniqueDocuments:0,byType:{},byDocument:{}}}}setMode(e){this.mode=e}getMode(){return this.mode}async getAllSites(){try{const i=["preview","edit","live","audit"],a=new Map;for(const s of i){const i=(await this.r2API.listObjects(`${s}/`)).filter(e=>e.endsWith(".json"));if(i.length>0){const r=ve(i,50);for(const i of r)try{const t=await this.r2API.batchLoad(i);for(const i of t)if(i&&i.doc)try{const e=new URL(i.doc).hostname;a.has(e)||a.set(e,{siteKey:e,itemCount:0,timestamp:i.firstUsedAt||Date.now()});const t=a.get(e);t.itemCount+=1,i.firstUsedAt&&i.firstUsedAt<t.timestamp&&(t.timestamp=i.firstUsedAt)}catch(e){}}catch(t){be.warn(`Failed to process batch for mode ${s}:`,t)}}}return Array.from(a.values()).sort((e,t)=>t.timestamp-e.timestamp)}catch(t){return be.error("Failed to get all sites from R2:",t),[]}}async migrateFromIndexedDB(e,t="live"){try{const{default:i}=await Promise.resolve().then(()=>Ce),a=new i("indexeddb",e),s=await a.load();await this.saveMediaUsages(s,t),be.info(`Migrated ${s.length} media usages to R2 ${t} mode`)}catch(i){throw be.error("Failed to migrate from IndexedDB to R2:",i),i}}async save(e){return this.saveMediaUsages(e,this.mode)}async load(){return this.loadMediaUsages(this.mode)}async loadScanMetadata(){try{const e=await this.loadMediaUsages(this.mode),t={};for(const i of e)i.doc&&i.lastUsedAt&&(t[i.doc]=new Date(i.lastUsedAt).toISOString());return{pageLastModified:t}}catch(e){return be.error("Failed to load scan metadata from R2:",e),{pageLastModified:{}}}}async saveScanMetadata(e){try{const t=`${this.mode}/scan-metadata.json`;await this.r2API.putObject(t,e)}catch(t){throw be.error("Failed to save scan metadata to R2:",t),t}}async deleteSiteFromIndexedDB(e){try{const t=(await this.loadMediaUsages(this.mode)).filter(t=>{try{return new URL(t.doc).hostname===e}catch{return!1}}),i=t.map(e=>this.deleteMediaUsage(e.hash,this.mode));await Promise.all(i),be.info(`Deleted ${t.length} media usages for site: ${e}`)}catch(t){throw be.error("Failed to delete site from R2:",t),t}}async clearAllSites(){try{const e=["preview","edit","live"],t=[];for(const i of e){const e=await this.r2API.listObjects(`${i}/`);for(const i of e)i.endsWith(".json")&&t.push(this.r2API.deleteObject(i))}await Promise.all(t),be.info("Cleared all sites from R2")}catch(e){throw be.error("Failed to clear all sites from R2:",e),e}}}class xe{constructor(e="indexeddb",t=null){this.type=e,this.dbVersion=7,this.siteKey=t,this.dbName=t?`media_${this.normalizeSiteKey(t)}`:"MediaLibrary"}normalizeSiteKey(e){return e?e.toLowerCase().replace(/[^a-z0-9-]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"").substring(0,50):"unknown"}denormalizeSiteKey(e){return e.replace(/_/g,".").replace(/^www_/,"www.")}async ensureDatabase(){return"indexeddb"!==this.type?null:new Promise((e,t)=>{const i=indexedDB.open(this.dbName,this.dbVersion);i.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("processedData")&&t.deleteObjectStore("processedData"),t.objectStoreNames.contains("media")&&t.deleteObjectStore("media");const i=t.createObjectStore("media",{keyPath:"id",autoIncrement:!0});i.createIndex("hash","hash",{unique:!1}),i.createIndex("url","url",{unique:!1}),i.createIndex("doc","doc",{unique:!1}),i.createIndex("name","name",{unique:!1}),t.objectStoreNames.contains("last-modified-data")||t.createObjectStore("last-modified-data",{keyPath:"siteKey"})},i.onsuccess=t=>{const i=t.target.result;e(i)},i.onerror=()=>{be.error("Failed to open IndexedDB:",i.error),t(i.error)}})}async save(e){switch(this.type){case"indexeddb":return this.saveItemsToIndexedDB(e);case"none":return Promise.resolve();default:throw new Error(`Unsupported storage type: ${this.type}`)}}async saveItemsToIndexedDB(e){try{const t=await this.ensureDatabase();return t.objectStoreNames.contains("media")?new Promise((i,a)=>{const s=t.transaction(["media"],"readwrite").objectStore("media");let r=0;const n=e.length;0!==n?e.forEach(e=>{const t={...e,timestamp:Date.now()},o=s.put(t);o.onsuccess=()=>{r+=1,r===n&&i()},o.onerror=()=>{a(o.error)}}):i()}):(be.warn("Media object store does not exist, cannot save data"),Promise.resolve())}catch(t){throw be.error("Failed to save items to IndexedDB:",t),t}}async load(){switch(this.type){case"indexeddb":return await this.loadRawDataBySite();case"none":return[];default:throw new Error(`Unsupported storage type: ${this.type}`)}}async loadChunk(e,t){switch(this.type){case"indexeddb":return this.loadRawDataChunk(e,t);case"none":return[];default:throw new Error(`Unsupported storage type: ${this.type}`)}}async loadUniqueMediaItems(){switch(this.type){case"indexeddb":return this.loadUniqueMediaItemsFromIndexedDB();case"none":return[];default:throw new Error(`Unsupported storage type: ${this.type}`)}}async loadRawDataBySite(){try{const e=await this.ensureDatabase();return e.objectStoreNames.contains("media")?new Promise((t,i)=>{const a=e.transaction(["media"],"readonly").objectStore("media").getAll();a.onsuccess=()=>{const e=(a.result||[]).map(e=>{const{timestamp:t,...i}=e;return i});t(e)},a.onerror=()=>{i(a.error)}}):(be.warn("Media object store does not exist, returning empty array"),[])}catch(e){return be.error("Failed to load raw data from IndexedDB:",e),[]}}async loadRawDataChunk(e,t){try{const i=await this.ensureDatabase();return i.objectStoreNames.contains("media")?new Promise((a,s)=>{const r=i.transaction(["media"],"readonly").objectStore("media").openCursor(),n=[];let o=0;r.onsuccess=i=>{const s=i.target.result;if(!s){const e=n.map(e=>{const{timestamp:t,...i}=e;return i});return void a(e)}if(o<e)return o+=1,void s.continue();if(n.push(s.value),n.length>=t){const e=n.map(e=>{const{timestamp:t,...i}=e;return i});return void a(e)}s.continue()},r.onerror=()=>{s(r.error)}}):[]}catch(i){return be.error("Failed to load raw data chunk from IndexedDB:",i),[]}}async loadUniqueMediaItemsFromIndexedDB(){try{const e=await this.ensureDatabase();return e.objectStoreNames.contains("media")?new Promise((t,i)=>{const a=e.transaction(["media"],"readonly").objectStore("media").openCursor(),s=new Map;a.onsuccess=e=>{const i=e.target.result;if(!i){const e=Array.from(s.values()).map(e=>{const{timestamp:t,...i}=e;return i});return void t(e)}const a=i.value;s.has(a.url)||s.set(a.url,a),i.continue()},a.onerror=()=>{i(a.error)}}):[]}catch(e){return be.error("Failed to load unique media items from IndexedDB:",e),[]}}async getItemByHash(e){try{const t=await this.ensureDatabase();return t.objectStoreNames.contains("media")?new Promise((i,a)=>{const s=t.transaction(["media"],"readonly").objectStore("media").index("hash").get(e);s.onsuccess=()=>{const{result:e}=s;if(e){const{timestamp:t,...a}=e;i(a)}else i(null)},s.onerror=()=>{a(s.error)}}):null}catch(t){return be.error("Failed to get item by hash:",t),null}}async getAllSites(){switch(this.type){case"indexeddb":return this.getAllSitesFromIndexedDB();case"none":return[];default:throw new Error(`Unsupported storage type: ${this.type}`)}}async getAllSitesFromIndexedDB(){try{const t=[],i=await this.getAllDatabases();for(const a of i)if(a.startsWith("media_")){const i=a.replace("media_",""),s=this.denormalizeSiteKey(i);try{const i=new xe("indexeddb",s),a=await i.ensureDatabase();if(a&&a.objectStoreNames.contains("media")){const i=a.transaction(["media"],"readonly").objectStore("media").count(),r=await new Promise((e,t)=>{i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)});let n=Date.now();if(a.objectStoreNames.contains("last-modified-data")){const t=a.transaction(["last-modified-data"],"readonly").objectStore("last-modified-data").get(this.siteKey||"default");try{const e=await new Promise((e,i)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>i(t.error)});e&&e.timestamp&&(n=e.timestamp)}catch(e){}}t.push({siteKey:s,itemCount:r,timestamp:n})}}catch(e){}}return t.sort((e,t)=>t.timestamp-e.timestamp)}catch(e){return be.error("Failed to get all sites from IndexedDB:",e),[]}}async getAllDatabases(){try{if("undefined"!=typeof indexedDB&&indexedDB.databases){const e=(await indexedDB.databases()).map(e=>e.name).filter(e=>e&&e.startsWith("media_"));return be.debug("Found databases via indexedDB.databases():",e),e}return be.warn("indexedDB.databases() not supported in this browser"),[]}catch(e){return be.error("Failed to get all databases:",e),[]}}async deleteSite(e){switch(this.type){case"indexeddb":return this.deleteSiteFromIndexedDB(e);case"none":return Promise.resolve();default:throw new Error(`Unsupported storage type: ${this.type}`)}}async deleteSiteFromIndexedDB(e){try{const t=`media_${this.normalizeSiteKey(e)}`;await new Promise((e,i)=>{const a=indexedDB.deleteDatabase(t);a.onsuccess=()=>{be.info(`Successfully deleted database: ${t}`),e()},a.onerror=()=>{be.error(`Failed to delete database: ${t}`,a.error),i(a.error)},a.onblocked=()=>{be.warn(`Database deletion blocked: ${t}`),i(new Error("Database deletion blocked - please close other tabs and try again"))}})}catch(t){throw be.error("Failed to delete site from IndexedDB:",t),t}}async saveScanMetadata(e){switch(this.type){case"indexeddb":return this.saveScanMetadataToIndexedDB(e);case"none":return Promise.resolve();default:throw new Error(`Unsupported storage type: ${this.type}`)}}async removeMediaForPages(e){switch(this.type){case"indexeddb":return this.removeMediaForPagesFromIndexedDB(e);case"none":return Promise.resolve();default:throw new Error(`Unsupported storage type: ${this.type}`)}}async removeMediaForPagesFromIndexedDB(e){try{const t=await this.ensureDatabase();return t.objectStoreNames.contains("media")?new Promise((i,a)=>{const s=t.transaction(["media"],"readwrite").objectStore("media").openCursor();s.onsuccess=t=>{const a=t.target.result;if(!a)return void i();const s=a.value;e.includes(s.doc)&&a.delete(),a.continue()},s.onerror=()=>{a(s.error)}}):Promise.resolve()}catch(t){throw be.error("Failed to remove media for pages from IndexedDB:",t),t}}async loadScanMetadata(){return"indexeddb"===this.type?this.loadScanMetadataFromIndexedDB():null}async saveScanMetadataToIndexedDB(e){try{const t=await this.ensureDatabase();return t.objectStoreNames.contains("last-modified-data")?new Promise((i,a)=>{const s=t.transaction(["last-modified-data"],"readwrite").objectStore("last-modified-data"),r=s.get(this.siteKey||"default");r.onsuccess=()=>{const t=r.result||{},n={...t.pageLastModified,...e.pageLastModified},o={siteKey:this.siteKey||"default",...t,...e,pageLastModified:n,timestamp:Date.now()},l=s.put(o);l.onsuccess=()=>i(),l.onerror=()=>{a(l.error)}},r.onerror=()=>{a(r.error)}}):(be.warn("Last modified data object store does not exist, cannot save metadata"),Promise.resolve())}catch(t){throw be.error("Failed to save scan metadata to IndexedDB:",t),t}}async loadScanMetadataFromIndexedDB(){try{const e=await this.ensureDatabase();return e.objectStoreNames.contains("last-modified-data")?new Promise(t=>{const i=e.transaction(["last-modified-data"],"readonly").objectStore("last-modified-data").get(this.siteKey||"default");i.onsuccess=()=>{const{result:e}=i;t(e||null)},i.onerror=()=>{be.warn("Failed to get scan metadata from IndexedDB:",i.error),t(null)}}):null}catch(e){return be.warn("Failed to load scan metadata from IndexedDB:",e),null}}async clearAllSites(){try{const e=await this.getAllSites();for(const t of e)await this.deleteSiteFromIndexedDB(t.siteKey);be.info(`Cleared all ${e.length} sites from IndexedDB`)}catch(e){throw be.error("Failed to clear all sites:",e),e}}}function Se(e="indexeddb",t=null){return"r2"===e?new we(e,t):new xe(e,t)}const Ce=Object.freeze(Object.defineProperty({__proto__:null,BrowserStorage:xe,createStorage:Se,default:xe},Symbol.toStringTag,{value:"Module"})),Ae={version:"2.0",lastUpdated:"2024-01-15",confidence:{thresholds:{high:8,medium:6,low:4}},categories:{screenshots:{description:"App interfaces, software demos, and UI previews",keywords:{filename:["screenshot-","screen-","demo-","ui-","interface-","app-","software-","mockup-","preview-","dashboard-"],context:["screenshot","screen","demo","ui","interface","app","software","mockup","preview","dashboard","application","feature-section","release-notes","feature","update","change","improvement","fix","bug","enhancement","adobe","microsoft","google","apple","documentation","guide","tutorial","help","manual","technical","development","programming","code"],alt:["screenshot","screen","demo","ui","interface","app","software","mockup","preview","dashboard","application","feature","update","change","improvement","fix","bug","enhancement","technical","development","programming","code"],position:["demo","preview","below-fold","feature-section","documentation","guide","tutorial","help","manual"]},negativeIndicators:{filename:["logo-","brand-","team-","person-","headshot-","portrait-","product-","catalog-"],context:["logo","brand","team","staff","person","headshot","portrait","product","catalog","award","winner","announcement","partner","executive","leadership"],alt:["logo","brand","team","person","headshot","portrait","product","catalog","award","winner","announcement","partner","executive","leadership"]},dimensions:{minAspectRatio:1.3,minPixels:1e5},confidence:{high:4,medium:2,low:1}},logos:{description:"Brand logos, company symbols, and identity elements",keywords:{filename:["logo-","brand-","identity-","trademark-","watermark-","symbol-","emblem-","badge-","icon-"],context:["logo","brand","identity","trademark","watermark","symbol","emblem","badge","header","footer","navigation","branding"],alt:["logo","brand","identity","trademark","watermark","symbol","emblem","badge"],position:["header","footer","brand","navigation"]},negativeIndicators:{filename:["screenshot-","team-","person-","headshot-","portrait-","product-","catalog-"],context:["screenshot","team","staff","person","headshot","portrait","product","catalog","interface"],alt:["screenshot","team","person","headshot","portrait","product","catalog","interface"]},dimensions:{maxPixels:1e5,minAspectRatio:.4,maxAspectRatio:2.5},confidence:{high:7,medium:5,low:3}},"people-photos":{description:"Team photos, headshots, professional portraits, and testimonials",keywords:{filename:["team-","staff-","member-","person-","headshot-","portrait-","profile-","about-","people-","executive-","ceo-","cto-","director-","manager-","testimonial-","customer-","client-","review-"],context:["team","staff","member","person","headshot","portrait","about","people","leadership","executive","team-section","about-section","testimonial","testimonials","customer","customers","client","clients","review","reviews","feedback","quote","quotes","endorsement","endorsements","recommendation","recommendations"],alt:["team","staff","member","person","headshot","portrait","about","people","CEO","CTO","Manager","Director","Executive","Leader","Head","Chief","testimonial","customer","client","review","feedback","quote","endorsement","recommendation"],position:["below-fold","about-section","team-section","team","content","article","testimonial-section","testimonials","reviews-section","feedback-section"]},negativeIndicators:{filename:["screenshot-","logo-","brand-","product-","catalog-","demo-","ui-","interface-","app-","software-","release-","feature-","update-","change-","improvement-","fix-","bug-","enhancement-"],context:["screenshot","logo","brand","product","catalog","interface","demo","release-notes","feature","update","change","improvement","fix","bug","enhancement","adobe","microsoft","google","apple","documentation","guide","tutorial","help","manual","technical","development","programming","code","software","application","app","ui","ux"],alt:["screenshot","logo","brand","product","catalog","interface","demo","release-notes","feature","update","change","improvement","fix","bug","enhancement","adobe","microsoft","google","apple","documentation","guide","tutorial","help","manual","technical","development","programming","code","software","application","app","ui","ux"]},dimensions:{maxAspectRatio:1.5,minPixels:5e4},confidence:{high:8,medium:6,low:4}},products:{description:"Product photos, catalog images, and merchandise",keywords:{filename:["product-","item-","catalog-","inventory-","merchandise-","feature-","shop-","store-","ecommerce-"],context:["product","catalog","inventory","merchandise","feature","shop","store","e-commerce","gallery","product-section"],alt:["product","item","catalog","inventory","merchandise","feature","shop","store"],position:["product-section","catalog","below-fold","gallery"]},negativeIndicators:{filename:["screenshot-","logo-","brand-","team-","person-","headshot-","portrait-","demo-","ui-","interface-","app-","software-","release-","update-","change-","improvement-","fix-","bug-","enhancement-"],context:["screenshot","logo","brand","team","staff","person","headshot","portrait","interface","demo","release-notes","feature","update","change","improvement","fix","bug","enhancement","adobe","microsoft","google","apple","documentation","guide","tutorial","help","manual","technical","development","programming","code","software","application","app","ui","ux"],alt:["screenshot","logo","brand","team","person","headshot","portrait","interface","demo","release-notes","feature","update","change","improvement","fix","bug","enhancement","adobe","microsoft","google","apple","documentation","guide","tutorial","help","manual","technical","development","programming","code","software","application","app","ui","ux"]},dimensions:{minPixels:5e4},confidence:{high:7,medium:5,low:3}},"404-media":{keywords:{filename:[],context:[],alt:[],position:[]},confidence:{high:1,medium:1,low:1},description:"Images that return 404 errors or other HTTP errors"}}};let ke=null;function Ie(){if(ke)return ke;try{return ke=null!==Ae?Ae:JSON.parse(Ae),ke}catch(e){return null}}function De(e,t){return e>=t.high?"high":e>=t.medium?"medium":e>=t.low?"low":"none"}function Pe(e,t,i,a,s,r,n=0,o=0){let l=0;const{keywords:c}=t;if(c.filename&&(l+=3*c.filename.filter(e=>i.includes(e.toLowerCase())).length),c.context&&(l+=2.5*c.context.filter(e=>a.includes(e.toLowerCase())).length),c.alt&&(l+=2*c.alt.filter(e=>s.includes(e.toLowerCase())).length),c.position&&(l+=2*c.position.filter(e=>r.includes(e.toLowerCase())).length),t.negativeIndicators){const e=function(e,t,i,a){let s=0;const r=t.toLowerCase(),n=i.toLowerCase(),o=a.toLowerCase();return e.filename&&(s+=2*e.filename.filter(e=>r.includes(e.toLowerCase())).length),e.context&&(s+=1.5*e.context.filter(e=>n.includes(e.toLowerCase())).length),e.alt&&(s+=1.5*e.alt.filter(e=>o.includes(e.toLowerCase())).length),s}(t.negativeIndicators,i,a,s);l-=e}if(n>0&&o>0&&(l+=1.5*function(e,t,i,a){const s=i/a,r=i*a;return t.dimensions?function(e,t,i){let a=0;return e.minAspectRatio&&t<e.minAspectRatio&&(a-=2),e.maxAspectRatio&&t>e.maxAspectRatio&&(a-=2),e.minPixels&&i<e.minPixels&&(a-=2),e.maxPixels&&i>e.maxPixels&&(a-=2),(!e.minAspectRatio||t>=e.minAspectRatio)&&(!e.maxAspectRatio||t<=e.maxAspectRatio)&&(!e.minPixels||i>=e.minPixels)&&(!e.maxPixels||i<=e.maxPixels)&&(a+=2),a}(t.dimensions,s,r):function(e,t,i){const a=t/i,s=Math.abs(a-1)<.1,r=a<.8,n=a>1.2;switch(e){case"logos":if(s||n)return 2;if(r)return-1;break;case"screenshots":if(n)return 2;if(s)return 1;if(r)return-2;break;case"people-photos":if(r||s)return 2;if(n)return 0;break;case"products":if(s||n)return 1;if(r)return 0;break;default:return 0}return 0}(e,i,a)}(e,t,n,o)),"people-photos"===e){const e=function(e){if(!e)return 0;let t=0;const i=e.toLowerCase();return["profile photo","headshot","portrait","team photo","staff photo","person","people","man","woman","child","baby"].some(e=>i.includes(e))&&(t+=4),[/^[a-z]+ [a-z]+$/,/^(mr|ms|dr|prof)\. [a-z]+/,/[a-z]+, (ceo|cto|manager|director|founder|president)/,/(ceo|cto|manager|director|founder|president) [a-z]+/,/profile photo for [a-z]+ [a-z]+/i,/photo of [a-z]+ [a-z]+/i,/headshot of [a-z]+ [a-z]+/i].some(e=>e.test(i))&&(t+=3),["ceo","cto","manager","director","founder","president","team","staff","employee","worker","professional"].some(e=>i.includes(e))&&(t+=2),["photo","picture","image","headshot","portrait"].some(e=>i.includes(e))&&(t+=1),Math.min(t,6)}(s)+function(e){if(!e)return 0;let t=0;const i=e.toLowerCase();return["team","staff","employees","workers","professionals","leadership","management","founders","co-founders"].some(e=>i.includes(e))&&(t+=3),["people","person","individual","member","colleague","partner","associate","representative"].some(e=>i.includes(e))&&(t+=2),["about us","our team","meet the team","leadership team","company","organization","business","corporate"].some(e=>i.includes(e))&&(t+=2),Math.min(t,5)}(a);l+=2*e}if("screenshots"===e){const e=function(e,t){if(!e&&!t)return 0;let i=0;const a=`${e||""} ${t||""}`.toLowerCase();return["screenshot","interface","ui","ux","design","mockup","wireframe","prototype","demo","preview","example","application","app","software","program","system","dashboard","admin","panel","control","settings","configuration","setup","installation","deployment"].some(e=>a.includes(e))&&(i+=3),["development","coding","programming","development","frontend","backend","api","database","server","framework","library","tool","utility"].some(e=>a.includes(e))&&(i+=2),Math.min(i,5)}(a,s);l+=3*e}const d=function(e,t,i){if(!t&&!i)return 0;let a=0;const s=`${t||""} ${i||""}`.toLowerCase();switch(e){case"screenshots":(s.includes("screenshot")||s.includes("interface"))&&(a+=2);break;case"logos":(s.includes("logo")||s.includes("brand"))&&(a+=2);break;case"people-photos":(s.includes("team")||s.includes("staff")||s.includes("testimonial")||s.includes("customer")||s.includes("client"))&&(a+=2);break;case"products":(s.includes("product")||s.includes("item"))&&(a+=2)}return Math.min(a,3)}(e,a,s);return l+=2*d,Math.max(0,l)}function Te(e,t="",i="",a="",s=0,r=0){const n=Ie();if(!n||!n.categories)return{category:"other",confidence:"none",score:0,source:"fallback"};const o=e.toLowerCase(),l=t.toLowerCase(),c=i.toLowerCase(),d=a.toLowerCase(),h=["screenshots","logos","people-photos","products","404-media"];for(const u of h){const e=n.categories[u];if(e){const t=Pe(u,e,o,l,c,d,s,r),i=De(t,e.confidence);if("high"===i)return{category:u,confidence:i,score:t,source:"hierarchical-detection"};if("medium"===i&&t>0)return{category:u,confidence:i,score:t,source:"hierarchical-detection"}}}return{category:"other",confidence:"low",score:0,source:"fallback"}}const _e={enabled:!0,extractEXIF:!0,extractDimensions:!0,categorizeFromFilename:!0,analyzeUsage:!0},Me=new Map;async function Ee(e,t=null,i=""){if(!_e.enabled)return{orientation:"unknown",category:"other",width:0,height:0,confidence:"none",source:"basic"};try{if(t&&!(await async function(e,t){try{const i=await fetch(e,{method:"HEAD"}),a=i.headers.get("ETag"),s=i.headers.get("Last-Modified");return a!==t.etag||s!==t.lastModified}catch(i){return!0}}(e,t)))return t;const a=await async function(e,t=""){const i={source:"analysis",confidence:"low"};if(_e.extractDimensions){const t=await async function(e){return new Promise(t=>{const i=new Image;i.onload=function(){t({width:this.naturalWidth,height:this.naturalHeight})},i.onerror=()=>t({width:0,height:0}),i.src=e})}(e);i.width=t.width,i.height=t.height,i.orientation=t.width>t.height?"landscape":"portrait"}if(_e.categorizeFromFilename){const a=Te(e,t,"","",i.width,i.height);i.category=a.category,i.categoryConfidence=a.confidence,i.categoryScore=a.score,i.categorySource=a.source,"high"===a.confidence?i.confidence="high":"medium"===a.confidence&&"low"===i.confidence&&(i.confidence="medium")}if(_e.extractEXIF){const t=await async function(e){try{const t=await Promise.resolve().then(()=>ys),i=await fetch(e);if(!i.ok)return{error:!0,errorType:404===i.status?"404":"http_error",errorMessage:`HTTP ${i.status}`,statusCode:i.status};const a=await i.blob(),s=await t.parse(a,{pick:["Make","Model","DateTime"]});if(!s)return null;let r=null;const n=s.Make,o=s.Model;return n&&o&&"undefined"!==n&&"undefined"!==o?r=`${n} ${o}`.trim():n&&"undefined"!==n?r=n.trim():o&&"undefined"!==o&&(r=o.trim()),{camera:r,dateTime:s.DateTime}}catch(t){return{error:!0,errorType:"parse_error",errorMessage:t.message,statusCode:null}}}(e);t&&(t.error?i.exifError=t:(i.exifCamera=t.camera,i.exifDate=t.date,(t.camera||t.date)&&(i.confidence="high")))}return i}(e,i),s=await async function(e){try{const t=await fetch(e),i=await t.arrayBuffer(),a=await crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(a)).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(t){return e}}(e);return Me.set(s,a),a}catch(a){return{orientation:"unknown",category:"other",width:0,height:0,confidence:"none",source:"basic"}}}function $e(e){Object.assign(_e,e)}function Le(){Me.clear()}"undefined"!=typeof window&&(window.clearAnalysisCache=Le);class Fe{constructor(e={}){this.throttleDelay=50,this.maxConcurrency=20,this.corsProxy=e.corsProxy||"https://media-library-cors-proxy.aem-poc-lab.workers.dev/",this.enableImageAnalysis=e.enableImageAnalysis||!1,this.enableCategorization=!1!==e.enableCategorization,this.analysisConfig=e.analysisConfig||{},this.categorizationConfig=e.categorizationConfig||{},this.latestMediaItems=[],this.occurrenceCounters=new Map,this.enableImageAnalysis&&$e({enabled:!0,...this.analysisConfig})}setImageAnalysis(e,t={}){this.enableImageAnalysis=e,this.analysisConfig=t,$e(e?{enabled:!0,...t}:{enabled:!1})}getImageAnalysisConfig(){return{enabled:this.enableImageAnalysis,config:this.analysisConfig,analysisConfig:{..._e}}}async scanPages(e,t,i=null){const a=[];let s=0;this.latestMediaItems=[];const r=i?this.filterChangedUrls(e,i):e;for(const o of r)try{const e=await this.scanPage(o);s+=1,this.latestMediaItems=e,t&&t(s,r.length,e.length),a.push(...e)}catch(n){s+=1,this.latestMediaItems=[],t&&t(s,r.length,0)}return a}getLatestMediaItems(){return this.latestMediaItems}async scanPage(e){try{const t=`${this.corsProxy}?url=${encodeURIComponent(e.loc)}`,i=await fetch(t,{redirect:"manual"});if(!i.ok)throw new Error(`Failed to fetch page: ${i.status}`);const a=await i.text(),s=(new DOMParser).parseFromString(a,"text/html"),r=[],n=new Date(e.lastmod).getTime(),o=s.querySelectorAll("img"),l=await Promise.all([...o].map(async t=>{const i=t.getAttribute("src"),a=t.getAttribute("data-src")||t.getAttribute("data-lazy-src")||t.getAttribute("data-original")||t.getAttribute("data-sling-src")||t.getAttribute("data-responsive-src"),s=i||a;if(!s||!s.trim()||!this.isMediaFile(s))return null;const r=this.getFileExtension(s),o=this.resolveUrl(s,e.loc),l=new URL(e.loc).hostname,c=this.fixLocalhostUrl(o,l),d=this.getCleanFilename(s),h=parseInt(t.getAttribute("width"),10)||0,u=parseInt(t.getAttribute("height"),10)||0,p={url:c,name:d,alt:t.alt||"null",type:`img > ${r}`,doc:e.loc,ctx:this.captureContext(t,"img"),hash:this.createUniqueHash(s,e.loc,t.alt,this.getOccurrenceIndex(s,e.loc)),firstUsedAt:n,lastUsedAt:n,domWidth:h,domHeight:u};if(this.enableCategorization)try{const e=Te(c,p.ctx,p.alt,"",h,u);p.category=e.category,p.categoryConfidence=e.confidence,p.categoryScore=e.score,p.categorySource=e.source}catch(g){p.category="other",p.categoryConfidence="none",p.categoryScore=0,p.categorySource="fallback"}if(this.enableImageAnalysis)try{const e=await Ee(c,null,p.ctx);p.orientation=e.orientation,p.width=e.width,p.height=e.height,p.exifCamera=e.exifCamera,p.exifDate=e.exifDate,p.analysisConfidence=e.confidence,e.category&&(p.category=e.category,p.categoryConfidence=e.categoryConfidence,p.categoryScore=e.categoryScore,p.categorySource=e.categorySource),e.exifError&&(p.hasError=!0,p.errorType=e.exifError.errorType,p.errorMessage=e.exifError.errorMessage,p.statusCode=e.exifError.statusCode,"404"===e.exifError.errorType&&(p.category="404-media"))}catch(g){}return!this.enableImageAnalysis&&h>0&&u>0&&(p.orientation=h>u?"landscape":"portrait",p.width=h,p.height=u),p}));return r.push(...l.filter(e=>null!==e)),s.querySelectorAll("video").forEach(t=>{if(t.src&&this.isMediaFile(t.src)){const i=this.resolveUrl(t.src,e.loc),a=new URL(e.loc).hostname,s=this.fixLocalhostUrl(i,a);r.push({url:s,name:this.getCleanFilename(t.src),alt:"",type:`video > ${this.getFileExtension(t.src)}`,doc:e.loc,ctx:this.captureContext(t,"video"),hash:this.createUniqueHash(t.src,e.loc,"",this.getOccurrenceIndex(t.src,e.loc)),firstUsedAt:n,lastUsedAt:n})}}),s.querySelectorAll("video source").forEach(t=>{if(t.src&&this.isMediaFile(t.src)){const i=this.resolveUrl(t.src,e.loc),a=new URL(e.loc).hostname,s=this.fixLocalhostUrl(i,a);r.push({url:s,name:this.getCleanFilename(t.src),alt:"",type:`video-source > ${this.getFileExtension(t.src)}`,doc:e.loc,ctx:this.captureContext(t,"video-source"),hash:this.createUniqueHash(t.src,e.loc,"",this.getOccurrenceIndex(t.src,e.loc)),firstUsedAt:n,lastUsedAt:n})}}),s.querySelectorAll("a[href]").forEach(t=>{const i=t.getAttribute("href");if(i&&this.isMediaFile(i)){const a=this.resolveUrl(i,e.loc),s=new URL(e.loc).hostname,o=this.fixLocalhostUrl(a,s);r.push({url:o,name:this.getCleanFilename(i),alt:t.textContent||"",type:`link > ${this.getFileExtension(i)}`,doc:e.loc,ctx:this.captureContext(t,"link"),hash:this.createUniqueHash(i,e.loc,t.textContent,this.getOccurrenceIndex(i,e.loc)),firstUsedAt:n,lastUsedAt:n})}}),r}catch(t){return[]}}resolveUrl(e,t){if(!e)return null;if(e.startsWith("http://")||e.startsWith("https://"))return e;if(e.startsWith("data:"))return e;try{const i=new URL(t);return new URL(e,i).toString()}catch(i){return e}}captureContext(e,t){const i=[t];e.closest("picture")&&i.push("picture");const a=this.findSemanticParent(e);a&&i.push(`In: ${a}`);const s=this.findContainerClasses(e);s&&i.push(`In: ${s}`);const r=this.getNearbyText(e);if(r&&i.push(`text: ${r}`),1===i.length){const t=this.getParagraphContext(e);t&&i.push(`paragraph: ${t}`)}return i.join(" > ")}findContainerClasses(e){let t=e.parentElement,i=0;for(;t&&i<3;){const e=t.getAttribute("class");if(e){const t=e.split(" ").filter(e=>e.trim()&&e.length>3).filter(e=>e.includes("section")||e.includes("container")||e.includes("content")||e.includes("wrapper")||e.includes("block")||e.includes("main")||e.includes("header")||e.includes("footer")||e.includes("nav")||e.includes("article")||e.includes("aside")||e.includes("gallery"));if(t.length>0)return t.slice(0,2).join(" ")}t=t.parentElement,i+=1}return null}findSemanticParent(e){var t;let i=e.parentElement,a=0;for(;i&&a<5;){const e=null==(t=i.tagName)?void 0:t.toLowerCase();if(["article","section","aside","header","footer","nav","main"].includes(e))return e;i=i.parentElement,a+=1}return null}getParagraphContext(e){var t,i;let a=e.parentElement,s=0;for(;a&&s<3;){if("p"===(null==(t=a.tagName)?void 0:t.toLowerCase())){const e=null==(i=a.textContent)?void 0:i.trim();if(e&&e.length>20&&e.length<200)return e.substring(0,50)+(e.length>50?"...":"")}a=a.parentElement,s+=1}return null}getNearbyText(e){var t;const i=e.parentElement;if(!i)return null;const a=Array.from(i.children||[]);for(const r of a)if(r!==e&&r.textContent){const e=r.textContent.trim();if(e.length>10&&e.length<100)return e}const s=null==(t=i.textContent)?void 0:t.trim();return s&&s.length>10?s.length<=200?s:s.substring(0,20):null}isMediaFile(e){if(!e||"string"!=typeof e)return!1;const t=this.getFileExtension(e);return t&&["jpg","jpeg","png","gif","webp","svg","avif","bmp","tiff","ico","mp4","webm","mov","avi","mkv","flv","wmv","m4v","pdf","doc","docx","txt","rtf","mp3","wav","ogg","aac","flac","m4a"].includes(t.toLowerCase())}getFileExtension(e){var t;if(!e)return"";try{const i=e.split(/[?#]/)[0],a=(null==(t=i.split(".").pop())?void 0:t.toLowerCase())||"";return!a||a===i||/[^a-z0-9]/.test(a)?"":a}catch(i){return""}}getCleanFilename(e){if(!e)return"";try{return e.split(/[?#]/)[0].split("/").pop()||""}catch(t){return""}}fixLocalhostUrl(e,t){if(!e||!t)return e;if(e.includes("localhost:"))try{const i=new URL(e);return`https://${t}${i.pathname+i.search}`}catch(i){return e}return e}normalizeUrlForHash(e){if(!e)return"";try{return e.split(/[?#]/)[0]}catch(t){return e}}getOccurrenceIndex(e,t){const i=`${e}_${t}`,a=this.occurrenceCounters.get(i)||0;return this.occurrenceCounters.set(i,a+1),a}createUniqueHash(e,t,i="",a=0){const s=this.normalizeUrlForHash(e)+i+t+`_${a}`;return this.createHash(s)}createHash(e){let t=0;if(0===e.length)return t.toString(36).padStart(10,"0");for(let i=0;i<e.length;i+=1)t=(33*t+e.charCodeAt(i))%2147483647;return Math.abs(t).toString(36).padStart(10,"0")}filterChangedUrls(e,t){if(!t||!t.pageLastModified)return e;const i=[],{pageLastModified:a}=t;for(const s of e){const e=a[s.loc];e&&s.lastmod&&s.lastmod===e||i.push(s)}return i}testHtmlParsing(e){const t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("img");return t.forEach(e=>{this.captureContext(e,"img")}),t.length}}function Ue(e){if(!e)return"";try{const t=new URL(e),{pathname:i}=t,a=i.split("/").pop();return a&&a.includes("media_")?a:i}catch{return e}}function Oe(e){const t=e.type||"";if(t.startsWith("img >"))return"image";if(t.startsWith("video >"))return"video";if(t.startsWith("document >"))return"document";if(t.startsWith("link >"))return"link";const i=e.url||"";var a,s,r;return r=null==(s=null==(a=i)?void 0:a.split(".").pop())?void 0:s.toLowerCase(),["jpg","jpeg","png","gif","webp","svg","avif"].includes(r)?"image":["mp4","webm","mov","avi"].includes(r)?"video":["pdf"].includes(r)?"document":["mp3","wav"].includes(r)?"audio":"unknown"}function Re(e){const t=e.type||"";return"img > svg"===t||"link > svg"===t}function Ne(e,t){if(!e.ctx)return!1;const i=e.ctx.match(/perf:([^>]+)/);if(!i)return!1;const a=i[1].split(",").map(e=>e.trim().toLowerCase());return a.includes(t.toLowerCase())}"undefined"!=typeof window&&(window.clearAnalysisCache=Le);const Be={images:e=>"image"===Oe(e)&&!Re(e),videos:e=>"video"===Oe(e),documents:e=>"document"===Oe(e),links:e=>"link"===Oe(e),icons:e=>Re(e),missingAlt:e=>{var t,i;return(null==(t=e.type)?void 0:t.startsWith("img >"))&&!(null==(i=e.type)?void 0:i.includes("svg"))&&"null"===e.alt},decorative:e=>{var t,i;return(null==(t=e.type)?void 0:t.startsWith("img >"))&&!(null==(i=e.type)?void 0:i.includes("svg"))&&""===e.alt},filled:e=>{var t,i;return(null==(t=e.type)?void 0:t.startsWith("img >"))&&!(null==(i=e.type)?void 0:i.includes("svg"))&&e.alt&&""!==e.alt&&"null"!==e.alt},unused:e=>!e.doc||""===e.doc.trim(),landscape:e=>"image"===Oe(e)&&!Re(e)&&"landscape"===e.orientation,portrait:e=>"image"===Oe(e)&&!Re(e)&&"portrait"===e.orientation,square:e=>"image"===Oe(e)&&!Re(e)&&"square"===e.orientation,lcpCandidate:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"lcp-candidate"),aboveFold:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"above-fold"),belowFold:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"below-fold"),needsOptimization:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"needs-optimization"),fullyOptimized:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"fully-optimized"),noSrcset:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"no-srcset"),hasSrcset:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"has-srcset"),legacyFormat:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"legacy-format"),modernFormat:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"modern-format"),noLazyLoading:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"no-loading-strategy"),lazyLoading:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"lazy-loading"),socialImage:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"social-image"),ogImage:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"og-image"),performanceIssue:e=>"image"===Oe(e)&&!Re(e)&&Ne(e,"performance-issue"),screenshots:e=>"image"===Oe(e)&&!Re(e)&&"screenshots"===e.category,logos:e=>"image"===Oe(e)&&!Re(e)&&"logos"===e.category,"people-photos":e=>"image"===Oe(e)&&!Re(e)&&"people-photos"===e.category,products:e=>"image"===Oe(e)&&!Re(e)&&"products"===e.category,"404-media":e=>"image"===Oe(e)&&!Re(e)&&"404-media"===e.category,documentImages:(e,t)=>Be.images(e)&&e.doc===t,documentIcons:(e,t)=>Be.icons(e)&&e.doc===t,documentVideos:(e,t)=>Be.videos(e)&&e.doc===t,documentDocuments:(e,t)=>Be.documents(e)&&e.doc===t,documentLinks:(e,t)=>Be.links(e)&&e.doc===t,documentMissingAlt:(e,t)=>{var i,a;return(null==(i=e.type)?void 0:i.startsWith("img >"))&&!(null==(a=e.type)?void 0:a.includes("svg"))&&"null"===e.alt&&e.doc===t},documentDecorative:(e,t)=>{var i,a;return(null==(i=e.type)?void 0:i.startsWith("img >"))&&!(null==(a=e.type)?void 0:a.includes("svg"))&&""===e.alt&&e.doc===t},documentFilled:(e,t)=>{var i,a;return e.doc===t&&(null==(i=e.type)?void 0:i.startsWith("img >"))&&!(null==(a=e.type)?void 0:a.includes("svg"))&&e.alt&&""!==e.alt&&"null"!==e.alt},documentTotal:()=>!0,all:e=>!Re(e)};function ze(e,t,i){const a=Be[t];return a?t.startsWith("document")?e.filter(e=>a(e,i)):e.filter(a):e}function Ve(){return function(){const e=Ie();return e&&e.categories?Object.keys(e.categories):["other"]}().filter(e=>"other"!==e)}function je(e){if(!e)return null;const t=e.match(/^([a-zA-Z]+):(.*)$/);if(t){const[,i,a]=t;return{field:i.toLowerCase(),value:a.trim().toLowerCase(),originalQuery:e}}return e.startsWith("/")||e.includes("/")?{field:"folder",value:e.toLowerCase().trim(),originalQuery:e}:null}function He(e,t){const{field:i,value:a}=t;return e.filter(e=>{switch(i){case"doc":{if(!e.doc)return!1;let t=e.doc;try{t=new URL(e.doc).pathname}catch{t=e.doc}return t.toLowerCase().includes(a)||e.doc.toLowerCase().includes(a)}case"name":return e.name&&e.name.toLowerCase().includes(a);case"alt":return e.alt&&e.alt.toLowerCase().includes(a);case"url":return e.url&&e.url.toLowerCase().includes(a);case"folder":{if(!e.doc)return!1;let t=e.doc;try{t=new URL(e.doc).pathname}catch{t=e.doc}if(""===a||"/"===a)return!t.includes("/",1);const i=t.replace(/\.html$/,"").split("/");return i.length>2&&i.slice(0,-1).join("/")===(a.startsWith("/")?a:`/${a}`)}case"perf":{if(!e.ctx)return!1;const t=e.ctx.match(/perf:([^>]+)/);if(!t)return!1;const i=t[1].split(",").map(e=>e.trim().toLowerCase()),s=a.toLowerCase();return i.some(e=>e===s||e.includes(s)||s.includes(e))}default:return!1}})}function Ge(e,t){if(!t||""===t.trim())return e;const i=t.toLowerCase().trim();return e.filter(e=>!!(e.name&&e.name.toLowerCase().includes(i)||e.alt&&e.alt.toLowerCase().includes(i)||e.doc&&e.doc.toLowerCase().includes(i)||e.ctx&&e.ctx.toLowerCase().includes(i)||e.url&&e.url.toLowerCase().includes(i)))}function We(e,t,i,a){if(!e||0===e.length)return[];let s=[...e];if(i&&i.trim()){const e=je(i);s=e?He(s,e):Ge(s,i)}return t&&"all"!==t&&(s=ze(s,t,a)),s}function qe(e,t,i,a,s){if(!e||0===e.length||!t)return[];let r=[...e];if(a&&a.trim()){const e=je(a);r=e?He(r,e):Ge(r,a)}if(i&&"all"!==i){const e=t.filterArrays[i]||[],a=new Set(e);r=s&&i.startsWith("document")?r.filter(e=>a.has(e.hash)&&e.doc===s):r.filter(e=>a.has(e.hash))}return r}function Ke(e){return e.name||e.url||e.doc?Re(e)?null:{type:"media",value:e,display:e.name||e.url||"Unnamed Media",details:{alt:e.alt,doc:e.doc,url:e.url,type:Oe(e)}}:null}function Qe(e,t,i,a=10){if(!t||!t.trim()||!e)return[];const s=[],r=new Set;let n=0;const o=je(t);if(o){const{field:t,value:l}=o;if("folder"===t)return function(e,t){const i=new Set;return e.forEach(e=>{if(e.doc){let t=e.doc;try{t=new URL(e.doc).pathname}catch{t=e.doc}const a=t.replace(/\.html$/,"").split("/");if(a.length>2)for(let e=1;e<a.length-1;e+=1){const t=a.slice(0,e+1).join("/");i.add(t)}else 2===a.length&&i.add("/")}}),Array.from(i).filter(e=>{if(""===t||"/"===t)return!0;const i=t.startsWith("/")?t:`/${t}`;return e.startsWith(i)}).map(e=>({type:"folder",value:e,display:e})).slice(0,10)}(e,l);for(const o of e){if(n>=1e3)break;switch(n+=1,t){case"doc":o.doc&&o.doc.toLowerCase().includes(l)&&r.add(o.doc);break;case"alt":if(o.alt&&o.alt.toLowerCase().includes(l)&&!Re(o)&&(s.push(i(o)),s.length>=a))break;break;case"name":if(o.name&&o.name.toLowerCase().includes(l)&&!Re(o)&&(s.push(i(o)),s.length>=a))break;break;case"url":if(o.url&&o.url.toLowerCase().includes(l)&&!Re(o)&&(s.push(i(o)),s.length>=a))break}}return[...Array.from(r).map(e=>({type:"doc",value:e,display:e})),...s].slice(0,a)}const l=t.toLowerCase().trim();if("/"===l){for(const t of e){if(s.length>=a)break;t.doc&&!t.doc.includes("/",1)&&s.push(i(t))}return s.slice(0,a)}for(const c of e){if(n>=1e3)break;if(n+=1,c.doc&&c.doc.toLowerCase().includes(l)&&r.add(c.doc),!Re(c)&&(c.name&&c.name.toLowerCase().includes(l)||c.alt&&c.alt.toLowerCase().includes(l)||c.url&&c.url.toLowerCase().includes(l))&&(s.push(i(c)),s.length>=a))break}return[...Array.from(r).map(e=>({type:"doc",value:e,display:e})),...s].slice(0,a)}let Xe=null,Ye=null;function Je(){const e={};return Object.keys(Be).forEach(t=>{t.startsWith("document")||(e[t]=[])}),{filterArrays:e,usageData:{},searchIndex:{name:{},alt:{},doc:{},ctx:{},url:{}},filterCounts:{},totalCount:0}}async function Ze(e,t=null){if(!e||0===e.length)return Je();const i=function(e){if(!e||0===e.length)return"";const{length:t}=e,i=e[0],a=e[t-1];return`${t}-${(null==i?void 0:i.url)||""}-${(null==a?void 0:a.url)||""}`}(e);if(Xe&&Ye===i)return Xe;const a=Je(),s=new Set,r=new Set,n=function(e,t){const i=[];for(let a=0;a<e.length;a+=t)i.push(e.slice(a,a+t));return i}(e,e.length>1e5?500:1e3),o=n.length;for(let c=0;c<n.length;c+=1)n[c].forEach(e=>{if(e.hash){if(e.url){const t=Ue(e.url);a.usageData[t]||(a.usageData[t]={hashes:[],uniqueDocs:new Set,count:0}),a.usageData[t].hashes.push(e.hash),e.doc&&a.usageData[t].uniqueDocs.add(e.doc);const i=a.usageData[t];i.count=i.hashes.length}if(e.name){const t=e.name.toLowerCase();a.searchIndex.name[t]||(a.searchIndex.name[t]=[]),a.searchIndex.name[t].push(e.hash)}if(e.alt){const t=e.alt.toLowerCase();a.searchIndex.alt[t]||(a.searchIndex.alt[t]=[]),a.searchIndex.alt[t].push(e.hash)}if(e.doc){const t=e.doc.toLowerCase();a.searchIndex.doc[t]||(a.searchIndex.doc[t]=[]),a.searchIndex.doc[t].push(e.hash)}if(e.ctx){const t=e.ctx.toLowerCase();a.searchIndex.ctx[t]||(a.searchIndex.ctx[t]=[]),a.searchIndex.ctx[t].push(e.hash)}if(e.url){const t=e.url.toLowerCase();a.searchIndex.url[t]||(a.searchIndex.url[t]=[]),a.searchIndex.url[t].push(e.hash)}Object.keys(a.filterArrays).forEach(t=>{try{Be[t](e)&&a.filterArrays[t].push(e.hash)}catch(i){}}),e.url&&(s.add(e.url),Re(e)||r.add(e.url))}}),t&&t((c+1)/o*100),c<n.length-1&&(e.length>1e5&&c%5==0?await new Promise(e=>{setTimeout(e,1)}):await new Promise(e=>{setTimeout(e,0)}));const l=new Map;return e.forEach(e=>{e.hash&&l.set(e.hash,e)}),e.forEach(e=>{if(e.url){const t=Ue(e.url),i=a.usageData[t];e.usageCount=i&&i.count||1}else e.usageCount=1}),Object.keys(a.filterArrays).forEach(e=>{const t=new Set;a.filterArrays[e].forEach(e=>{const i=l.get(e);i&&i.url&&t.add(i.url)}),a.filterCounts[e]=t.size}),a.filterCounts.all=r.size,a.totalCount=s.size,Xe=a,Ye=i,a}function et(e,t){if(e.name){const i=e.name.toLowerCase();t.name[i]||(t.name[i]=[]),t.name[i].includes(e.hash)||t.name[i].push(e.hash)}if(e.alt){const i=e.alt.toLowerCase();t.alt[i]||(t.alt[i]=[]),t.alt[i].includes(e.hash)||t.alt[i].push(e.hash)}if(e.doc){const i=e.doc.toLowerCase();t.doc[i]||(t.doc[i]=[]),t.doc[i].includes(e.hash)||t.doc[i].push(e.hash)}if(e.ctx){const i=e.ctx.toLowerCase();t.ctx[i]||(t.ctx[i]=[]),t.ctx[i].includes(e.hash)||t.ctx[i].push(e.hash)}if(e.url){const i=e.url.toLowerCase();t.url[i]||(t.url[i]=[]),t.url[i].includes(e.hash)||t.url[i].push(e.hash)}}function tt(e,t){Object.keys(t).forEach(i=>{try{Be[i](e)&&(t[i].includes(e.hash)||t[i].push(e.hash))}catch(a){}})}const it=["jpg","jpeg","png","gif","webp","svg","avif"],at=["mp4","webm","mov","avi"],st=["pdf"],rt=["mp3","wav"],nt=[...it,...at,...st,...rt];function ot(e){var t;if(!e)return"";try{const i=e.split(/[?#]/)[0],a=(null==(t=i.split(".").pop())?void 0:t.toLowerCase())||"";return!a||a===i||/[^a-z0-9]/.test(a)?"":a}catch(i){return""}}function lt(e){return it.includes(e)?"img":at.includes(e)?"video":st.includes(e)?"document":rt.includes(e)?"audio":"unknown"}function ct(e){const t=e.type||"";return t.startsWith("img >")?"image":t.startsWith("video >")?"video":t.startsWith("document >")?"document":t.startsWith("link >")?"link":lt(ot(e.url||""))}function dt(e){if(!e)return null;const t=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);if(t)return`https://img.youtube.com/vi/${t[1]}/maxresdefault.jpg`;const i=e.match(/vimeo\.com\/(\d+)/);return i?`https://i.vimeocdn.com/video/${i[1]}_640.jpg`:null}function ht(e){return!!e&&[/(?:youtube\.com\/watch\?v=|youtu\.be\/)/,/vimeo\.com\/(\d+)/].some(t=>t.test(e))}function ut(e){if(!e)return"";try{return new URL(e).pathname}catch{return e}}function pt(e,t){if(!e||!t)return!1;const i=ut(e),a=ut(t);if(i===a)return!0;if((i.startsWith("/")?i:`/${i}`)===(a.startsWith("/")?a:`/${a}`))return!0;const s=i.split("/").pop(),r=a.split("/").pop();return s===r&&s&&r}async function gt(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch image: ${t.status} ${t.statusText}`);const i=await t.blob();let a=i,s=i.type;if(!["image/png","image/gif","image/webp"].includes(i.type)){const e=document.createElement("canvas"),t=e.getContext("2d"),r=new Image;await new Promise((e,t)=>{r.onload=e,r.onerror=t,r.src=URL.createObjectURL(i)}),e.width=r.width,e.height=r.height,t.drawImage(r,0,0),a=await new Promise(t=>{e.toBlob(t,"image/png")}),s="image/png",URL.revokeObjectURL(r.src)}const r=new ClipboardItem({[s]:a});await navigator.clipboard.write([r])}async function ft(e){const t=e.url,i=ct(e);try{return"image"===i?(await gt(t),{heading:"Copied",message:"Image copied to clipboard."}):(await navigator.clipboard.writeText(t),{heading:"Copied",message:"Media URL copied to clipboard."})}catch(a){return{heading:"Error",message:"Failed to copy to clipboard."}}}function mt(e){const t=ot(e);return["jpg","jpeg","png","gif","webp","svg","avif"].includes(t)}function bt(e){const t=ot(e);return["mp4","webm","mov","avi"].includes(t)}function yt(e){return((e,...t)=>{const i=1===e.length?e[0]:t.reduce((t,i,a)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+e[a+1],e[0]);return new n(i,e,s)})([e])}const{I:vt}=re,wt=()=>document.createComment(""),xt=(e,t,i)=>{var a;const s=e._$AA.parentNode,r=void 0===t?e._$AB:t._$AA;if(void 0===i){const t=s.insertBefore(wt(),r),a=s.insertBefore(wt(),r);i=new vt(t,a,e,e.options)}else{const t=i._$AB.nextSibling,n=i._$AM,o=n!==e;if(o){let t;null==(a=i._$AQ)||a.call(i,e),i._$AM=e,void 0!==i._$AP&&(t=e._$AU)!==n._$AU&&i._$AP(t)}if(t!==r||o){let e=i._$AA;for(;e!==t;){const t=e.nextSibling;s.insertBefore(e,r),e=t}}}return i},St=(e,t,i=e)=>(e._$AI(t,i),e),Ct={},At=e=>{e._$AR(),e._$AA.remove()},kt=e=>(...t)=>({_$litDirective$:e,values:t});let It=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,i){this._$Ct=e,this._$AM=t,this._$Ci=i}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};const Dt=(e,t)=>{var i;const a=e._$AN;if(void 0===a)return!1;for(const s of a)null==(i=s._$AO)||i.call(s,t,!1),Dt(s,t);return!0},Pt=e=>{let t,i;do{if(void 0===(t=e._$AM))break;i=t._$AN,i.delete(e),e=t}while(0===(null==i?void 0:i.size))},Tt=e=>{for(let t;t=e._$AM;e=t){let i=t._$AN;if(void 0===i)t._$AN=i=new Set;else if(i.has(e))break;i.add(e),Et(t)}};function _t(e){void 0!==this._$AN?(Pt(this),this._$AM=e,Tt(this)):this._$AM=e}function Mt(e,t=!1,i=0){const a=this._$AH,s=this._$AN;if(void 0!==s&&0!==s.size)if(t)if(Array.isArray(a))for(let r=i;r<a.length;r++)Dt(a[r],!1),Pt(a[r]);else null!=a&&(Dt(a,!1),Pt(a));else Dt(this,e)}const Et=e=>{2==e.type&&(e._$AP??(e._$AP=Mt),e._$AQ??(e._$AQ=_t))};let $t=class extends It{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,i){super._$AT(e,t,i),Tt(this),this.isConnected=e._$AU}_$AO(e,t=!0){var i,a;e!==this.isConnected&&(this.isConnected=e,e?null==(i=this.reconnected)||i.call(this):null==(a=this.disconnected)||a.call(this)),t&&(Dt(this,e),Pt(this))}setValue(e){if(void 0===this._$Ct.strings)this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}};const Lt=()=>new Ft;let Ft=class{};const Ut=new WeakMap,Ot=kt(class extends $t{render(e){return G}update(e,[t]){var i;const a=t!==this.G;return a&&void 0!==this.G&&this.rt(void 0),(a||this.lt!==this.ct)&&(this.G=t,this.ht=null==(i=e.options)?void 0:i.host,this.rt(this.ct=e.element)),G}rt(e){if(this.isConnected||(e=void 0),"function"==typeof this.G){const t=this.ht??globalThis;let i=Ut.get(t);void 0===i&&(i=new WeakMap,Ut.set(t,i)),void 0!==i.get(this.G)&&this.G.call(this.ht,void 0),i.set(this.G,e),void 0!==e&&this.G.call(this.ht,e)}else this.G.value=e}get lt(){var e,t;return"function"==typeof this.G?null==(e=Ut.get(this.ht??globalThis))?void 0:e.get(this.G):null==(t=this.G)?void 0:t.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}}),Rt=new DOMParser;async function Nt({parent:e,paths:t}){return await Promise.all(t.map(async t=>{const i=await async function(e){try{const t=await fetch(e);if(!t.ok)return null;const i=await t.text();return Rt.parseFromString(i,"image/svg+xml").querySelector("svg")}catch(t){return null}}(t);return i&&e&&e.append(i),i}))}class Bt extends me{constructor(){super(),this.searchQuery="",this.currentView="grid",this.locale="en",this.isScanning=!1,this.scanProgress=null,this.isBatchLoading=!1,this.realTimeStats={images:0,pages:0,elapsed:0},this.lastScanDuration=null,this.scanStats=null,this.imageAnalysisEnabled=!1,this.showAnalysisToggle=!0,this.mediaData=[],this.totalPages=0,this.isActuallyScanning=!1,this._suggestions=[],this._activeIndex=-1,this._originalQuery="",this._suppressSuggestions=!1,this._searchDebounceTimeout=null,this._suggestionDebounceTimeout=null,this._lastSearchQuery="",this.searchContainerRef=Lt()}async connectedCallback(){super.connectedCallback(),Nt({parent:this.shadowRoot,paths:["./icons/search.svg","./icons/close.svg","./icons/list.svg","./icons/grid.svg","./icons/refresh.svg","./icons/photo.svg"]}),this.handleOutsideClick=this.handleOutsideClick.bind(this),this.handleClearSearch=this.handleClearSearch.bind(this),document.addEventListener("click",this.handleOutsideClick),window.addEventListener("clear-search",this.handleClearSearch)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("click",this.handleOutsideClick),window.removeEventListener("clear-search",this.handleClearSearch),this._searchDebounceTimeout&&clearTimeout(this._searchDebounceTimeout),this._suggestionDebounceTimeout&&clearTimeout(this._suggestionDebounceTimeout)}handleOutsideClick(e){const t=this.searchContainerRef.value;t&&!t.contains(e.target)&&(this._suggestions=[],this._activeIndex=-1,this._suppressSuggestions=!0)}handleClearSearch(){this.searchQuery="",this._suggestions=[],this._activeIndex=-1,this._suppressSuggestions=!1,this.requestUpdate()}render(){return j`
      <div class="topbar">
        <div class="search-container" ${Ot(this.searchContainerRef)}>
          <div class="search-wrapper">
            <svg class="search-icon">
              <use href="#search"></use>
            </svg>
            <input 
              class="search-input"
              type="text"
              placeholder=${this.isScanning?this.t("mediaLibrary.searchDisabledDuringScan"):this.t("mediaLibrary.searchPlaceholder")}
              .value=${this.searchQuery||""}
              ?disabled=${this.isScanning}
              @input=${this.handleSearchInput}
              @keydown=${this.handleKeyDown}
            />
            ${this.searchQuery?j`
              <button 
                class="clear-button"
                @click=${this.clearSearch}
                aria-label=${this.t("common.clear")}
              >
                <svg class="clear-icon">
                  <use href="#close"></use>
                </svg>
              </button>
            `:""}
          </div>
          ${this._suggestions.length?j`
            <div class="suggestions-dropdown">
              ${this._suggestions.map((e,t)=>j`
                <div 
                  class="suggestion-item ${t===this._activeIndex?"active":""}"
                  @click=${()=>this.selectSuggestion(e)}
                >
                  <div class="suggestion-main">
                    <span class="suggestion-text" .innerHTML=${this.highlightMatch(e.display,this._originalQuery)}></span>
                  </div>
                  ${e.details?j`
                    <div class="suggestion-details">
                      ${e.details.alt?j`<div class="detail-line">Alt: <span .innerHTML=${this.highlightMatch(e.details.alt,this._originalQuery)}></span></div>`:""}
                      ${e.details.doc?j`<div class="detail-line">Doc: <span .innerHTML=${this.highlightMatch(e.details.doc,this._originalQuery)}></span></div>`:""}
                    </div>
                  `:""}
                </div>
              `)}
            </div>
          `:""}
        </div>

        ${this.isActuallyScanning?j`
          <div class="scan-stats">
            <div class="stat-item">
              <span class="stat-label">Found</span>
              <span class="stat-value stat-number">${this.realTimeStats.images}</span>
              <span class="stat-text">media in</span>
              <span class="stat-value stat-number">${this.realTimeStats.pages}</span>
              <span class="stat-text">/</span>
              <span class="stat-value stat-number">${this.totalPages}</span>
              <span class="stat-text">changed pages in</span>
              <span class="stat-value stat-number">${this.realTimeStats.elapsed}</span>
              <span class="stat-text">s</span>
            </div>
          </div>
        `:""}

        ${this.scanStats?j`
          <div class="scan-stats">
            <div class="stat-item">
              <span class="stat-label">Pages:</span>
              <span class="stat-value">${this.scanStats.pagesScanned}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Media:</span>
              <span class="stat-value">${this.scanStats.mediaFound}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Time:</span>
              <span class="stat-value">${this.scanStats.duration}s</span>
            </div>
          </div>
        `:""}

        <button 
          class="view-toggle-button"
          @click=${this.toggleView}
          ?disabled=${this.isScanning}
          aria-label=${"grid"===this.currentView?this.t("views.list"):this.t("views.grid")}
          title=${"grid"===this.currentView?this.t("views.list"):this.t("views.grid")}
        >
          <svg class="view-icon">
            <use href="#${"grid"===this.currentView?"list":"grid"}"></use>
          </svg>
        </button>

        ${this.showAnalysisToggle?j`
          <div class="analysis-toggle-container">
            <span class="analysis-toggle-text">EXIF</span>
            <label class="analysis-toggle-label">
              <input 
                type="checkbox" 
                class="analysis-toggle-input"
                ?checked=${this.imageAnalysisEnabled}
                @change=${this.toggleImageAnalysis}
                ?disabled=${this.isActuallyScanning}
              />
              <span class="analysis-toggle-slider ${this.imageAnalysisEnabled?"enabled":""}"></span>
            </label>
          </div>
        `:""}

      </div>

    `}getOnDemandSearchSuggestions(e){return Qe(this.mediaData,e,Ke)}handleSearchInput(e){const t=e.target.value;this.searchQuery=t,this._originalQuery=t,this._activeIndex=-1,this._searchDebounceTimeout&&clearTimeout(this._searchDebounceTimeout),this._suggestionDebounceTimeout&&clearTimeout(this._suggestionDebounceTimeout),this._searchDebounceTimeout=setTimeout(()=>{this._lastSearchQuery=t,this.dispatchEvent(new CustomEvent("search",{detail:{query:t}}))},300),!t||!t.trim()||this._suppressSuggestions||this.isScanning?(this._suggestions=[],this._suppressSuggestions=!1):this._suggestionDebounceTimeout=setTimeout(()=>{this._suggestions=this.getOnDemandSearchSuggestions(t),this.requestUpdate()},200)}handleKeyDown(e){if(this._suggestions.length)switch(e.key){case"ArrowDown":e.preventDefault(),-1===this._activeIndex&&(this._originalQuery=this.searchQuery),this._activeIndex=(this._activeIndex+1)%this._suggestions.length,this.searchQuery=this.getSuggestionText(this._suggestions[this._activeIndex]);break;case"ArrowUp":e.preventDefault(),-1===this._activeIndex&&(this._originalQuery=this.searchQuery),this._activeIndex=(this._activeIndex-1+this._suggestions.length)%this._suggestions.length,this.searchQuery=this.getSuggestionText(this._suggestions[this._activeIndex]);break;case"Enter":if(e.preventDefault(),this._activeIndex>=0)this.selectSuggestion(this._suggestions[this._activeIndex]);else{if("/"===this.searchQuery)return this.searchQuery="folder:/",this._suggestions=[],this._activeIndex=-1,this._suppressSuggestions=!0,void this.dispatchEvent(new CustomEvent("search",{detail:{query:this.searchQuery,type:"folder",path:""}}));this._suggestions=[],this._activeIndex=-1,this._suppressSuggestions=!0,this.dispatchEvent(new CustomEvent("search",{detail:{query:this.searchQuery}}))}break;case"Escape":e.preventDefault(),this.searchQuery=this._originalQuery,this._suggestions=[],this._activeIndex=-1,this._suppressSuggestions=!0}}getSuggestionText(e){return"doc"===e.type?`doc:${e.value}`:"folder"===e.type?""===e.value?"folder:/":`folder:${e.value}`:"media"===e.type?e.value.name||e.value.url:""}selectSuggestion(e){this._suggestions=[],this._activeIndex=-1,this._suppressSuggestions=!0,"doc"===e.type?(this.searchQuery=`doc:${e.value}`,this.dispatchEvent(new CustomEvent("search",{detail:{query:this.searchQuery,type:"doc",path:e.value}}))):"folder"===e.type?(this.searchQuery=""===e.value?"folder:/":`folder:${e.value}`,this.dispatchEvent(new CustomEvent("search",{detail:{query:this.searchQuery,type:"folder",path:e.value}}))):(this.searchQuery=e.value.name,this.dispatchEvent(new CustomEvent("search",{detail:{query:this.searchQuery,type:"media",media:e.value}})))}highlightMatch(e,t){if(!t||!e)return e;const i=new RegExp(`(${t})`,"ig");return e.replace(i,"<mark>$1</mark>")}clearSearch(){this.searchQuery="",this._suggestions=[],this._activeIndex=-1,this._originalQuery="",this._suppressSuggestions=!1,this.dispatchEvent(new CustomEvent("search",{detail:{query:""}}))}handleViewChange(e){this.dispatchEvent(new CustomEvent("viewChange",{detail:{view:e}}))}toggleView(){const e="grid"===this.currentView?"list":"grid";this.handleViewChange(e)}toggleImageAnalysis(e){this.imageAnalysisEnabled=e.target.checked,this.dispatchEvent(new CustomEvent("toggleImageAnalysis",{detail:{enabled:this.imageAnalysisEnabled}}))}}__publicField(Bt,"properties",{searchQuery:{type:String},currentView:{type:String},locale:{type:String},isScanning:{type:Boolean},scanProgress:{type:Object},isBatchLoading:{type:Boolean},realTimeStats:{type:Object},lastScanDuration:{type:String},scanStats:{type:Object},imageAnalysisEnabled:{type:Boolean},showAnalysisToggle:{type:Boolean},mediaData:{type:Array},totalPages:{type:Number},isActuallyScanning:{type:Boolean},_suggestions:{state:!0},_activeIndex:{state:!0},_originalQuery:{state:!0},_suppressSuggestions:{state:!0}}),__publicField(Bt,"styles",yt(':host>svg{display:none}.search-icon,.clear-icon,.view-icon,.scan-icon{color:currentcolor;display:block;height:20px;width:20px}.topbar{align-items:center;background:#fff;border-bottom:1px solid #e2e8f0;display:flex;gap:16px;padding:16px}.search-container{align-items:center;display:flex;flex:1;margin:0 auto;max-width:800px;min-width:0;position:relative}.search-wrapper{align-items:center;display:flex;position:relative;width:100%}.search-input{background:#fff;border:1px solid #e2e8f0;border-radius:6px;color:#1e293b;font-size:.875rem;min-width:300px;padding:8px 16px;padding-left:2.5rem;padding-right:2.5rem;transition:all .2s cubic-bezier(.4,0,.2,1);width:100%}.search-input:focus{border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a;outline:none}.search-input::placeholder{color:#64748b}.search-input:disabled{background:#f8fafc;border-color:#e2e8f0;color:#94a3b8;cursor:not-allowed;opacity:.6}.search-input:disabled::placeholder{color:#94a3b8}.search-icon{color:#64748b;left:8px;pointer-events:none;position:absolute;z-index:1}.clear-button{align-items:center;background:transparent;border:none;border-radius:4px;color:#64748b;cursor:pointer;display:flex;justify-content:center;position:absolute;right:4px;transition:all .2s cubic-bezier(.4,0,.2,1)}.clear-button:hover{background:#f8fafc;color:#1e293b}.scan-stats{align-items:center;background:#f8fafc;border:1px solid #e2e8f0;border-radius:6px;display:flex;font-size:.875rem;gap:16px;padding:8px 16px}.stat-item{align-items:center;display:flex;gap:4px}.stat-number{font-variant-numeric:tabular-nums;min-width:2ch;text-align:right;transition:all .1s ease}.stat-text{white-space:nowrap}.stat-label{color:#64748b;font-weight:500}.stat-value{color:#1e293b;font-weight:600}.view-toggle-button{align-items:center;background:#fff;border:1px solid #e2e8f0;border-radius:6px;color:#64748b;cursor:pointer;display:flex;height:40px;justify-content:center;transition:all .2s cubic-bezier(.4,0,.2,1);width:40px}.view-toggle-button:hover{background:#f8fafc;border-color:#3b82f6;color:#1e293b}.view-toggle-button:active{background:#3b82f6;border-color:#3b82f6;color:#fff}.view-toggle-button:disabled{background:#f8fafc;border-color:#e2e8f0;color:#94a3b8;cursor:not-allowed;opacity:.6}.view-toggle-button:disabled:hover{background:#f8fafc;border-color:#e2e8f0;color:#94a3b8}.scan-container{align-items:center;display:flex;gap:8px}.scan-button{align-items:center;background:#3b82f6;border:1px solid #e2e8f0;border-radius:6px;color:#fff;cursor:pointer;display:flex;font-size:.875rem;font-weight:500;gap:8px;padding:8px 16px;transition:all .2s cubic-bezier(.4,0,.2,1)}.scan-button:disabled{cursor:not-allowed;opacity:.6}.scan-button:hover:not(:disabled){background:#2563eb;border-color:#2563eb}.analysis-toggle-container{align-items:center;display:flex;gap:8px}.analysis-toggle-text{color:#64748b;font-size:.875rem;font-weight:500;white-space:nowrap}.analysis-toggle-label{align-items:center;cursor:pointer;display:flex;-webkit-user-select:none;user-select:none}.analysis-toggle-input{display:none}.analysis-toggle-slider{background:#e2e8f0;border:1px solid #cbd5e1;border-radius:4px;cursor:pointer;height:32px;overflow:hidden;position:relative;transition:all .2s cubic-bezier(.4,0,.2,1);width:60px}.analysis-toggle-slider:before{background:#fff;border-radius:2px;box-shadow:0 1px 3px #0000001a;content:"";height:28px;left:2px;position:absolute;top:2px;transition:all .2s cubic-bezier(.4,0,.2,1);width:28px;z-index:2}.analysis-toggle-slider:after{color:#64748b;content:"OFF";font-size:.7rem;font-weight:600;position:absolute;right:6px;top:50%;transform:translateY(-50%);transition:all .2s cubic-bezier(.4,0,.2,1);z-index:1}.analysis-toggle-slider.enabled{background:#3b82f6;border-color:#3b82f6}.analysis-toggle-slider.enabled:before{transform:translate(28px)}.analysis-toggle-slider.enabled:after{color:#fff;content:"ON";left:6px;right:auto}.analysis-toggle-label:has(.analysis-toggle-input:disabled){cursor:not-allowed;opacity:.6}.analysis-toggle-label:has(.analysis-toggle-input:disabled) .analysis-toggle-slider{cursor:not-allowed}.scan-progress{align-items:center;background:#f8fafc;border:1px solid #e2e8f0;border-radius:6px;color:#64748b;display:flex;font-size:.875rem;gap:8px;padding:8px 16px}.progress-bar{background:#e2e8f0;border-radius:2px;height:4px;overflow:hidden;width:100px}.progress-fill{background:#3b82f6;height:100%;transition:width .3s ease}.suggestions-dropdown{background:#fff;border:1px solid #e2e8f0;border-radius:0 0 6px 6px;border-top:none;box-shadow:0 1px 3px #0000001a;left:0;margin-top:-1px;max-height:300px;overflow-y:auto;position:absolute;right:0;top:100%;z-index:1000}.suggestion-item{border-bottom:1px solid #e2e8f0;cursor:pointer;display:flex;flex-direction:column;gap:4px;padding:8px 16px;transition:all .2s cubic-bezier(.4,0,.2,1)}.suggestion-item:last-child{border-bottom:none}.suggestion-item:hover,.suggestion-item.active{background:#f8fafc}.suggestion-main{align-items:center;display:flex;gap:8px}.suggestion-text{color:#1e293b;font-size:.875rem;font-weight:500}.suggestion-details{display:flex;flex-direction:column;gap:2px;margin-left:1.5rem}.detail-line{align-items:center;color:#64748b;display:flex;font-size:.75rem;gap:4px}.detail-line span{color:#1e293b;font-weight:400}mark{background:#fef3c7;border-radius:2px;color:#92400e;font-weight:600;padding:0}@media (max-width: 768px){.topbar{flex-wrap:wrap;gap:var(--ml-space-sm)}.search-container{flex:1 1 100%;margin:0;max-width:none;min-width:0;order:1}.view-toggle-button{order:2}.scan-button{order:3}}\n')),customElements.define("media-topbar",Bt);class zt extends me{constructor(){super(),this.activeFilter="all",this.filterCounts={},this.locale="en",this.isScanning=!1}async connectedCallback(){super.connectedCallback(),this.handleClearFilters=this.handleClearFilters.bind(this),window.addEventListener("clear-filters",this.handleClearFilters)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("clear-filters",this.handleClearFilters)}handleClearFilters(){this.activeFilter="all",this.requestUpdate()}render(){const e=this.filterCounts||{};return be.debug("Sidebar render - filterCounts:",e),be.debug("Sidebar render - isScanning:",this.isScanning),j`
      <aside class="media-sidebar">
        <div class="sidebar-header">
          <h1 class="sidebar-title">${this.t("mediaLibrary.title")}</h1>
        </div>
        
        <div class="filter-section">
          <h3>${this.t("common.filter")}</h3>
          <ul class="filter-list">
            ${this.renderFilterItem("all",e.all)}
            ${this.renderFilterItem("images",e.images)}
            ${this.renderFilterItem("videos",e.videos)}
            ${this.renderFilterItem("documents",e.documents)}
            ${this.renderFilterItem("links",e.links)}
            ${this.renderFilterItem("icons",e.icons,"SVGs")}
            ${this.renderFilterItem("unused",e.unused)}
          </ul>
        </div>

        ${e.filled>0||e.decorative>0||e.missingAlt>0?j`
          <div class="filter-section">
            <h3>Accessibility</h3>
            <ul class="filter-list">
              ${this.renderFilterItem("filled",e.filled)}
              ${this.renderFilterItem("decorative",e.decorative)}
              ${this.renderFilterItem("missingAlt",e.missingAlt,"No Alt Text")}
            </ul>
          </div>
        `:""}

        ${this.isScanning||e.landscape>0||e.portrait>0||e.square>0?j`
          <div class="filter-section">
            <h3>Orientation</h3>
            <ul class="filter-list">
              ${this.renderFilterItem("landscape",e.landscape)}
              ${this.renderFilterItem("portrait",e.portrait)}
              ${this.renderFilterItem("square",e.square)}
            </ul>
          </div>
        `:""}

        ${this.renderCategorySection(e)}
      </aside>
    `}renderFilterItem(e,t,i=null){const a=i||this.t(`filters.${e}`),s=Ve().includes(e);return be.debug(`renderFilterItem - ${e}: count=${t}, isScanning=${this.isScanning}`),this.isScanning?j`
        <li class="filter-item">
          <button 
            class="filter-button disabled"
            disabled
            aria-pressed="false"
            data-category=${s?e:""}
          >
            <span>${a}</span>
          </button>
        </li>
      `:t&&0!==t?j`
      <li class="filter-item">
        <button 
          class="filter-button ${this.activeFilter===e?"active":""}"
          @click=${()=>this.handleFilter(e)}
          aria-pressed=${this.activeFilter===e}
          data-category=${s?e:""}
        >
          <span>${a}</span>
          <span class="count">${this.formatNumber(t)}</span>
        </button>
      </li>
    `:(be.debug(`Hiding filter ${e} - no count`),"")}renderCategorySection(e){const t=Ve(),i=t.some(t=>e[t]>0);return this.isScanning||i?j`
      <div class="filter-section">
        <h3>${this.t("categories.title")}</h3>
        <ul class="filter-list">
          ${t.map(t=>this.renderFilterItem(t,e[t]))}
        </ul>
      </div>
    `:""}handleFilter(e){this.dispatchEvent(new CustomEvent("filter",{detail:{type:e}}))}}__publicField(zt,"properties",{activeFilter:{type:String},filterCounts:{type:Object},locale:{type:String},isScanning:{type:Boolean}}),__publicField(zt,"styles",yt(".media-sidebar{background:#f8fafc;border:1px solid #e2e8f0;border-radius:6px;display:flex;flex-direction:column;height:100%;padding:16px}.sidebar-header{margin-bottom:24px}.sidebar-title{color:#1e293b;font-size:1.25rem;font-weight:600;margin:0}.filter-section h3{color:#64748b;font-size:.875rem;font-weight:600;letter-spacing:.05em;margin:24px 0 16px}.filter-list{list-style:none;margin:0;padding:0}.filter-item{margin-bottom:4px}.filter-button{align-items:center;background:#fff;border:1px solid #e2e8f0;border-radius:6px;color:#1e293b;cursor:pointer;display:flex;font-size:.875rem;justify-content:space-between;padding:8px 16px;text-align:start;transition:all .2s cubic-bezier(.4,0,.2,1);width:100%}.filter-button:hover{background:#f8fafc;border-color:#3b82f6}.filter-button:focus-visible{outline:2px solid #3b82f6;outline-offset:2px}.filter-button[aria-pressed=true]{background:#3b82f6;border-color:#3b82f6;color:#fff}.filter-button[aria-pressed=true]:hover{background:#2563eb;border-color:#2563eb}.filter-button.disabled{background:#f8fafc;border-color:#e2e8f0;color:#94a3b8;cursor:not-allowed;opacity:.6}.filter-button.disabled:hover{background:#f8fafc;border-color:#e2e8f0}.count{background:#f8fafc;border-radius:4px;color:#64748b;font-size:.75rem;font-weight:500;min-width:1.5rem;padding:4px 8px;text-align:center}.filter-button[aria-pressed=true] .count{background:rgb(255 255 255 / .2);color:#fff}.filter-button:not([aria-pressed=true]):hover .count{background:#fff;color:#3b82f6}.filter-section:has(.filter-list:has(.filter-button[data-category])){border-left:3px solid #3b82f6;padding-left:13px}.filter-section:has(.filter-list:has(.filter-button[data-category])) h3{color:#3b82f6;font-weight:700}\n")),customElements.define("media-sidebar",zt);const Vt=(e,t,i)=>{const a=new Map;for(let s=t;s<=i;s++)a.set(e[s],s);return a},jt=kt(class extends It{constructor(e){if(super(e),2!==e.type)throw Error("repeat() can only be used in text expressions")}dt(e,t,i){let a;void 0===i?i=t:void 0!==t&&(a=t);const s=[],r=[];let n=0;for(const o of e)s[n]=a?a(o,n):n,r[n]=i(o,n),n++;return{values:r,keys:s}}render(e,t,i){return this.dt(e,t,i).values}update(e,[t,i,a]){const s=e._$AH,{values:r,keys:n}=this.dt(t,i,a);if(!Array.isArray(s))return this.ut=n,r;const o=this.ut??(this.ut=[]),l=[];let c,d,h=0,u=s.length-1,p=0,g=r.length-1;for(;h<=u&&p<=g;)if(null===s[h])h++;else if(null===s[u])u--;else if(o[h]===n[p])l[p]=St(s[h],r[p]),h++,p++;else if(o[u]===n[g])l[g]=St(s[u],r[g]),u--,g--;else if(o[h]===n[g])l[g]=St(s[h],r[g]),xt(e,l[g+1],s[h]),h++,g--;else if(o[u]===n[p])l[p]=St(s[u],r[p]),xt(e,s[h],s[u]),u--,p++;else if(void 0===c&&(c=Vt(n,p,g),d=Vt(o,h,u)),c.has(o[h]))if(c.has(o[u])){const t=d.get(n[p]),i=void 0!==t?s[t]:null;if(null===i){const t=xt(e,s[h]);St(t,r[p]),l[p]=t}else l[p]=St(i,r[p]),xt(e,s[h],i),s[t]=null;p++}else At(s[u]),u--;else At(s[h]),h++;for(;p<=g;){const t=xt(e,l[g+1]);St(t,r[p]),l[p++]=t}for(;h<=u;){const e=s[h++];null!==e&&At(e)}return this.ut=n,((e,t=Ct)=>{e._$AH=t})(e,l),H}});class Ht{getResponsiveItemWidth(){if("undefined"==typeof window)return 410;const e=window.innerWidth;return e>=1200?410:e>=992?360:e>=768?310:e>=576?290:260}constructor(e={}){this.container=null,this.scrollListenerAttached=!1,this.scrollTimeout=null,this.throttledScroll=null,this.itemHeight=e.itemHeight||400,this.itemWidth=e.itemWidth||this.getResponsiveItemWidth(),this.cardSpacing=e.cardSpacing||20,this.bufferSize=e.bufferSize||5,this.maxVisibleItems=e.maxVisibleItems||50,this.scrollThrottle=e.scrollThrottle||16,this.visibleStart=0,this.visibleEnd=0,this.totalItems=0,this.containerHeight=0,this.containerWidth=0,this.lastScrollTop=0,this.lastScrollTime=0,this.scrollSpeed=0,this.onRangeChange=e.onRangeChange||null,this.onColCountChange=e.onColCountChange||null,this.onScroll=this.onScroll.bind(this),this.onResize=this.onResize.bind(this)}init(e,t){this.container=e,this.totalItems=t,this.updateContainerDimensions(),this.calculateVisibleRange(),this.attachScrollListener(),this.attachResizeListener()}updateContainerDimensions(){if(!this.container)return;const e=this.container.getBoundingClientRect();this.containerHeight=e.height,this.containerWidth=e.width}calculateVisibleRange(){if(!this.container||0===this.totalItems)return this.visibleStart=0,void(this.visibleEnd=0);const{scrollTop:e}=this.container,t=Math.floor(this.containerWidth/(this.itemWidth+this.cardSpacing)),i=Math.floor(e/(this.itemHeight+this.cardSpacing)),a=Math.ceil((e+this.containerHeight)/(this.itemHeight+this.cardSpacing));if(this.visibleStart=Math.max(0,i*t-this.bufferSize),this.visibleEnd=Math.min(this.totalItems,(a+1)*t+this.bufferSize),this.visibleEnd-this.visibleStart>this.maxVisibleItems){const e=Math.floor((this.visibleStart+this.visibleEnd)/2);this.visibleStart=Math.max(0,e-Math.floor(this.maxVisibleItems/2)),this.visibleEnd=Math.min(this.totalItems,this.visibleStart+this.maxVisibleItems)}}onScroll(){this.scrollTimeout&&clearTimeout(this.scrollTimeout);const e=performance.now(),t=this.container.scrollTop;if(this.lastScrollTime>0){const i=e-this.lastScrollTime,a=Math.abs(t-this.lastScrollTop);this.scrollSpeed=i>0?a/i:0,this.scrollSpeed>100?this.bufferSize=Math.min(10,this.bufferSize+1):this.bufferSize=Math.max(3,this.bufferSize-1)}this.lastScrollTop=t,this.lastScrollTime=e,this.scrollTimeout=setTimeout(()=>{requestAnimationFrame(()=>{this.calculateVisibleRange(),this.onVisibleRangeChange()})},this.scrollThrottle)}onResize(){this.updateContainerDimensions(),this.itemWidth=this.getResponsiveItemWidth(),this.calculateVisibleRange(),this.onVisibleRangeChange()}onVisibleRangeChange(){this.onRangeChange&&this.onRangeChange({start:this.visibleStart,end:this.visibleEnd})}attachScrollListener(){!this.scrollListenerAttached&&this.container&&(this.container.addEventListener("scroll",this.onScroll,{passive:!0}),this.scrollListenerAttached=!0)}detachScrollListener(){this.scrollListenerAttached&&this.container&&(this.container.removeEventListener("scroll",this.onScroll),this.scrollListenerAttached=!1)}attachResizeListener(){"undefined"!=typeof window&&window.addEventListener("resize",this.onResize,{passive:!0})}detachResizeListener(){"undefined"!=typeof window&&window.removeEventListener("resize",this.onResize)}updateTotalItems(e){this.totalItems=e,this.calculateVisibleRange(),this.onVisibleRangeChange()}resetState(e){this.totalItems=e,this.visibleStart=0,this.visibleEnd=0,this.calculateVisibleRange(),this.onVisibleRangeChange()}updateColCount(){if(this.updateContainerDimensions(),this.itemWidth=this.getResponsiveItemWidth(),this.calculateVisibleRange(),this.onVisibleRangeChange(),this.onColCountChange){const e=Math.floor(this.containerWidth/(this.itemWidth+this.cardSpacing));this.onColCountChange(e)}}calculateTotalHeight(e){if(0===e)return 0;const t=Math.floor(this.containerWidth/(this.itemWidth+this.cardSpacing));return Math.ceil(e/t)*(this.itemHeight+this.cardSpacing)}calculateItemPosition(e){const t=Math.floor(this.containerWidth/(this.itemWidth+this.cardSpacing)),i=e%t;return{top:Math.floor(e/t)*(this.itemHeight+this.cardSpacing),left:i*(this.itemWidth+this.cardSpacing)}}setupScrollListener(e){this.container=e,this.updateContainerDimensions(),this.calculateVisibleRange(),this.attachScrollListener(),this.attachResizeListener()}cleanup(){this.destroy()}getTotalItems(){return this.totalItems}getVisibleRange(){return{start:this.visibleStart,end:this.visibleEnd}}getVisibleItems(e){return e&&0!==e.length?e.slice(this.visibleStart,this.visibleEnd):[]}scrollToItem(e){if(!this.container||e<0||e>=this.totalItems)return;const t=Math.floor(this.containerWidth/(this.itemWidth+this.cardSpacing)),i=Math.floor(e/t)*(this.itemHeight+this.cardSpacing);this.container.scrollTop=i}destroy(){this.detachScrollListener(),this.detachResizeListener(),this.scrollTimeout&&(clearTimeout(this.scrollTimeout),this.scrollTimeout=null),this.container=null,this.totalItems=0}}class Gt extends Ht{constructor(e={}){super({itemHeight:400,itemWidth:410,cardSpacing:20,...e})}calculateVisibleRange(){if(!this.container||0===this.totalItems)return this.visibleStart=0,void(this.visibleEnd=0);const{scrollTop:e}=this.container,t=Math.floor(this.containerWidth/(this.itemWidth+this.cardSpacing)),i=Math.floor(e/(this.itemHeight+this.cardSpacing)),a=Math.ceil((e+this.containerHeight)/(this.itemHeight+this.cardSpacing));if(this.visibleStart=Math.max(0,i*t-this.bufferSize),this.visibleEnd=Math.min(this.totalItems,(a+1)*t+this.bufferSize),this.visibleEnd-this.visibleStart>this.maxVisibleItems){const e=Math.floor((this.visibleStart+this.visibleEnd)/2);this.visibleStart=Math.max(0,e-Math.floor(this.maxVisibleItems/2)),this.visibleEnd=Math.min(this.totalItems,this.visibleStart+this.maxVisibleItems)}}getItemsPerRow(){return Math.floor(this.containerWidth/(this.itemWidth+this.cardSpacing))}getTotalRows(){const e=this.getItemsPerRow();return Math.ceil(this.totalItems/e)}getRowForItem(e){const t=this.getItemsPerRow();return Math.floor(e/t)}getColumnForItem(e){return e%this.getItemsPerRow()}}class Wt extends Ht{constructor(e={}){super({itemHeight:80,itemWidth:0,cardSpacing:0,...e})}calculateVisibleRange(){if(!this.container||0===this.totalItems)return this.visibleStart=0,void(this.visibleEnd=0);const{scrollTop:e}=this.container,t=Math.floor(e/this.itemHeight),i=Math.ceil((e+this.containerHeight)/this.itemHeight);if(this.visibleStart=Math.max(0,t-this.bufferSize),this.visibleEnd=Math.min(this.totalItems,i+this.bufferSize),this.visibleEnd-this.visibleStart>this.maxVisibleItems){const e=Math.floor((this.visibleStart+this.visibleEnd)/2);this.visibleStart=Math.max(0,e-Math.floor(this.maxVisibleItems/2)),this.visibleEnd=Math.min(this.totalItems,this.visibleStart+this.maxVisibleItems)}}scrollToItem(e){if(!this.container||e<0||e>=this.totalItems)return;const t=e*this.itemHeight;this.container.scrollTop=t}getTotalHeight(){return this.totalItems*this.itemHeight}getItemOffset(e){return e*this.itemHeight}}class qt extends me{constructor(){super(),this.mediaData=[],this.searchQuery="",this.locale="en",this.isProcessing=!1,this.visibleStart=0,this.visibleEnd=50,this.colCount=4,this.iconsLoaded=!1,this.containerRef=Lt(),this.virtualScroll=new Gt({onRangeChange:e=>{this.visibleStart=e.start,this.visibleEnd=e.end,requestAnimationFrame(()=>{this.requestUpdate()})},onColCountChange:e=>{this.colCount=e,requestAnimationFrame(()=>{this.requestUpdate()})}})}connectedCallback(){super.connectedCallback()}async firstUpdated(){this.setupScrollListener(),window.addEventListener("resize",()=>{this.virtualScroll.updateColCount()})}shouldUpdate(e){return e.has("mediaData")||e.has("searchQuery")||e.has("isProcessing")||e.has("visibleStart")||e.has("visibleEnd")||e.has("colCount")||e.has("locale")}willUpdate(e){e.has("mediaData")&&(this.mediaData&&this.mediaData.length>0?this.virtualScroll.resetState(this.mediaData.length):(this.visibleStart=0,this.visibleEnd=0))}updated(e){var t;e.has("mediaData")&&(null==(t=this.mediaData)?void 0:t.length)>0&&!this.iconsLoaded&&(this.loadIcons(),this.iconsLoaded=!0),e.has("mediaData")&&this.updateComplete.then(()=>{this.mediaData&&this.mediaData.length>0&&(this.virtualScroll.scrollListenerAttached?(this.virtualScroll.updateTotalItems(this.mediaData.length),this.virtualScroll.calculateVisibleRange(),this.virtualScroll.onVisibleRangeChange()):this.setupScrollListener())})}disconnectedCallback(){super.disconnectedCallback(),this.virtualScroll.cleanup()}async loadIcons(){const e=this.shadowRoot.querySelectorAll("svg[id]"),t=Array.from(e).map(e=>e.id),i=["./icons/photo.svg","./icons/video.svg","./icons/pdf.svg","./icons/external-link.svg","./icons/copy.svg"].filter(e=>{const i=e.split("/").pop().replace(".svg","");return!t.includes(i)});i.length>0&&await Nt({parent:this.shadowRoot,paths:i})}setupScrollListener(){requestAnimationFrame(()=>{var e;const t=this.containerRef.value;t&&(this.virtualScroll.init(t,(null==(e=this.mediaData)?void 0:e.length)||0),this.virtualScroll.updateColCount(),this.virtualScroll.calculateVisibleRange(),this.virtualScroll.onVisibleRangeChange())})}render(){if(!this.mediaData||0===this.mediaData.length)return j`
        <div class="empty-state">
          <svg class="empty-icon">
            <use href="#photo"></use>
          </svg>
          <h3>${this.t("mediaLibrary.noResults")}</h3>
          <p>${this.t("mediaLibrary.loadingMedia")}</p>
        </div>
      `;const e=this.virtualScroll.calculateTotalHeight(this.mediaData.length),t=this.mediaData.slice(this.visibleStart,this.visibleEnd);return j`
      <main class="media-main" ${Ot(this.containerRef)}>
        <div class="media-grid" style="height: ${e}px;">
          ${jt(t,e=>e.url,(e,t)=>{const i=this.visibleStart+t,a=this.virtualScroll.calculateItemPosition(i);return this.renderMediaCard(e,i,a)})}
        </div>
      </main>
    `}renderMediaCard(e,t,i){const a=ct(e);return this.getMediaTypeIcon(a),j`
      <div 
        class="media-card" 
        data-index="${t}"
        style="position: absolute; top: ${i.top}px; left: ${i.left}px; width: ${this.virtualScroll.itemWidth-this.virtualScroll.cardSpacing}px; height: ${this.virtualScroll.itemHeight-this.virtualScroll.cardSpacing}px;"
        @click=${()=>this.handleMediaClick(e)}
      >
        <div class="media-preview">
          ${this.renderMediaPreview(e,a)}
          <div class="media-type-badge">
            <svg class="media-type-icon">
              <use href="#${this.getMediaTypeIcon(a)}"></use>
            </svg>
          </div>
        </div>
        
        <div class="media-info">
          <div class="media-details">
            <h4 class="media-name" title=${e.name} .innerHTML=${this.highlightSearchTerm(this.truncateText(e.name,35),this.searchQuery)}></h4>
          </div>
          
          <div class="media-actions">
            <span class="usage-count">${this.getUsageCount(e)} uses</span>
            <button 
              class="action-button"
              @click=${t=>this.handleAction(t,"copy",e)}
              title=${this.t("media.copyUrl")}
            >
              <svg class="action-icon">
                <use href="#copy"></use>
              </svg>
            </button>
          </div>
        </div>
      </div>
    `}renderMediaPreview(e,t){return mt(e.url)&&!0!==e.hasError?j`
        <img 
          class="media-image" 
          src=${e.url} 
          alt=${e.alt||e.name}
          loading="lazy"
          @error=${t=>this.handleImageError(t,e)}
        />
      `:mt(e.url)&&!0===e.hasError?j`
        <div class="media-placeholder cors-error">
          <svg class="placeholder-icon">
            <use href="#photo"></use>
          </svg>
          <div class="cors-message">
            <small>CORS blocked</small>
            <small>${this.getDomainFromUrl(e.url)}</small>
          </div>
        </div>
      `:bt(e.url)&&!0!==e.hasError?this.renderVideoPreview(e):bt(e.url)&&!0===e.hasError?j`
        <div class="media-placeholder cors-error">
          <svg class="placeholder-icon">
            <use href="#video"></use>
          </svg>
          <div class="cors-message">
            <small>CORS blocked</small>
            <small>${this.getDomainFromUrl(e.url)}</small>
          </div>
        </div>
      `:j`
      <div class="media-placeholder">
        <svg class="placeholder-icon">
          <use href="#${this.getMediaTypeIcon(t)}"></use>
        </svg>
      </div>
    `}getMediaTypeIcon(e){return{image:"photo",video:"video",document:"pdf",link:"external-link"}[e]||"photo"}getDomainFromUrl(e){try{return new URL(e).hostname}catch(t){return"unknown"}}truncateText(e,t=30){return!e||e.length<=t?e:`${e.substring(0,t)}...`}getUsageCount(e){return e.usageCount||0}handleMediaClick(e){this.dispatchEvent(new CustomEvent("mediaClick",{detail:{media:e},bubbles:!0}))}handleAction(e,t,i){e.stopPropagation(),this.dispatchEvent(new CustomEvent("mediaAction",{detail:{action:t,media:i},bubbles:!0}))}renderVideoPreview(e){if(ht(e.url)){const t=dt(e.url);return j`
        <div class="video-thumbnail-container">
          ${t?j`
            <img 
              class="video-thumbnail" 
              src=${t} 
              alt=${e.alt||e.name}
              loading="lazy"
              @error=${t=>this.handleVideoThumbnailError(t,e)}
            />
          `:j`
            <div class="video-placeholder">
              <svg class="video-icon">
                <use href="#video"></use>
              </svg>
            </div>
          `}
          <div class="video-play-overlay">
            <svg class="play-icon">
              <use href="#external-link"></use>
            </svg>
          </div>
        </div>
      `}return j`
      <video 
        class="media-video" 
        src=${e.url} 
        preload="metadata"
        muted
        @error=${t=>this.handleVideoError(t,e)}
        @loadedmetadata=${t=>this.handleVideoLoaded(t,e)}
      />
    `}handleImageError(e,t){t.hasError=!0,e.target.style.display="none",this.requestUpdate()}handleVideoError(e,t){t.hasError=!0,e.target.style.display="none",this.requestUpdate()}handleVideoThumbnailError(e){e.target.style.display="none",this.requestUpdate()}handleVideoLoaded(e){const t=e.target;t.duration>0&&(t.currentTime=.1)}highlightSearchTerm(e,t){if(!t||!e)return e;let i=t;if(t.includes(":")){const e=t.split(":");e.length>1&&(i=e[1].trim())}if(!i)return e;const a=new RegExp(`(${i})`,"gi");return e.replace(a,"<mark>$1</mark>")}}__publicField(qt,"properties",{mediaData:{type:Array},searchQuery:{type:String},locale:{type:String},isProcessing:{type:Boolean},visibleStart:{type:Number},visibleEnd:{type:Number},colCount:{type:Number}}),__publicField(qt,"styles",yt(".media-main{background:#fff;height:calc(100vh - 200px);overflow-y:auto;padding:24px;position:relative}.media-grid{position:relative;width:100%}.media-card{background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;box-shadow:0 1px 3px #0000001a;box-sizing:border-box;cursor:default;display:grid;grid-template-rows:auto 1fr;overflow:hidden;padding:0;position:absolute;transition:box-shadow .2s ease,border-color .2s ease}.media-card:hover{border-color:#e2e8f0;box-shadow:0 10px 15px -3px #0000001a;transform:translateY(-2px)}.media-preview{align-items:center;background:#f8fafc;border-bottom:1px solid #e2e8f0;display:flex;height:280px;justify-content:center;overflow:hidden;position:relative}.media-preview.clickable{cursor:pointer;transition:background-color .2s ease}.media-preview.clickable:hover{background:#fff}.media-image{height:100%;object-fit:contain;transition:transform .2s ease;width:100%}.media-card:hover .media-image{transform:scale(1.05)}.media-placeholder{align-items:center;color:#64748b;display:flex;flex-direction:column;font-size:2.5rem;gap:.5rem;justify-content:center;opacity:.6}.media-placeholder.cors-error{background:linear-gradient(135deg,#fef2f2 0%,#fef2f2 100%);color:#ef4444;opacity:1}.cors-message{align-items:center;display:flex;flex-direction:column;font-size:.75rem;gap:.25rem;text-align:center}.cors-message small{display:block;font-weight:500}:host>svg{display:none}.empty-icon,.media-type-icon,.action-icon,.placeholder-icon{color:currentcolor;display:block}.empty-icon{color:#64748b;height:48px;margin-bottom:8px;width:48px}.media-type-badge{align-items:center;background:rgb(0 0 0 / .7);border:none;border-radius:4px;box-shadow:none;color:#fff;display:flex;justify-content:center;outline:none;padding:4px;position:absolute;right:8px;top:8px}.media-type-badge svg{color:#fff;fill:currentcolor}.media-type-icon{color:#fff;fill:currentcolor;height:16px;width:16px}.action-icon{color:#fff;fill:currentcolor;height:18px;width:18px}.placeholder-icon{color:#64748b;height:32px;margin-bottom:8px;width:32px}.media-info{background:#2d3748;display:flex;flex-direction:column;justify-content:space-between;padding:8px;position:relative}.media-name{color:#fff;font-size:.875rem;font-weight:700;line-height:1.4;margin:0 0 4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.media-details{display:flex;flex:1;flex-direction:column;gap:2px}.media-actions{align-items:center;display:flex;gap:4px;justify-content:space-between;margin-top:4px;min-height:32px}.usage-count{background:rgb(255 255 255 / .1);border:1px solid rgb(255 255 255 / .2);border-radius:4px;color:#fffc;font-size:var(--ml-font-size-xs);font-weight:600;padding:2px 6px}.action-button{align-items:center;background:rgb(255 255 255 / .15);border:1px solid rgb(255 255 255 / .4);border-radius:4px;box-shadow:0 1px 2px #0000001a;color:#fff;cursor:pointer;display:flex;height:32px;justify-content:center;transition:all .2s cubic-bezier(.4,0,.2,1);width:32px}.action-button:hover{background:rgb(255 255 255 / .2);border-color:#ffffff80;color:#fff}@media (max-width: 1200px){.media-preview{height:200px}}@media (max-width: 992px){.media-preview{height:190px}}@media (max-width: 768px){.media-main{padding:var(--ml-space-sm)}.media-preview{height:180px}}@media (max-width: 576px){.media-main{padding:var(--ml-space-xs)}.media-preview{height:170px}}@media (max-width: 480px){.media-main{padding:var(--ml-space-xs)}.media-preview{height:160px}}.empty-state{align-items:center;color:#64748b;display:flex;flex-direction:column;justify-content:center;padding:24px;text-align:center;width:100%}.empty-state svg{height:48px;margin-bottom:16px;opacity:.5;width:48px}mark{background:#fef3c7;border-radius:2px;color:#92400e;font-weight:600;padding:0}\n")),customElements.define("media-grid",qt);class Kt extends me{constructor(){super(),this.mediaData=[],this.searchQuery="",this.locale="en",this.visibleStart=0,this.visibleEnd=50,this.containerRef=Lt(),this.virtualScroll=new Wt({onRangeChange:e=>{this.visibleStart=e.start,this.visibleEnd=e.end,requestAnimationFrame(()=>{this.requestUpdate()})}})}async connectedCallback(){super.connectedCallback(),await this.loadIcons()}firstUpdated(){this.setupScrollListener(),window.addEventListener("resize",()=>{this.virtualScroll.updateContainerDimensions()})}shouldUpdate(e){return e.has("mediaData")||e.has("searchQuery")||e.has("visibleStart")||e.has("visibleEnd")||e.has("locale")}willUpdate(e){e.has("mediaData")&&(this.mediaData&&this.mediaData.length>0?this.virtualScroll.resetState(this.mediaData.length):(this.visibleStart=0,this.visibleEnd=0))}updated(e){e.has("mediaData")&&this.updateComplete.then(()=>{this.mediaData&&this.mediaData.length>0&&(this.virtualScroll.scrollListenerAttached?(this.virtualScroll.updateTotalItems(this.mediaData.length),this.virtualScroll.calculateVisibleRange(),this.virtualScroll.onVisibleRangeChange()):this.setupScrollListener())})}disconnectedCallback(){super.disconnectedCallback(),this.virtualScroll.cleanup()}setupScrollListener(){requestAnimationFrame(()=>{var e;const t=this.containerRef.value;t&&(this.virtualScroll.init(t,(null==(e=this.mediaData)?void 0:e.length)||0),this.virtualScroll.calculateVisibleRange(),this.virtualScroll.onVisibleRangeChange())})}async loadIcons(){const e=this.shadowRoot.querySelectorAll("svg[id]"),t=Array.from(e).map(e=>e.id),i=["./icons/photo.svg","./icons/video.svg","./icons/pdf.svg","./icons/external-link.svg","./icons/copy.svg"].filter(e=>{const i=e.split("/").pop().replace(".svg","");return!t.includes(i)});i.length>0&&await Nt({parent:this.shadowRoot,paths:i})}render(){if(!this.mediaData||0===this.mediaData.length)return j`
        <div class="empty-state">
          <svg class="empty-icon">
            <use href="#photo"></use>
          </svg>
          <h3>${this.t("mediaLibrary.noResults")}</h3>
          <p>${this.t("mediaLibrary.loadingMedia")}</p>
        </div>
      `;const e=this.virtualScroll.getTotalHeight(),t=this.mediaData.slice(this.visibleStart,this.visibleEnd);return j`
      <main class="list-main">
        <div class="list-header">
          <div class="header-cell"></div>
          <div class="header-cell">${this.t("media.fileName")}</div>
          <div class="header-cell">Type</div>
          <div class="header-cell">Document</div>
          <div class="header-cell">Alt Text</div>
          <div class="header-cell">Actions</div>
        </div>
        <div class="list-content" ${Ot(this.containerRef)}>
          <div class="list-grid" style="height: ${e}px;">
            ${jt(t,e=>e.url,(e,t)=>{const i=this.visibleStart+t,a=this.virtualScroll.getItemOffset(i);return this.renderListItem(e,i,a)})}
          </div>
        </div>
      </main>
    `}renderListItem(e,t,i){const a=ct(e);return j`
      <div 
        class="media-item" 
        data-index="${t}"
        style="position: absolute; top: ${i}px; left: 0; right: 0;"
        @click=${()=>this.handleMediaClick(e)}
      >
        <div class="media-thumbnail">
          ${this.renderThumbnail(e,a)}
        </div>
        
        <div class="media-info">
          <h4 class="media-name" title=${e.name} .innerHTML=${this.highlightSearchTerm(this.truncateText(e.name,35),this.searchQuery)}></h4>
          <p class="media-url" title=${e.url} .innerHTML=${this.highlightSearchTerm(this.getShortUrl(e.url),this.searchQuery)}></p>
        </div>
        
        <div class="media-type">
          ${this.getDisplayMediaType(a)}
        </div>
        
        <div class="media-doc" title=${e.doc||""} .innerHTML=${this.highlightSearchTerm(this.getShortDoc(e.doc),this.searchQuery)}>
        </div>
        
        <div class="media-alt" title=${e.alt||""} .innerHTML=${this.highlightSearchTerm(this.getShortAlt(e.alt),this.searchQuery)}>
        </div>
        
        <div class="media-actions">
          <button 
            class="action-button"
            @click=${t=>this.handleAction(t,"copy",e)}
            title=${this.t("media.copyUrl")}
          >
            <svg class="action-icon">
              <use href="#copy"></use>
            </svg>
          </button>
        </div>
      </div>
    `}renderThumbnail(e,t){return mt(e.url)&&!0!==e.hasError?j`
        <img 
          src=${e.url} 
          alt=${e.alt||e.name}
          loading="lazy"
          @error=${t=>this.handleImageError(t,e)}
        />
      `:mt(e.url)&&!0===e.hasError?j`
        <div class="placeholder cors-error">
          <svg class="placeholder-icon">
            <use href="#photo"></use>
          </svg>
          <div class="cors-message">
            <small>CORS</small>
          </div>
        </div>
      `:j`
      <div class="placeholder">
        <svg class="placeholder-icon">
          <use href="#${this.getMediaTypeIcon(t)}"></use>
        </svg>
      </div>
    `}getMediaTypeIcon(e){switch(e){case"image":default:return"photo";case"video":return"video";case"document":return"pdf";case"link":return"external-link"}}truncateText(e,t=30){return!e||e.length<=t?e:`${e.substring(0,t)}...`}getDisplayMediaType(e){switch(e){case"image":return"IMG";case"video":return"VID";case"document":return"DOC";case"link":return"LNK";default:return"FILE"}}getShortUrl(e){if(!e)return"";try{const t=new URL(e);return t.pathname.split("/").pop()||t.hostname}catch{return e.split("/").pop()||e}}getShortDoc(e){return e?e.split("/").pop()||e:this.t("media.notUsed")}getShortAlt(e){return e&&"null"!==e?e:"—"}handleMediaClick(e){this.dispatchEvent(new CustomEvent("mediaClick",{detail:{media:e},bubbles:!0}))}handleAction(e,t,i){e.stopPropagation(),this.dispatchEvent(new CustomEvent("mediaAction",{detail:{action:t,media:i},bubbles:!0}))}handleImageError(e,t){t.hasError=!0,e.target.style.display="none",this.requestUpdate()}highlightSearchTerm(e,t){if(!t||!e)return e;let i=t;if(t.includes(":")){const e=t.split(":");e.length>1&&(i=e[1].trim())}if(!i)return e;const a=new RegExp(`(${i})`,"gi");return e.replace(a,"<mark>$1</mark>")}}__publicField(Kt,"properties",{mediaData:{type:Array},searchQuery:{type:String},locale:{type:String},visibleStart:{type:Number},visibleEnd:{type:Number}}),__publicField(Kt,"styles",yt(":host>svg{display:none}.empty-icon,.action-icon,.placeholder-icon{color:currentcolor;display:block}.empty-icon{color:#64748b;height:48px;margin-bottom:8px;width:48px}.action-icon{color:currentcolor;fill:currentcolor;height:18px;width:18px}.placeholder-icon{color:#64748b;height:24px;width:24px}.list-main{background:#fff;display:flex;flex-direction:column;height:100%;overflow:hidden}.list-content{flex:1;height:100%;overflow-y:auto;position:relative;width:100%}.list-grid{position:relative;width:100%}.list-header{background:#f8fafc;border-bottom:1px solid #e2e8f0;color:#64748b;display:grid;font-size:.75rem;font-weight:600;gap:16px;grid-template-columns:60px 1fr 80px 120px 120px auto;letter-spacing:.05em;padding:8px 16px;position:sticky;text-transform:uppercase;top:0;z-index:10}.header-cell{align-items:center;display:flex}.media-item{align-items:center;background:#fff;border-bottom:1px solid #e2e8f0;box-sizing:border-box;cursor:pointer;display:grid;gap:16px;grid-template-columns:60px 1fr 80px 120px 120px auto;padding:16px;transition:all .2s cubic-bezier(.4,0,.2,1);width:100%}.media-item:hover{background:#f8fafc}.media-thumbnail{align-items:center;background:linear-gradient(135deg,#f8fafc 0%,#f1f5f9 100%);border:1px solid #e2e8f0;border-radius:6px;display:flex;height:48px;justify-content:center;overflow:hidden;position:relative;width:48px}.media-thumbnail img{height:100%;object-fit:cover;width:100%}.media-thumbnail .placeholder{align-items:center;color:#64748b;display:flex;flex-direction:column;font-size:1.5rem;gap:.25rem;justify-content:center}.media-thumbnail .placeholder.cors-error{background:linear-gradient(135deg,#fef2f2 0%,#fef2f2 100%);color:#ef4444}.media-thumbnail .cors-message{font-size:.6rem;font-weight:500}.media-info{display:flex;flex-direction:column;gap:4px;min-width:0}.media-name{color:#1e293b;font-size:.875rem;font-weight:500;margin:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.media-url{color:#64748b;font-size:.75rem;margin:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.media-type{color:#64748b;font-size:.75rem;font-weight:500;text-transform:uppercase}.media-doc,.media-alt{color:#64748b;font-size:.75rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.media-actions{display:flex;gap:4px;opacity:1}.action-button{align-items:center;background:#fff;border:1px solid #e2e8f0;border-radius:4px;color:#64748b;cursor:pointer;display:flex;height:32px;justify-content:center;transition:all .2s cubic-bezier(.4,0,.2,1);width:32px}.action-button svg{color:#64748b;fill:#64748b}.empty-state svg{height:48px;margin-bottom:16px;opacity:.5;width:48px}@media (max-width: 768px){.list-header,.media-item{gap:var(--ml-space-sm);grid-template-columns:50px 1fr 60px 60px auto;padding:var(--ml-space-sm)}.list-header div:nth-child(4),.list-header div:nth-child(5),.media-item .media-doc,.media-item .media-alt{display:none}}@media (max-width: 480px){.list-header,.media-item{gap:var(--ml-space-xs);grid-template-columns:40px 1fr auto;padding:var(--ml-space-xs)}.media-thumbnail{height:32px;width:32px}.list-header div:nth-child(3),.list-header div:nth-child(4),.list-header div:nth-child(5),.media-item .media-type,.media-item .media-doc,.media-item .media-alt{display:none}}.empty-state{align-items:center;color:#64748b;display:flex;flex:1;flex-direction:column;justify-content:center;padding:24px;text-align:center}mark{background:#fef3c7;border-radius:2px;color:#92400e;font-weight:600;padding:0}\n")),customElements.define("media-list",Kt);class Qt extends me{constructor(){super(),__publicField(this,"handleOpenModal",e=>{window.dispatchEvent(new Event("close-modal")),this.modalData=e.detail,this.isOpen=!0}),__publicField(this,"handleCloseModal",()=>{this.isOpen=!1,this.modalData=null,this._activeTab="usage"}),__publicField(this,"handleTabChange",e=>{const{tab:t}=e.target.dataset;this._activeTab=t}),this.locale="en",this.isOpen=!1,this.modalData=null,this._activeTab="usage"}async connectedCallback(){super.connectedCallback(),await this.loadIcons(),window.addEventListener("open-modal",this.handleOpenModal),window.addEventListener("close-modal",this.handleCloseModal)}async loadIcons(){0===this.shadowRoot.querySelectorAll("svg[id]").length&&await Nt({parent:this.shadowRoot,paths:["./icons/close.svg","./icons/photo.svg","./icons/video.svg","./icons/pdf.svg","./icons/external-link.svg","./icons/copy.svg"]})}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("open-modal",this.handleOpenModal),window.removeEventListener("close-modal",this.handleCloseModal)}getUsageCount(){var e,t,i;return(null==(i=null==(t=null==(e=this.modalData)?void 0:e.data)?void 0:t.media)?void 0:i.usageCount)||0}shouldShowPreviewEditButtons(){var e,t;const i=(null==(t=null==(e=this.modalData)?void 0:e.data)?void 0:t.source)||"";return["content.da.live"].some(e=>i.includes(e))}getAltTextDisplay(e,t=null){return t&&(t.startsWith("video")||"video"===t)?"N/A":e&&"null"!==e?""===e?"Decorative":e:"Missing Alt"}formatContextAsHtml(e){if(!e)return j`<span class="no-context">No context available</span>`;const t=e.split(" > "),i=[];return t.forEach(e=>{if(e.startsWith("In:")){const t=e.replace("In:","").trim();if(t&&"undefined"!==t&&t.length>0){const e=this.simplifyContainerInfo(t);i.push(j`
            <div class="context-item">
              <span class="context-label">Container</span>
              <span class="context-value">${e}</span>
            </div>
          `)}}else if(e.startsWith("text:")){const t=e.replace("text:","").trim();if(t&&"undefined"!==t&&t.length>0){const e=this.cleanTextContent(t);if(e){const t=this.truncateText(e,200);i.push(j`
              <div class="context-item">
                <span class="context-label">Text</span>
                <span class="context-value">${t}</span>
              </div>
            `)}}}}),0===i.length?j`<span class="no-context">No context available</span>`:j`<div class="context-container">${i}</div>`}simplifyContainerInfo(e){if(!e)return"";const t=e.replace(/max-md:[^-\s]+/g,"").replace(/!-[^-\s]+/g,"").replace(/calc\([^)]+\)/g,"").replace(/\[[^\]]+\]/g,"").replace(/\s+/g," ").trim();if(t&&t.length>0&&"undefined"!==t)return t;const i=e.split(" ").filter(e=>e.length>2&&!e.includes("max-md")&&!e.includes("!-")&&!e.includes("calc")&&!e.includes("[")&&!e.includes("]"));return i.length>0?i[0]:"Container"}cleanTextContent(e){return e?e.replace(/\s+/g," ").replace(/\n\s*\n/g," ").replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ").trim():""}truncateText(e,t=50){if(!e||e.length<=t)return e;const i=e.substring(0,t),a=i.lastIndexOf(" ");return a>.8*t?`${e.substring(0,a)}...`:`${i}...`}convertMarkdownToHtml(e){const t=e.split("\n");return j`<div>${t.map(e=>{if(""===e.trim())return j`<br>`;const t=e.split(/(\*\*.*?\*\*)/g);return j`<div>${t.map(e=>{if(e.startsWith("**")&&e.endsWith("**")){const t=e.slice(2,-2);return j`<strong>${t}</strong>`}return e})}</div>`})}</div>`}render(){return this.isOpen&&this.modalData?j`
      <div class="modal-overlay" ?open=${this.isOpen} @click=${this.handleOverlayClick}>
        <div class="modal-content" @click=${this.handleContentClick}>
          <div class="modal-header">
            <h2 class="modal-title">${this.getModalTitle()}</h2>
            <button class="close-button" @click=${this.handleCloseModal} title="Close">
              <svg class="close-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          
          <div class="media-preview-section">
            ${this.renderModalPreview()}
          </div>
          
          <div class="modal-tabs">
            <button 
              type="button"
              class="tab-btn ${"usage"===this._activeTab?"active":""}"
              data-tab="usage"
              @click=${this.handleTabChange}
            >
              Usage (${this.getUsageCount()})
            </button>
            <button 
              type="button"
              class="tab-btn ${"metadata"===this._activeTab?"active":""}"
              data-tab="metadata"
              @click=${this.handleTabChange}
            >
              Metadata
            </button>
          </div>
          
          <div class="modal-body">
            ${"usage"===this._activeTab?this.renderUsageTab():this.renderMetadataTab()}
          </div>
        </div>
      </div>
    `:j``}renderUsageTab(){const{usageData:e}=this.modalData.data;if(!e||0===e.length)return j`
        <div class="no-usage">
          <p>Not Used</p>
        </div>
      `;const t=e.reduce((e,t)=>{const i=t.doc||"Unknown Document";return e[i]||(e[i]=[]),e[i].push(t),e},{});return j`
      <div class="usage-sections">
        ${Object.entries(t).map(([e,t])=>j`
          <div class="usage-section">
            <div class="document-heading">
              <h3>${e}</h3>
            </div>
            <div class="usage-table-container">
              <table class="usage-table">
                <thead>
                  <tr>
                    <th>Alt Text</th>
                    <th>Context</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  ${t.map(t=>{const i=this.shouldShowPreviewEditButtons();return j`
                    <tr class="usage-row">
                      <td class="alt-cell">
                        <div class="alt-text">${this.getAltTextDisplay(t.alt,t.type)}</div>
                      </td>
                      <td class="context-cell">
                        <div class="context-text">${this.formatContextAsHtml(t.ctx)}</div>
                      </td>
                      <td class="actions-cell">
                        <div class="actions-container">
                          ${i?j`
                            <button class="action-button" @click=${()=>this.handleViewDocument(e)}>
                              Preview
                            </button>
                            <button class="action-button" @click=${()=>this.handleEditDocument(e)}>
                              Edit
                            </button>
                          `:j`
                            <button class="action-button" @click=${()=>this.handleViewDocument(e)}>
                              Open
                            </button>
                          `}
                        </div>
                      </td>
                    </tr>
                    `})}
                </tbody>
              </table>
            </div>
          </div>
        `)}
      </div>
    `}renderMetadataTab(){const{media:e}=this.modalData.data;return j`
      <div class="metadata-section">
        <div class="metadata-table-container">
          <table class="metadata-table">
            <thead>
              <tr>
                <th>Property</th>
                <th>Value</th>
              </tr>
            </thead>
            <tbody>
              <tr class="metadata-row">
                <td class="metadata-label">File Name</td>
                <td class="metadata-value">${e.name}</td>
              </tr>
              <tr class="metadata-row">
                <td class="metadata-label">URL</td>
                <td class="metadata-value">${e.url}</td>
              </tr>
              <tr class="metadata-row">
                <td class="metadata-label">Type</td>
                <td class="metadata-value">${e.type}</td>
              </tr>
              
              ${this.renderAnalysisMetadata(e)}
            </tbody>
          </table>
        </div>
      </div>
    `}renderAnalysisMetadata(e){return e.orientation||e.category||e.width||e.height||e.exifCamera||e.exifDate?j`
      <tr class="metadata-row analysis-section">
        <td class="metadata-label">Analysis</td>
        <td class="metadata-value"></td>
      </tr>
      ${e.orientation?j`
        <tr class="metadata-row analysis-subrow">
          <td class="metadata-label">Orientation</td>
          <td class="metadata-value">${e.orientation}</td>
        </tr>
      `:""}
      ${e.category?j`
        <tr class="metadata-row analysis-subrow">
          <td class="metadata-label">Category</td>
          <td class="metadata-value">${e.category}</td>
        </tr>
      `:""}
      ${e.width&&e.height?j`
        <tr class="metadata-row analysis-subrow">
          <td class="metadata-label">Dimensions</td>
          <td class="metadata-value">${e.width} x ${e.height}px</td>
        </tr>
      `:""}
      ${this.renderCameraInfo(e)}
      ${e.exifDate?j`
        <tr class="metadata-row analysis-subrow">
          <td class="metadata-label">Date Taken</td>
          <td class="metadata-value">${e.exifDate}</td>
        </tr>
      `:""}
      ${e.analysisConfidence?j`
        <tr class="metadata-row analysis-subrow">
          <td class="metadata-label">Confidence</td>
          <td class="metadata-value">${e.analysisConfidence}</td>
        </tr>
      `:""}
    `:j`
        <tr class="metadata-row analysis-section">
          <td class="metadata-label">Analysis</td>
          <td class="metadata-value analysis-unavailable">No analysis data available</td>
        </tr>
      `}renderCameraInfo(e){return e.exifCamera&&"undefined undefined"!==e.exifCamera&&"undefined"!==e.exifCamera?j`
      <tr class="metadata-row analysis-subrow">
        <td class="metadata-label">Camera</td>
        <td class="metadata-value">${e.exifCamera}</td>
      </tr>
    `:""}renderModalPreview(){const{media:e}=this.modalData.data;return this.isImage(e.url)?j`
        <img 
          class="media-preview" 
          src=${e.url} 
          alt=${e.alt||e.name}
          @error=${t=>this.handleImageError(t,e)}
        />
      `:this.isVideo(e.url)?this.renderVideoPreview(e):this.isPdf(e.url)?j`
        <div class="pdf-preview">
          <div class="pdf-preview-header">
            <svg class="pdf-icon">
              <use href="#pdf"></use>
            </svg>
            <h3>PDF Document</h3>
            <p>${e.name}</p>
          </div>
          <div class="pdf-actions">
            <button 
              class="pdf-action-btn" 
              @click=${t=>this.handlePdfAction(t,e.url,e.name)}
              title="Click to view PDF, Ctrl/Cmd+Click to download"
            >
              <svg class="action-icon">
                <use href="#external-link"></use>
              </svg>
              Open PDF
            </button>
          </div>
        </div>
      `:j`
      <div class="preview-placeholder">
        <svg class="preview-icon">
          <use href="#${this.getMediaTypeIcon(e)}"></use>
        </svg>
      </div>
    `}renderVideoPreview(e){if(ht(e.url)){const t=dt(e.url);return j`
        <div class="external-video-preview">
          <div class="video-thumbnail-container">
            ${t?j`
              <img 
                class="video-thumbnail" 
                src=${t} 
                alt=${e.alt||e.name}
                @error=${t=>this.handleVideoThumbnailError(t,e)}
              />
            `:j`
              <div class="video-placeholder">
                <svg class="video-icon">
                  <use href="#video"></use>
                </svg>
              </div>
            `}
            <div class="video-play-overlay">
              <svg class="play-icon">
                <use href="#external-link"></use>
              </svg>
            </div>
          </div>
          <div class="video-info">
            <h3>External Video</h3>
            <p>${e.name}</p>
            <button 
              class="video-action-btn" 
              @click=${t=>this.handleExternalVideoAction(t,e.url,e.name)}
              title="Click to open video, Ctrl/Cmd+Click to open in new tab"
            >
              <svg class="action-icon">
                <use href="#external-link"></use>
              </svg>
              Open Video
            </button>
          </div>
        </div>
      `}return j`
      <video 
        class="media-preview video-preview" 
        src=${e.url} 
        controls
        preload="metadata"
        @error=${t=>this.handleVideoError(t,e)}
      >
        <p>Your browser does not support the video tag.</p>
      </video>
    `}handleImageError(e,t){t.hasError=!0,e.target.style.display="none",this.requestUpdate()}handleVideoError(e,t){t.hasError=!0,e.target.style.display="none",this.requestUpdate()}handleVideoThumbnailError(e){e.target.style.display="none",this.requestUpdate()}handleExternalVideoAction(e,t,i){e.preventDefault(),e.stopPropagation(),e.ctrlKey||e.metaKey?window.open(t,"_blank","noopener,noreferrer"):window.open(t,"_self")}getModalTitle(){var e;const{type:t,data:i}=this.modalData;switch(t){case"details":return(null==(e=null==i?void 0:i.media)?void 0:e.name)||"Media Details";case"edit":return this.t("media.editAltText");default:return"Modal"}}getMediaTypeIcon(e){const t=e.type||"";return t.startsWith("img >")?"photo":t.startsWith("video >")?"video":t.startsWith("document >")?"pdf":t.startsWith("link >")?"external-link":this.isPdf(e.url)?"pdf":this.isImage(e.url)?"photo":this.isVideo(e.url)?"video":"photo"}isImage(e){const t=this.getFileExtension(e);return["jpg","jpeg","png","gif","webp","svg","avif"].includes(t)}isVideo(e){const t=this.getFileExtension(e);return["mp4","webm","mov","avi"].includes(t)}isPdf(e){return"pdf"===this.getFileExtension(e)}getFileExtension(e){var t;if(!e)return"";try{const i=e.split(/[?#]/)[0],a=(null==(t=i.split(".").pop())?void 0:t.toLowerCase())||"";return!a||a===i||/[^a-z0-9]/.test(a)?"":a}catch(i){return""}}handleOverlayClick(e){e.target===e.currentTarget&&this.handleCloseModal()}handleContentClick(e){e.stopPropagation()}handleEdit(){this.modalData={type:"edit",data:this.modalData.data}}handleCopy(){const{media:e}=this.modalData.data;navigator.clipboard.writeText(e.url),window.dispatchEvent(new CustomEvent("show-notification",{detail:{heading:this.t("common.success"),message:this.t("media.copyUrl"),type:"success"}}))}handleViewDocument(e){e&&window.open(e,"_blank")}handleEditDocument(e){e&&window.open(e,"_blank")}handlePdfAction(e,t,i){if(t)if(e.ctrlKey||e.metaKey){const e=document.createElement("a");e.href=t,e.download=i||"document.pdf",document.body.appendChild(e),e.click(),document.body.removeChild(e)}else window.open(t,"_blank")}handleSave(e){e.preventDefault();const t=new FormData(e.target).get("altText");window.dispatchEvent(new CustomEvent("save-alt-text",{detail:{media:this.modalData.data.media,altText:t}})),this.handleCloseModal()}handleFormSubmit(e){e.preventDefault(),this.handleSave(e)}}function Xt(e){return new Promise((t,i)=>{if(e.isReady)return void t(e);let a,s,r=!1;const n=()=>{!r&&a&&s&&(e.removeEventListener("media-library-ready",a),e.removeEventListener("media-library-error",s))};a=i=>{i.target!==e||r||(r=!0,n(),t(e))},s=t=>{t.target!==e||r||(r=!0,n(),i(new Error(`Media library initialization failed: ${t.detail.error.message}`)))},e.addEventListener("media-library-ready",a),e.addEventListener("media-library-error",s),setTimeout(()=>{r||(r=!0,n(),i(new Error("Media library initialization timeout")))},1e4)})}async function Yt(e){const t=document.getElementById(e);if(!t)throw new Error(`Media library element with id "${e}" not found`);return Xt(t)}async function Jt(e={}){const{storage:t="none",locale:i="en",containerId:a}=e,s=document.createElement("media-library");return s.storage=t,s.locale=i,(a?document.getElementById(a):document.body).appendChild(s),Xt(s)}__publicField(Qt,"properties",{locale:{type:String},isOpen:{type:Boolean},modalData:{type:Object},_activeTab:{state:!0}}),__publicField(Qt,"styles",yt(':host>svg{display:none}.close-icon,.preview-icon,.action-icon{color:currentcolor;display:block}.close-icon{height:20px;width:20px}.preview-icon{color:#64748b;height:64px;width:64px}.action-icon{height:16px;width:16px}.modal-overlay{align-items:center;background:rgb(0 0 0 / .5);bottom:0;display:flex;justify-content:center;left:0;opacity:0;padding:20px;position:fixed;right:0;top:0;transition:opacity .3s ease,visibility .3s ease;visibility:hidden;z-index:99999}.modal-overlay[open]{opacity:1;visibility:visible}.modal-content{background:#f8f9fa;border-radius:8px;box-shadow:0 20px 25px -5px #0000001a;display:flex;flex-direction:column;max-height:95vh;max-width:1200px;overflow:hidden;transform:scale(.9) translateY(20px);transition:transform .3s cubic-bezier(.4,0,.2,1);width:100%}.modal-overlay[open] .modal-content{transform:scale(1) translateY(0)}.modal-header{align-items:center;background:#f9fafb;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;padding:20px 24px}.modal-title{color:#1e293b;font-size:1.125rem;font-weight:600;margin:0}.close-button{align-items:center;background:transparent;border:none;border-radius:4px;color:#64748b;cursor:pointer;display:flex;height:32px;justify-content:center;transition:all .2s cubic-bezier(.4,0,.2,1);width:32px}.close-button:hover{background:#f3f4f6;color:#1e293b}.modal-body{background:#f8f9fa;flex:1;overflow-y:auto;padding:24px}.media-preview-section{align-items:center;background:#fff;border:1px solid #e5e7eb;border-radius:8px;display:flex;justify-content:center;margin-bottom:24px;max-height:400px;min-height:300px;overflow:hidden;padding:20px;position:relative;text-align:center}.media-preview{border-radius:var(--ml-radius-lg);box-shadow:0 4px 16px #00000026;display:block;height:auto;max-height:100%;max-width:100%;object-fit:contain;width:auto}.preview-placeholder{align-items:center;background:#e9ecef;border-radius:8px;box-shadow:0 1px 3px #0000001a;display:flex;height:150px;justify-content:center;margin:0 auto;width:150px}.pdf-preview{align-items:center;background:#f8fafc;border:2px solid #e2e8f0;border-radius:8px;display:flex;flex-direction:column;height:300px;justify-content:center;margin:0 auto;max-width:400px;padding:24px;text-align:center}.pdf-preview-header{align-items:center;display:flex;flex-direction:column;gap:8px;margin-bottom:24px}.pdf-icon{color:#ef4444;fill:#ef4444;height:48px;width:48px}.pdf-preview-header h3{color:#1e293b;font-size:1.25rem;font-weight:600;margin:0}.pdf-preview-header p{color:#64748b;font-size:.875rem;margin:0;overflow-wrap:break-word}.pdf-actions{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;width:100%}.pdf-action-btn{align-items:center;background:#3b82f6;border:none;border-radius:6px;color:#fff;cursor:pointer;display:flex;font-size:.9rem;font-weight:600;gap:4px;justify-content:center;min-width:140px;padding:16px 24px;text-decoration:none;transition:all .2s cubic-bezier(.4,0,.2,1)}.pdf-action-btn:hover{background:#2563eb;transform:translateY(-1px)}.pdf-action-btn svg{fill:currentcolor;height:16px;width:16px}.modal-tabs{background:#f8f9fa;border-bottom:1px solid #e5e7eb;display:flex;gap:0;padding:0}.tab-btn{background:transparent;border:none;border-bottom:2px solid transparent;color:#64748b;cursor:pointer;flex:1;font-size:14px;font-weight:500;padding:12px 16px;position:relative;transition:all .2s ease}.tab-btn:hover{background:#f1f5f9;color:#1e293b}.tab-btn.active{background:#fff;border-bottom-color:#3b82f6;color:#3b82f6;font-weight:600}.tab-btn.active:after{background:#fff;bottom:-1px;content:"";height:1px;left:0;position:absolute;right:0}.media-info{display:grid;gap:16px}.info-row{align-items:start;display:grid;gap:16px;grid-template-columns:120px 1fr}.info-label{color:#64748b;font-size:.875rem;font-weight:500}.info-value{color:#1e293b;font-size:.875rem;word-break:break-all}.usage-list{margin-top:24px}.usage-item{background:#f8fafc;border:1px solid #e2e8f0;border-radius:4px;margin-bottom:8px;padding:8px}.usage-doc{color:#1e293b;font-weight:500;margin-bottom:4px}.usage-context{color:#64748b;font-size:.75rem}.metadata-section{margin-bottom:24px}.metadata-table-container{margin-bottom:24px;overflow-x:auto;padding:0}.metadata-table,.usage-table{border-collapse:collapse;font-size:13px;width:100%}.metadata-table th{background:#e9ecef;border-bottom:1px solid #e5e7eb;color:#1e293b;font-size:.75rem;font-weight:600;letter-spacing:.5px;padding:8px 12px;text-align:left;text-transform:uppercase}.metadata-table td{border-bottom:1px solid #f3f4f6;padding:8px 12px;vertical-align:top}.metadata-table tr:hover{background:#f9fafb}.usage-table td{border-bottom:1px solid #f3f4f6;padding:8px 12px;vertical-align:top}.usage-table tr:hover{background:#f9fafb}.usage-row:last-child td{border-bottom:none}.metadata-table .metadata-row:last-child td{border-bottom:none}.metadata-label{color:#1e293b;font-weight:500;width:120px}.metadata-value{color:#64748b;font-family:SF Mono,Monaco,Cascadia Code,Roboto Mono,Consolas,Courier New,monospace;font-size:.875rem;line-height:1.5;overflow-wrap:break-word;white-space:pre-line}.analysis-section{background:#f8f9fa;border-top:2px solid #e5e7eb}.analysis-section .metadata-label{color:#1e293b;font-weight:600}.analysis-subrow{background:#f8fafc}.analysis-subrow .metadata-label{color:#64748b;font-weight:500;padding-left:16px}.analysis-unavailable{color:#9ca3af;font-style:italic}.color-preview{align-items:center;display:flex;gap:8px}.color-swatch{border:1px solid #e5e7eb;border-radius:2px;display:inline-block;flex-shrink:0;height:16px;width:16px}.usage-sections{display:flex;flex-direction:column;gap:24px}.usage-section{border:1px solid #e5e7eb;border-radius:8px;overflow:hidden}.document-heading{background:#f8f9fa;border-bottom:1px solid #e5e7eb;padding:12px 16px}.document-heading h3{color:#1e293b;font-size:16px;font-weight:600;margin:0 0 4px;word-break:break-all}.usage-table-container{margin-bottom:24px;overflow-x:auto;padding:0}.usage-table{min-width:1000px}.usage-table th{background:#e9ecef;border-bottom:1px solid #e5e7eb;color:#1e293b;font-size:.75rem;font-weight:600;letter-spacing:.5px;padding:8px 12px;text-align:left;text-transform:uppercase}.alt-cell{min-width:200px;width:200px}.context-cell{flex:2;min-width:500px}.actions-cell{text-align:center;width:120px}.actions-container{align-items:center;display:flex;gap:4px;justify-content:center}.context-text{background:#f9fafb;border:1px solid #e5e7eb;border-radius:6px;color:#1e293b;font-family:SF Mono,Monaco,Cascadia Code,Roboto Mono,Consolas,Courier New,monospace;font-size:.75rem;line-height:1.6;max-height:200px;max-width:800px;overflow-wrap:break-word;overflow-y:auto;padding:12px 16px;white-space:pre-line}.context-text strong{color:#1e293b;font-weight:600}.context-container{display:flex;flex-direction:column;gap:8px}.context-item{align-items:flex-start;background:#f8fafc;border:1px solid #e2e8f0;border-radius:6px;display:flex;font-size:.75rem;gap:8px;line-height:1.4;padding:8px 12px}.context-label{color:#64748b;flex-shrink:0;font-size:.688rem;font-weight:600;min-width:80px}.context-value{color:#1e293b;flex:1;overflow-wrap:break-word;white-space:pre-line}.no-context{color:#9ca3af;font-size:.75rem;font-style:italic}.alt-text{background:#f9fafb;border:1px solid #e5e7eb;border-radius:4px;color:#64748b;font-size:.875rem;max-width:300px;overflow-wrap:break-word;padding:4px 8px;white-space:pre-line}.action-button{align-items:center;background:#fff;border:1px solid #e5e7eb;border-radius:4px;color:#1e293b;cursor:pointer;display:inline-flex;font-size:.75rem;font-weight:500;gap:4px;padding:4px 8px;transition:all .2s cubic-bezier(.4,0,.2,1)}.action-button:hover{background:#3b82f6;border-color:#3b82f6;color:#fff}.no-usage{color:#64748b;padding:64px 24px;text-align:center}\n')),customElements.define("modal-manager",Qt);class Zt extends me{constructor(){super(),this.storage="none",this.locale="en",this.mode="live",this.corsProxy="https://media-library-cors-proxy.aem-poc-lab.workers.dev/",this._mediaData=[],this._error=null,this._searchQuery="",this._selectedFilterType="all",this._currentView="grid",this._isScanning=!1,this._scanProgress=null,this._imageAnalysisEnabled=!1,this._isBatchLoading=!1,this._realTimeStats={images:0,pages:0,elapsed:0},this._progressiveMediaData=[],this._progressiveLimit=0,this._progressiveGroupingKeys=new Set,this._totalPages=0,this.showAnalysisToggle=!0,this.storageManager=null,this.contentParser=null,this._processedData=null,this._filteredDataCache=null,this._lastFilterParams=null,this._readyPromise=null,this._isReady=!1}async connectedCallback(){super.connectedCallback(),this._readyPromise=this._initialize();try{await this._readyPromise,this._isReady=!0,this.dispatchEvent(new CustomEvent("media-library-ready",{detail:{mediaLibrary:this},bubbles:!0}))}catch(e){this._error=`Initialization failed: ${e.message}`,this.dispatchEvent(new CustomEvent("media-library-error",{detail:{error:e},bubbles:!0}))}}async _initialize(){await Nt({parent:this.shadowRoot,paths:["./icons/close.svg","./icons/photo.svg","./icons/video.svg","./icons/pdf.svg","./icons/external-link.svg","./icons/copy.svg"]}),await fe.loadLocale(this.locale),fe.setLocale(this.locale),this.storageManager=Se(this.storage),this.storageManager&&this.storageManager.setMode&&this.storageManager.setMode(this.mode),this.contentParser=new Fe({corsProxy:this.corsProxy,enableImageAnalysis:this._imageAnalysisEnabled,enableCategorization:!0,analysisConfig:{extractEXIF:!0,extractDimensions:!0,categorizeFromFilename:!0},categorizationConfig:{useFilename:!0,useContext:!0,useAltText:!0,usePosition:!0}}),await this.loadMediaDataFromStorage()}shouldUpdate(e){return e.has("_mediaData")||e.has("_searchQuery")||e.has("_selectedFilterType")||e.has("_currentView")||e.has("_isScanning")||e.has("_scanProgress")||e.has("_error")||e.has("locale")||e.has("corsProxy")||e.has("showAnalysisToggle")||e.has("_isBatchLoading")||e.has("_realTimeStats")}async updated(e){e.has("locale")&&(await fe.loadLocale(this.locale),fe.setLocale(this.locale)),e.has("corsProxy")&&this.contentParser&&(this.contentParser.corsProxy=this.corsProxy)}async initialize(){try{this._error=null,await this.loadMediaDataFromStorage()}catch(e){this._error=e.message}}async loadMediaDataFromStorage(e=null){try{if(!this.storageManager)return;let t;if(this._isBatchLoading=!0,this.requestUpdate(),"r2"===this.storage)t=await this.storageManager.loadMediaUsages(this.mode);else{const i=e||"media-data";t=await this.storageManager.load(i)}t&&t.length>0?(this._mediaData=t,this._processedData=await Ze(t)):(this._mediaData=[],this._processedData=await Ze([])),this._isScanning=!1,this._isBatchLoading=!1,this._progressiveMediaData=[],this._filteredDataCache=null,this._lastFilterParams=null,this._usageCountCache=null,this._lastUsageCountParams=null,this.updateAnalysisToggleVisibility(),this.requestUpdate()}catch(t){this._mediaData=[],this._processedData=await Ze([]),this._isScanning=!1,this._isBatchLoading=!1,this._progressiveMediaData=[],"NotFoundError"===t.name||t.message.includes("object store")||(this._error=this.t("errors.loadFailed")),this.updateAnalysisToggleVisibility(),this.requestUpdate()}}async loadFromPageList(e,t=null,i=null,a=!0,s=null,r=null,n=null){if(!e||0===e.length)return this._error="No pages provided to scan",[];try{this._isScanning=!0,this._isBatchLoading=!0,this._error=null,this._progressiveMediaData=[],this._progressiveGroupingKeys=new Set,this._searchQuery="",this._selectedFilterType="all",this._scanStartTime=Date.now(),this._scanProgress={current:0,total:0,found:0},this._lastScanDuration=null,this._scanStats=null,this._realTimeStats={images:0,pages:0,elapsed:0},this._progressiveLimit=this.getProgressiveLimit(),window.dispatchEvent(new CustomEvent("clear-search")),window.dispatchEvent(new CustomEvent("clear-filters"));let i=n||this._mediaData||[];s&&0===i.length&&(i="r2"===this.storage?await this.storageManager.loadMediaUsages(this.mode)||[]:await this.storageManager.load()||[]),i.length>0&&(this._progressiveMediaData=[...i],i.forEach(e=>{e.url&&this._progressiveGroupingKeys.add(Ue(e.url))})),this._scanProgress={current:0,total:e.length,found:0},this._totalPages=e.length,this.requestUpdate();const o=setInterval(()=>{this._realTimeStats.elapsed=((Date.now()-this._scanStartTime)/1e3).toFixed(1),this._realTimeStats={...this._realTimeStats},this.requestUpdate()},100),l=await this.contentParser.scanPages(e,(e,i,a)=>{if(this._realTimeStats.pages=e,this._realTimeStats.images+=a,this._realTimeStats.elapsed=((Date.now()-this._scanStartTime)/1e3).toFixed(1),this._realTimeStats={...this._realTimeStats},a>0){const e=this.contentParser.getLatestMediaItems();if(e&&e.length>0){let t=!1;e.forEach(e=>{const i=Ue(e.url),a=this._progressiveMediaData.find(e=>Ue(e.url)===i);a&&(a.usageCount=(a.usageCount||1)+1,t=!0)});const i=e.filter(e=>{if(!e.url)return!1;const t=Ue(e.url);return!this._progressiveGroupingKeys.has(t)&&(this._progressiveGroupingKeys.add(t),e.usageCount=1,!0)});(i.length>0||t)&&(this._progressiveMediaData=[...this._progressiveMediaData,...i])}}this.requestUpdate(),t&&t(e,i,a)},s);clearInterval(o);const c=Date.now()-this._scanStartTime,d=(c/1e3).toFixed(1);let h=[];s&&s.pageLastModified&&(h=e.map(e=>e.loc||e.url));const u=[...i.filter(e=>!h.includes(e.doc)),...l];a&&("r2"===this.storage?await this.storageManager.saveMediaUsages(u,this.mode):await this.storageManager.save(u));const p=r||e,g={};return p.forEach(e=>{g[e.loc||e.url]=e.lastmod}),await this.storageManager.saveScanMetadata({totalPages:p.length,pageLastModified:g,scanDuration:c}),this._mediaData=u,this._processedData=await Ze(u),this._isScanning=!1,this._isBatchLoading=!1,this._scanProgress=null,this._lastScanDuration=d,this.updateAnalysisToggleVisibility(),this._filteredDataCache=null,this._lastFilterParams=null,this._usageCountCache=null,this._lastUsageCountParams=null,this.requestUpdate(),this._scanStats={pagesScanned:e.length,mediaFound:l.length,duration:d},"function"==typeof window.refreshSites&&window.refreshSites(),u}catch(o){throw this._isScanning=!1,this._isBatchLoading=!1,this._scanProgress=null,this._error=`Scan failed: ${o.message}`,this.updateAnalysisToggleVisibility(),o}}async loadFromStorage(e){const t=this.storageManager.type;this.storageManager.type="indexeddb";try{return await this.loadMediaDataFromStorage(e),this._mediaData}finally{this.storageManager.type=t}}async loadMediaData(e,t=null,i=!1,a=null){if(!e||!Array.isArray(e))return this._error="No media data provided",[];try{this._isScanning=!0,this._error=null,this._searchQuery="",this._selectedFilterType="all",this._scanStartTime=Date.now(),this._scanProgress={current:0,total:0,found:e.length},this._lastScanDuration=null,this._scanStats=null,window.dispatchEvent(new CustomEvent("clear-search")),window.dispatchEvent(new CustomEvent("clear-filters")),this.requestUpdate(),this._mediaData=e,this._processedData=await Ze(e);const s=Date.now()-this._scanStartTime,r=(s/1e3).toFixed(1),n=a||await this.storageManager.loadScanMetadata(),o=n?n.totalPages:0;return i&&t&&("r2"===this.storage?await this.storageManager.saveMediaUsages(e,this.mode):await this.storageManager.save(e),await this.storageManager.saveScanMetadata({totalPages:0,pageLastModified:{},scanDuration:s,source:"direct-load"})),this._isScanning=!1,this._isBatchLoading=!1,this._progressiveMediaData=[],this._scanProgress=null,this._lastScanDuration=r,this._totalPages=o,this.updateAnalysisToggleVisibility(),this._filteredDataCache=null,this._lastFilterParams=null,this._usageCountCache=null,this._lastUsageCountParams=null,this.requestUpdate(),this._scanStats={pagesScanned:o,mediaFound:e.length,duration:r,source:"direct-load"},"function"==typeof window.refreshSites&&window.refreshSites(),e}catch(s){throw this._isScanning=!1,this._scanProgress=null,this._error=`Load failed: ${s.message}`,this.updateAnalysisToggleVisibility(),s}}async clearData(){this._mediaData=[],this._processedData=await Ze([]),this._error=null,this._searchQuery="",this._selectedFilterType="all",this._scanStats=null,this._lastScanDuration=null,this.updateAnalysisToggleVisibility(),this.requestUpdate()}generateSiteKey(e){if(!e)return"media-data";try{return e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname.replace(/[^a-zA-Z0-9.-]/g,"_"):e.replace(/[^a-zA-Z0-9.-]/g,"_")}catch(t){return e.replace(/[^a-zA-Z0-9.-]/g,"_")}}handleToggleImageAnalysis(e){this._imageAnalysisEnabled=e.detail.enabled,this.contentParser&&this.contentParser.setImageAnalysis(this._imageAnalysisEnabled,{extractEXIF:!0,extractDimensions:!0,categorizeFromFilename:!0})}updateAnalysisToggleVisibility(){const e=0===this._mediaData.length||this._isScanning;this.showAnalysisToggle!==e&&(this.showAnalysisToggle=e)}get filteredMediaData(){var e;const t={filterType:this._selectedFilterType,searchQuery:this._searchQuery,selectedDocument:this.selectedDocument,dataLength:(null==(e=this._mediaData)?void 0:e.length)||0};if(this._filteredDataCache&&this._lastFilterParams&&JSON.stringify(this._lastFilterParams)===JSON.stringify(t))return this._filteredDataCache;if(!this._processedData){const e=We(this._mediaData,this._selectedFilterType,this._searchQuery,this.selectedDocument),i=[],a=new Set;return e.forEach(e=>{e.url&&!a.has(e.url)&&(a.add(e.url),i.push(e))}),this._filteredDataCache=i,this._lastFilterParams=t,i}const i=qe(this._mediaData,this._processedData,this._selectedFilterType,this._searchQuery,this.selectedDocument),a=[],s=new Set;return i.forEach(e=>{e.url&&!s.has(e.url)&&(s.add(e.url),a.push(e))}),this._filteredDataCache=a,this._lastFilterParams=t,a}getProgressiveLimit(){return"grid"===this._currentView?500:750}get selectedDocument(){if(this._mediaData&&this._mediaData.length>0){if(this._mediaData.find(e=>"/index.html"===e.doc))return"/index.html";const e=this._mediaData.find(e=>e.doc&&e.doc.trim());if(e)return e.doc}return null}get filterCounts(){var e;return(null==(e=this._processedData)?void 0:e.filterCounts)||{}}get isUIdisabled(){return this._isScanning||!this._mediaData||0===this._mediaData.length}handleSearch(e){this.isUIdisabled||(this._searchQuery=e.detail.query)}handleViewChange(e){this.isUIdisabled||(this._currentView=e.detail.view)}handleFilter(e){this.isUIdisabled||(this._selectedFilterType=e.detail.type)}async handleMediaClick(e){var t;const{media:i}=e.detail;if(!i)return;const a=((null==(t=this._mediaData)?void 0:t.filter(e=>pt(e.url,i.url)))||[]).map(e=>({doc:e.doc||"Unknown Document",alt:e.alt,type:e.type,ctx:e.ctx,firstUsedAt:e.firstUsedAt,lastUsedAt:e.lastUsedAt}));window.dispatchEvent(new CustomEvent("open-modal",{detail:{type:"details",data:{media:i,usageData:a}}}))}async handleMediaAction(e){const{action:t,media:i}=e.detail;"copy"===t&&await this.handleCopyMedia(i)}async handleCopyMedia(e){try{const t=await ft(e);this.showNotification(t.heading,t.message,"success")}catch(t){this.showNotification(this.t("common.error"),this.t("errors.saveFailed"),"error")}}showNotification(e,t,i="info"){window.dispatchEvent(new CustomEvent("show-notification",{detail:{heading:e,message:t,type:i,open:!0}}))}render(){return j`
      <div class="media-library">
        <div class="top-bar">
          <media-topbar
            .searchQuery=${this._searchQuery}
            .currentView=${this._currentView}
            .locale=${this.locale}
            .isScanning=${this.isUIdisabled}
            .scanProgress=${this._scanProgress}
            .isActuallyScanning=${this._isScanning}
            .isBatchLoading=${this._isBatchLoading}
            .realTimeStats=${this._realTimeStats}
            .lastScanDuration=${this._lastScanDuration}
            .scanStats=${this._scanStats}
            .imageAnalysisEnabled=${this._imageAnalysisEnabled}
            .showAnalysisToggle=${this.showAnalysisToggle}
            .mediaData=${this._mediaData}
            .totalPages=${this._totalPages}
            @search=${this.handleSearch}
            @viewChange=${this.handleViewChange}
            @toggleImageAnalysis=${this.handleToggleImageAnalysis}
          ></media-topbar>
        </div>


        <div class="sidebar">
          <media-sidebar
            .activeFilter=${this._selectedFilterType}
            .filterCounts=${this.filterCounts}
            .locale=${this.locale}
            .isScanning=${this.isUIdisabled}
            @filter=${this.handleFilter}
          ></media-sidebar>
        </div>

        <div class="main-content">
          ${this._error?this.renderErrorState():this.renderCurrentView()}
        </div>

        <modal-manager .locale=${this.locale}></modal-manager>
      </div>
    `}renderErrorState(){return j`
      <div class="error-state">
        <svg class="error-icon">
          <use href="#close"></use>
        </svg>
        <h3>${this.t("common.error")}</h3>
        <div class="error-message">${this._error}</div>
        <button class="retry-button" @click=${()=>this.clearError()}>
          Try Again
        </button>
      </div>
    `}clearError(){this._error=null}get ready(){return this._readyPromise||Promise.resolve(this)}get isReady(){return this._isReady}static async create(e={}){const t=document.createElement("media-library");return e.storage&&(t.storage=e.storage),e.locale&&(t.locale=e.locale),document.body.appendChild(t),await t.ready,t}renderCurrentView(){if(this._isScanning)return this._progressiveMediaData.length>0?j`
          <media-grid
            .mediaData=${this._progressiveMediaData}
            .searchQuery=${this._searchQuery}
            .locale=${this.locale}
            .isProcessing=${!0}
            @mediaClick=${this.handleMediaClick}
            @mediaAction=${this.handleMediaAction}
          ></media-grid>
        `:j`
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <h3>Discovering Media</h3>
          <p>Scanning pages and extracting media files...</p>
        </div>
      `;if(this._isBatchLoading)return j`
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <h3>Loading Media</h3>
          <p>Loading media data from storage...</p>
        </div>
      `;const e=this.filteredMediaData;return"list"===this._currentView?j`
        <media-list
          .mediaData=${e}
          .searchQuery=${this._searchQuery}
          .locale=${this.locale}
          @mediaClick=${this.handleMediaClick}
          @mediaAction=${this.handleMediaAction}
        ></media-list>
      `:j`
      <media-grid
        .mediaData=${e}
        .searchQuery=${this._searchQuery}
        .locale=${this.locale}
        .isProcessing=${!1}
        @mediaClick=${this.handleMediaClick}
        @mediaAction=${this.handleMediaAction}
      ></media-grid>
    `}}__publicField(Zt,"properties",{storage:{type:String},locale:{type:String},mode:{type:String},corsProxy:{type:String},_mediaData:{state:!0},_error:{state:!0},_searchQuery:{state:!0},_selectedFilterType:{state:!0},_currentView:{state:!0},_isScanning:{state:!0},_scanProgress:{state:!0},_lastScanDuration:{state:!0},_scanStats:{state:!0},_imageAnalysisEnabled:{state:!0},_isBatchLoading:{state:!0},_realTimeStats:{state:!0},_progressiveMediaData:{state:!0},_progressiveLimit:{state:!0},showAnalysisToggle:{type:Boolean}}),__publicField(Zt,"styles",yt(':host{display:block;font-family:system-ui,-apple-system,sans-serif;height:100vh;margin:0;max-width:100%;overflow:hidden;width:100%}:host>svg{display:none}.error-icon{color:#ef4444;display:block;height:48px;margin-bottom:16px;width:48px}.media-library{background:#f8fafc;display:grid;gap:8px;grid-template:"sidebar topbar" auto "sidebar main" 1fr / 240px 1fr;height:100vh;max-width:100%;overflow:hidden;padding:0;position:relative;width:100%}.top-bar{background:#fff;border:1px solid #e2e8f0;border-radius:8px;box-shadow:0 1px 3px #0000001a;grid-area:topbar;z-index:1000}.sidebar{background:#fff;border:1px solid #e2e8f0;border-radius:8px;box-shadow:0 1px 3px #0000001a;grid-area:sidebar;overflow-y:auto}.main-content{background:#fff;border:1px solid #e2e8f0;border-radius:8px;box-shadow:0 1px 3px #0000001a;grid-area:main;overflow:hidden;position:relative}.error-state{align-items:center;color:#64748b;display:flex;flex-direction:column;height:100%;justify-content:center;margin:0 auto;max-width:800px;padding:32px;text-align:center}.error-state svg{color:#ef4444;height:48px;margin-bottom:16px;width:48px}.error-message{background:#fef2f2;border:1px solid #ef4444;border-radius:6px;color:#1e293b;font-family:Monaco,Menlo,Ubuntu Mono,monospace;font-size:14px;line-height:1.5;margin:16px 0;max-width:100%;overflow-wrap:break-word;padding:24px;text-align:left;white-space:pre-line}.retry-button{background:#3b82f6;border:none;border-radius:6px;color:#fff;cursor:pointer;font-size:14px;font-weight:500;margin-top:16px;padding:8px 24px;transition:all .2s cubic-bezier(.4,0,.2,1)}.retry-button:hover{background:#2563eb;transform:translateY(-1px)}.loading-state{align-items:center;color:#64748b;display:flex;flex-direction:column;height:100%;justify-content:center;padding:24px;text-align:center}.loading-spinner{animation:spin 1s linear infinite;border:3px solid #e2e8f0;border-radius:50%;border-top:3px solid #3b82f6;height:32px;margin-bottom:16px;width:32px}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.streaming-container{display:flex;flex-direction:column;height:100%}.loading-more{align-items:center;background:rgb(255 255 255 / .95);border-top:1px solid #e2e8f0;bottom:0;color:#64748b;display:flex;flex-direction:column;gap:8px;justify-content:center;padding:16px;position:sticky;text-align:center;z-index:10}.loading-more .loading-spinner{height:20px;margin-bottom:0;width:20px}.loading-more p{font-size:.875rem;margin:0}@media (max-width: 768px){.media-library{grid-template:"topbar" auto "main" 1fr / 1fr}.sidebar{display:none}}\n')),__publicField(Zt,"waitForReady",Xt),__publicField(Zt,"createInstance",Jt),__publicField(Zt,"initialize",Yt),customElements.define("media-library",Zt);var ei="undefined"!=typeof self?self:global;const ti="undefined"!=typeof navigator,ii=ti&&"undefined"==typeof HTMLImageElement,ai=!("undefined"==typeof global||"undefined"==typeof process||!process.versions||!process.versions.node),si=ei.Buffer,ri=ei.BigInt,ni=!!si,oi=e=>e;function li(e,t=oi){if(ai)try{return"function"==typeof require?Promise.resolve(t(require(e))):import(e).then(t)}catch(i){}}let ci=ei.fetch;if(!ei.fetch){const e=li("http",e=>e),t=li("https",e=>e),i=(a,{headers:s}={})=>new Promise(async(r,n)=>{let{port:o,hostname:l,pathname:c,protocol:d,search:h}=new URL(a);const u={method:"GET",hostname:l,path:encodeURI(c)+h,headers:s};""!==o&&(u.port=Number(o));const p=("https:"===d?await t:await e).request(u,e=>{if(301===e.statusCode||302===e.statusCode){let t=new URL(e.headers.location,a).toString();return i(t,{headers:s}).then(r).catch(n)}r({status:e.statusCode,arrayBuffer:()=>new Promise(t=>{let i=[];e.on("data",e=>i.push(e)),e.on("end",()=>t(Buffer.concat(i)))})})});p.on("error",n),p.end()});(e=>{ci=e})(i)}function di(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const hi=e=>pi(e)?void 0:e,ui=e=>void 0!==e;function pi(e){return void 0===e||(e instanceof Map?0===e.size:0===Object.values(e).filter(ui).length)}function gi(e){let t=new Error(e);throw delete t.stack,t}function fi(e){return""===(e=function(e){for(;e.endsWith("\0");)e=e.slice(0,-1);return e}(e).trim())?void 0:e}function mi(e){let t=function(e){let t=0;return e.ifd0.enabled&&(t+=1024),e.exif.enabled&&(t+=2048),e.makerNote&&(t+=2048),e.userComment&&(t+=1024),e.gps.enabled&&(t+=512),e.interop.enabled&&(t+=100),e.ifd1.enabled&&(t+=1024),t+2048}(e);return e.jfif.enabled&&(t+=50),e.xmp.enabled&&(t+=2e4),e.iptc.enabled&&(t+=14e3),e.icc.enabled&&(t+=6e3),t}const bi=e=>String.fromCharCode.apply(null,e),yi="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):void 0;function vi(e){return yi?yi.decode(e):ni?Buffer.from(e).toString("utf8"):decodeURIComponent(escape(bi(e)))}class wi{static from(e,t){return e instanceof this&&e.le===t?e:new wi(e,void 0,void 0,t)}constructor(e,t=0,i,a){if("boolean"==typeof a&&(this.le=a),Array.isArray(e)&&(e=new Uint8Array(e)),0===e)this.byteOffset=0,this.byteLength=0;else if(e instanceof ArrayBuffer){void 0===i&&(i=e.byteLength-t);let a=new DataView(e,t,i);this._swapDataView(a)}else if(e instanceof Uint8Array||e instanceof DataView||e instanceof wi){void 0===i&&(i=e.byteLength-t),(t+=e.byteOffset)+i>e.byteOffset+e.byteLength&&gi("Creating view outside of available memory in ArrayBuffer");let a=new DataView(e.buffer,t,i);this._swapDataView(a)}else if("number"==typeof e){let t=new DataView(new ArrayBuffer(e));this._swapDataView(t)}else gi("Invalid input argument for BufferView: "+e)}_swapArrayBuffer(e){this._swapDataView(new DataView(e))}_swapBuffer(e){this._swapDataView(new DataView(e.buffer,e.byteOffset,e.byteLength))}_swapDataView(e){this.dataView=e,this.buffer=e.buffer,this.byteOffset=e.byteOffset,this.byteLength=e.byteLength}_lengthToEnd(e){return this.byteLength-e}set(e,t,i=wi){return e instanceof DataView||e instanceof wi?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e instanceof Uint8Array||gi("BufferView.set(): Invalid data argument."),this.toUint8().set(e,t),new i(this,t,e.byteLength)}subarray(e,t){return t=t||this._lengthToEnd(e),new wi(this,e,t)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(e,t){return new Uint8Array(this.buffer,this.byteOffset+e,t)}getString(e=0,t=this.byteLength){return vi(this.getUint8Array(e,t))}getLatin1String(e=0,t=this.byteLength){let i=this.getUint8Array(e,t);return bi(i)}getUnicodeString(e=0,t=this.byteLength){const i=[];for(let a=0;a<t&&e+a<this.byteLength;a+=2)i.push(this.getUint16(e+a));return bi(i)}getInt8(e){return this.dataView.getInt8(e)}getUint8(e){return this.dataView.getUint8(e)}getInt16(e,t=this.le){return this.dataView.getInt16(e,t)}getInt32(e,t=this.le){return this.dataView.getInt32(e,t)}getUint16(e,t=this.le){return this.dataView.getUint16(e,t)}getUint32(e,t=this.le){return this.dataView.getUint32(e,t)}getFloat32(e,t=this.le){return this.dataView.getFloat32(e,t)}getFloat64(e,t=this.le){return this.dataView.getFloat64(e,t)}getFloat(e,t=this.le){return this.dataView.getFloat32(e,t)}getDouble(e,t=this.le){return this.dataView.getFloat64(e,t)}getUintBytes(e,t,i){switch(t){case 1:return this.getUint8(e,i);case 2:return this.getUint16(e,i);case 4:return this.getUint32(e,i);case 8:return this.getUint64&&this.getUint64(e,i)}}getUint(e,t,i){switch(t){case 8:return this.getUint8(e,i);case 16:return this.getUint16(e,i);case 32:return this.getUint32(e,i);case 64:return this.getUint64&&this.getUint64(e,i)}}toString(e){return this.dataView.toString(e,this.constructor.name)}ensureChunk(){}}function xi(e,t){gi(`${e} '${t}' was not loaded, try using full build of exifr.`)}class Si extends Map{constructor(e){super(),this.kind=e}get(e,t){return this.has(e)||xi(this.kind,e),t&&(e in t||gi(`Unknown ${this.kind} '${e}'.`),t[e].enabled||xi(this.kind,e)),super.get(e)}keyList(){return Array.from(this.keys())}}var Ci=new Si("file parser"),Ai=new Si("segment parser"),ki=new Si("file reader");function Ii(e,t){return"string"==typeof e?Di(e,t):ti&&!ii&&e instanceof HTMLImageElement?Di(e.src,t):e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof DataView?new wi(e):ti&&e instanceof Blob?Pi(e,t,"blob",Mi):void gi("Invalid input argument")}function Di(e,t){return(i=e).startsWith("data:")||i.length>1e4?Ti(e,t,"base64"):ai&&e.includes("://")?Pi(e,t,"url",_i):ai?Ti(e,t,"fs"):ti?Pi(e,t,"url",_i):void gi("Invalid input argument");var i}async function Pi(e,t,i,a){return ki.has(i)?Ti(e,t,i):a?async function(e,t){let i=await t(e);return new wi(i)}(e,a):void gi(`Parser ${i} is not loaded`)}async function Ti(e,t,i){let a=new(ki.get(i))(e,t);return await a.read(),a}const _i=e=>ci(e).then(e=>e.arrayBuffer()),Mi=e=>new Promise((t,i)=>{let a=new FileReader;a.onloadend=()=>t(a.result||new ArrayBuffer),a.onerror=i,a.readAsArrayBuffer(e)});class Ei extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}}function $i(e,t,i){let a=new Ei;for(let[s,r]of i)a.set(s,r);if(Array.isArray(t))for(let s of t)e.set(s,a);else e.set(t,a);return a}function Li(e,t,i){let a,s=e.get(t);for(a of i)s.set(a[0],a[1])}const Fi=new Map,Ui=new Map,Oi=new Map,Ri=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],Ni=["jfif","xmp","icc","iptc","ihdr"],Bi=["tiff",...Ni],zi=["ifd0","ifd1","exif","gps","interop"],Vi=[...Bi,...zi],ji=["makerNote","userComment"],Hi=["translateKeys","translateValues","reviveValues","multiSegment"],Gi=[...Hi,"sanitize","mergeOutput","silentErrors"];class Wi{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class qi extends Wi{get needed(){return this.enabled||this.deps.size>0}constructor(e,t,i,a){if(super(),di(this,"enabled",!1),di(this,"skip",new Set),di(this,"pick",new Set),di(this,"deps",new Set),di(this,"translateKeys",!1),di(this,"translateValues",!1),di(this,"reviveValues",!1),this.key=e,this.enabled=t,this.parse=this.enabled,this.applyInheritables(a),this.canBeFiltered=zi.includes(e),this.canBeFiltered&&(this.dict=Fi.get(e)),void 0!==i)if(Array.isArray(i))this.parse=this.enabled=!0,this.canBeFiltered&&i.length>0&&this.translateTagSet(i,this.pick);else if("object"==typeof i){if(this.enabled=!0,this.parse=!1!==i.parse,this.canBeFiltered){let{pick:e,skip:t}=i;e&&e.length>0&&this.translateTagSet(e,this.pick),t&&t.length>0&&this.translateTagSet(t,this.skip)}this.applyInheritables(i)}else!0===i||!1===i?this.parse=this.enabled=i:gi(`Invalid options argument: ${i}`)}applyInheritables(e){let t,i;for(t of Hi)i=e[t],void 0!==i&&(this[t]=i)}translateTagSet(e,t){if(this.dict){let i,a,{tagKeys:s,tagValues:r}=this.dict;for(i of e)"string"==typeof i?(a=r.indexOf(i),-1===a&&(a=s.indexOf(Number(i))),-1!==a&&t.add(Number(s[a]))):t.add(i)}else for(let i of e)t.add(i)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,Zi(this.pick,this.deps)):this.enabled&&this.pick.size>0&&Zi(this.pick,this.deps)}}var Ki={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},Qi=new Map;class Xi extends Wi{static useCached(e){let t=Qi.get(e);return void 0!==t||(t=new this(e),Qi.set(e,t)),t}constructor(e){super(),!0===e?this.setupFromTrue():void 0===e?this.setupFromUndefined():Array.isArray(e)?this.setupFromArray(e):"object"==typeof e?this.setupFromObject(e):gi(`Invalid options argument ${e}`),void 0===this.firstChunkSize&&(this.firstChunkSize=ti?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let e;for(e of Ri)this[e]=Ki[e];for(e of Gi)this[e]=Ki[e];for(e of ji)this[e]=Ki[e];for(e of Vi)this[e]=new qi(e,Ki[e],void 0,this)}setupFromTrue(){let e;for(e of Ri)this[e]=Ki[e];for(e of Gi)this[e]=Ki[e];for(e of ji)this[e]=!0;for(e of Vi)this[e]=new qi(e,!0,void 0,this)}setupFromArray(e){let t;for(t of Ri)this[t]=Ki[t];for(t of Gi)this[t]=Ki[t];for(t of ji)this[t]=Ki[t];for(t of Vi)this[t]=new qi(t,!1,void 0,this);this.setupGlobalFilters(e,void 0,zi)}setupFromObject(e){let t;for(t of(zi.ifd0=zi.ifd0||zi.image,zi.ifd1=zi.ifd1||zi.thumbnail,Object.assign(this,e),Ri))this[t]=Ji(e[t],Ki[t]);for(t of Gi)this[t]=Ji(e[t],Ki[t]);for(t of ji)this[t]=Ji(e[t],Ki[t]);for(t of Bi)this[t]=new qi(t,Ki[t],e[t],this);for(t of zi)this[t]=new qi(t,Ki[t],e[t],this.tiff);this.setupGlobalFilters(e.pick,e.skip,zi,Vi),!0===e.tiff?this.batchEnableWithBool(zi,!0):!1===e.tiff?this.batchEnableWithUserValue(zi,e):Array.isArray(e.tiff)?this.setupGlobalFilters(e.tiff,void 0,zi):"object"==typeof e.tiff&&this.setupGlobalFilters(e.tiff.pick,e.tiff.skip,zi)}batchEnableWithBool(e,t){for(let i of e)this[i].enabled=t}batchEnableWithUserValue(e,t){for(let i of e){let e=t[i];this[i].enabled=!1!==e&&void 0!==e}}setupGlobalFilters(e,t,i,a=i){if(e&&e.length){for(let e of a)this[e].enabled=!1;let t=Yi(e,i);for(let[e,i]of t)Zi(this[e].pick,i),this[e].enabled=!0}else if(t&&t.length){let e=Yi(t,i);for(let[t,i]of e)Zi(this[t].skip,i)}}filterNestedSegmentTags(){let{ifd0:e,exif:t,xmp:i,iptc:a,icc:s}=this;this.makerNote?t.deps.add(37500):t.skip.add(37500),this.userComment?t.deps.add(37510):t.skip.add(37510),i.enabled||e.skip.add(700),a.enabled||e.skip.add(33723),s.enabled||e.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:e,exif:t,gps:i,interop:a}=this;a.needed&&(t.deps.add(40965),e.deps.add(40965)),t.needed&&e.deps.add(34665),i.needed&&e.deps.add(34853),this.tiff.enabled=zi.some(e=>!0===this[e].enabled)||this.makerNote||this.userComment;for(let s of zi)this[s].finalizeFilters()}get onlyTiff(){return!Ni.map(e=>this[e].enabled).some(e=>!0===e)&&this.tiff.enabled}checkLoadedPlugins(){for(let e of Bi)this[e].enabled&&!Ai.has(e)&&xi("segment parser",e)}}function Yi(e,t){let i,a,s,r,n=[];for(s of t){for(r of(i=Fi.get(s),a=[],i))(e.includes(r[0])||e.includes(r[1]))&&a.push(r[0]);a.length&&n.push([s,a])}return n}function Ji(e,t){return void 0!==e?e:void 0!==t?t:void 0}function Zi(e,t){for(let i of t)e.add(i)}di(Xi,"default",Ki);class ea{constructor(e){di(this,"parsers",{}),di(this,"output",{}),di(this,"errors",[]),di(this,"pushToErrors",e=>this.errors.push(e)),this.options=Xi.useCached(e)}async read(e){this.file=await Ii(e,this.options)}setup(){if(this.fileParser)return;let{file:e}=this,t=e.getUint16(0);for(let[i,a]of Ci)if(a.canHandle(e,t))return this.fileParser=new a(this.options,this.file,this.parsers),e[i]=!0;this.file.close&&this.file.close(),gi("Unknown file format")}async parse(){let{output:e,errors:t}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),t.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&t.length>0&&(e.errors=t),hi(e)}async executeParsers(){let{output:e}=this;await this.fileParser.parse();let t=Object.values(this.parsers).map(async t=>{let i=await t.parse();t.assignToOutput(e,i)});this.options.silentErrors&&(t=t.map(e=>e.catch(this.pushToErrors))),await Promise.all(t)}async extractThumbnail(){this.setup();let{options:e,file:t}=this,i=Ai.get("tiff",e);var a;if(t.tiff?a={start:0,type:"tiff"}:t.jpeg&&(a=await this.fileParser.getOrFindSegment("tiff")),void 0===a)return;let s=await this.fileParser.ensureSegmentChunk(a),r=this.parsers.tiff=new i(s,e,t),n=await r.extractThumbnail();return t.close&&t.close(),n}}async function ta(e,t){let i=new ea(t);return await i.read(e),i.parse()}var ia=Object.freeze({__proto__:null,parse:ta,Exifr:ea,fileParsers:Ci,segmentParsers:Ai,fileReaders:ki,tagKeys:Fi,tagValues:Ui,tagRevivers:Oi,createDictionary:$i,extendDictionary:Li,fetchUrlAsArrayBuffer:_i,readBlobAsArrayBuffer:Mi,chunkedProps:Ri,otherSegments:Ni,segments:Bi,tiffBlocks:zi,segmentsAndBlocks:Vi,tiffExtractables:ji,inheritables:Hi,allFormatters:Gi,Options:Xi});class aa{constructor(e,t,i){di(this,"errors",[]),di(this,"ensureSegmentChunk",async e=>{let t=e.start,i=e.size||65536;if(this.file.chunked)if(this.file.available(t,i))e.chunk=this.file.subarray(t,i);else try{e.chunk=await this.file.readChunk(t,i)}catch(a){gi(`Couldn't read segment: ${JSON.stringify(e)}. ${a.message}`)}else this.file.byteLength>t+i?e.chunk=this.file.subarray(t,i):void 0===e.size?e.chunk=this.file.subarray(t):gi("Segment unreachable: "+JSON.stringify(e));return e.chunk}),this.extendOptions&&this.extendOptions(e),this.options=e,this.file=t,this.parsers=i}injectSegment(e,t){this.options[e].enabled&&this.createParser(e,t)}createParser(e,t){let i=new(Ai.get(e))(t,this.options,this.file);return this.parsers[e]=i}createParsers(e){for(let t of e){let{type:e,chunk:i}=t,a=this.options[e];if(a&&a.enabled){let t=this.parsers[e];t&&t.append||t||this.createParser(e,i)}}}async readSegments(e){let t=e.map(this.ensureSegmentChunk);await Promise.all(t)}}class sa{static findPosition(e,t){let i=e.getUint16(t+2)+2,a="function"==typeof this.headerLength?this.headerLength(e,t,i):this.headerLength,s=t+a,r=i-a;return{offset:t,length:i,headerLength:a,start:s,size:r,end:s+r}}static parse(e,t={}){return new this(e,new Xi({[this.type]:t}),e).parse()}normalizeInput(e){return e instanceof wi?e:new wi(e)}constructor(e,t={},i){di(this,"errors",[]),di(this,"raw",new Map),di(this,"handleError",e=>{if(!this.options.silentErrors)throw e;this.errors.push(e.message)}),this.chunk=this.normalizeInput(e),this.file=i,this.type=this.constructor.type,this.globalOptions=this.options=t,this.localOptions=t[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(e,t){let i=Oi.get(t),a=Ui.get(t),s=Fi.get(t),r=this.options[t],n=r.reviveValues&&!!i,o=r.translateValues&&!!a,l=r.translateKeys&&!!s,c={};for(let[d,h]of e)n&&i.has(d)?h=i.get(d)(h):o&&a.has(d)&&(h=this.translateValue(h,a.get(d))),l&&s.has(d)&&(d=s.get(d)||d),c[d]=h;return c}translateValue(e,t){return t[e]||t.DEFAULT||e}assignToOutput(e,t){this.assignObjectToOutput(e,this.constructor.type,t)}assignObjectToOutput(e,t,i){if(this.globalOptions.mergeOutput)return Object.assign(e,i);e[t]?Object.assign(e[t],i):e[t]=i}}function ra(e){return 192===e||194===e||196===e||219===e||221===e||218===e||254===e}function na(e){return e>=224&&e<=239}function oa(e,t,i){for(let[a,s]of Ai)if(s.canHandle(e,t,i))return a}di(sa,"headerLength",4),di(sa,"type",void 0),di(sa,"multiSegment",!1),di(sa,"canHandle",()=>!1);class la extends aa{constructor(...e){super(...e),di(this,"appSegments",[]),di(this,"jpegSegments",[]),di(this,"unknownSegments",[])}static canHandle(e,t){return 65496===t}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(e){!0===e?(this.findAll=!0,this.wanted=new Set(Ai.keyList())):(e=void 0===e?Ai.keyList().filter(e=>this.options[e].enabled):e.filter(e=>this.options[e].enabled&&Ai.has(e)),this.findAll=!1,this.remaining=new Set(e),this.wanted=new Set(e)),this.unfinishedMultiSegment=!1}async findAppSegments(e=0,t){this.setupSegmentFinderArgs(t);let{file:i,findAll:a,wanted:s,remaining:r}=this;if(!a&&this.file.chunked&&(a=Array.from(s).some(e=>{let t=Ai.get(e),i=this.options[e];return t.multiSegment&&i.multiSegment}),a&&await this.file.readWhole()),e=this.findAppSegmentsInRange(e,i.byteLength),!this.options.onlyTiff&&i.chunked){let t=!1;for(;r.size>0&&!t&&(i.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:a}=i,s=this.appSegments.some(e=>!this.file.available(e.offset||e.start,e.length||e.size));if(t=e>a&&!s?!(await i.readNextChunk(e)):!(await i.readNextChunk(a)),void 0===(e=this.findAppSegmentsInRange(e,i.byteLength)))return}}}findAppSegmentsInRange(e,t){t-=2;let i,a,s,r,n,o,{file:l,findAll:c,wanted:d,remaining:h,options:u}=this;for(;e<t;e++)if(255===l.getUint8(e))if(i=l.getUint8(e+1),na(i)){if(a=l.getUint16(e+2),s=oa(l,e,a),s&&d.has(s)&&(r=Ai.get(s),n=r.findPosition(l,e),o=u[s],n.type=s,this.appSegments.push(n),!c&&(r.multiSegment&&o.multiSegment?(this.unfinishedMultiSegment=n.chunkNumber<n.chunkCount,this.unfinishedMultiSegment||h.delete(s)):h.delete(s),0===h.size)))break;u.recordUnknownSegments&&(n=sa.findPosition(l,e),n.marker=i,this.unknownSegments.push(n)),e+=a+1}else if(ra(i)){if(a=l.getUint16(e+2),218===i&&!1!==u.stopAfterSos)return;u.recordJpegSegments&&this.jpegSegments.push({offset:e,length:a,marker:i}),e+=a+1}return e}mergeMultiSegments(){if(!this.appSegments.some(e=>e.multiSegment))return;let e=function(e){let t,i,a,s=new Map;for(let r=0;r<e.length;r++)t=e[r],i=t.type,s.has(i)?a=s.get(i):s.set(i,a=[]),a.push(t);return Array.from(s)}(this.appSegments);this.mergedAppSegments=e.map(([e,t])=>{let i=Ai.get(e,this.options);return i.handleMultiSegments?{type:e,chunk:i.handleMultiSegments(t)}:t[0]})}getSegment(e){return this.appSegments.find(t=>t.type===e)}async getOrFindSegment(e){let t=this.getSegment(e);return void 0===t&&(await this.findAppSegments(0,[e]),t=this.getSegment(e)),t}}di(la,"type","jpeg"),Ci.set("jpeg",la);const ca=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class da extends sa{parseHeader(){var e=this.chunk.getUint16();18761===e?this.le=!0:19789===e&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(e,t,i=new Map){let{pick:a,skip:s}=this.options[t];a=new Set(a);let r=a.size>0,n=0===s.size,o=this.chunk.getUint16(e);e+=2;for(let l=0;l<o;l++){let o=this.chunk.getUint16(e);if(r){if(a.has(o)&&(i.set(o,this.parseTag(e,o,t)),a.delete(o),0===a.size))break}else!n&&s.has(o)||i.set(o,this.parseTag(e,o,t));e+=12}return i}parseTag(e,t,i){let{chunk:a}=this,s=a.getUint16(e+2),r=a.getUint32(e+4),n=ca[s];if(n*r<=4?e+=8:e=a.getUint32(e+8),(s<1||s>13)&&gi(`Invalid TIFF value type. block: ${i.toUpperCase()}, tag: ${t.toString(16)}, type: ${s}, offset ${e}`),e>a.byteLength&&gi(`Invalid TIFF value offset. block: ${i.toUpperCase()}, tag: ${t.toString(16)}, type: ${s}, offset ${e} is outside of chunk size ${a.byteLength}`),1===s)return a.getUint8Array(e,r);if(2===s)return fi(a.getString(e,r));if(7===s)return a.getUint8Array(e,r);if(1===r)return this.parseTagValue(s,e);{let t=new(function(e){switch(e){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:case 10:default:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 11:return Float32Array;case 12:return Float64Array}}(s))(r),i=n;for(let a=0;a<r;a++)t[a]=this.parseTagValue(s,e),e+=i;return t}}parseTagValue(e,t){let{chunk:i}=this;switch(e){case 1:return i.getUint8(t);case 3:return i.getUint16(t);case 4:case 13:return i.getUint32(t);case 5:return i.getUint32(t)/i.getUint32(t+4);case 6:return i.getInt8(t);case 8:return i.getInt16(t);case 9:return i.getInt32(t);case 10:return i.getInt32(t)/i.getInt32(t+4);case 11:return i.getFloat(t);case 12:return i.getDouble(t);default:gi(`Invalid tiff type ${e}`)}}}class ha extends da{static canHandle(e,t){return 225===e.getUint8(t+1)&&1165519206===e.getUint32(t+4)&&0===e.getUint16(t+8)}async parse(){this.parseHeader();let{options:e}=this;return e.ifd0.enabled&&await this.parseIfd0Block(),e.exif.enabled&&await this.safeParse("parseExifBlock"),e.gps.enabled&&await this.safeParse("parseGpsBlock"),e.interop.enabled&&await this.safeParse("parseInteropBlock"),e.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(e){let t=this[e]();return void 0!==t.catch&&(t=t.catch(this.handleError)),t}findIfd0Offset(){void 0===this.ifd0Offset&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(void 0===this.ifd1Offset){this.findIfd0Offset();let e=this.chunk.getUint16(this.ifd0Offset),t=this.ifd0Offset+2+12*e;this.ifd1Offset=this.chunk.getUint32(t)}}parseBlock(e,t){let i=new Map;return this[t]=i,this.parseTags(e,t,i),i}async parseIfd0Block(){if(this.ifd0)return;let{file:e}=this;this.findIfd0Offset(),this.ifd0Offset<8&&gi("Malformed EXIF data"),!e.chunked&&this.ifd0Offset>e.byteLength&&gi(`IFD0 offset points to outside of file.\nthis.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${e.byteLength}`),e.tiff&&await e.ensureChunk(this.ifd0Offset,mi(this.options));let t=this.parseBlock(this.ifd0Offset,"ifd0");return 0!==t.size?(this.exifOffset=t.get(34665),this.interopOffset=t.get(40965),this.gpsOffset=t.get(34853),this.xmp=t.get(700),this.iptc=t.get(33723),this.icc=t.get(34675),this.options.sanitize&&(t.delete(34665),t.delete(40965),t.delete(34853),t.delete(700),t.delete(33723),t.delete(34675)),t):void 0}async parseExifBlock(){if(this.exif)return;if(this.ifd0||await this.parseIfd0Block(),void 0===this.exifOffset)return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,mi(this.options));let e=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=e.get(40965)),this.makerNote=e.get(37500),this.userComment=e.get(37510),this.options.sanitize&&(e.delete(40965),e.delete(37500),e.delete(37510)),this.unpack(e,41728),this.unpack(e,41729),e}unpack(e,t){let i=e.get(t);i&&1===i.length&&e.set(t,i[0])}async parseGpsBlock(){if(this.gps)return;if(this.ifd0||await this.parseIfd0Block(),void 0===this.gpsOffset)return;let e=this.parseBlock(this.gpsOffset,"gps");return e&&e.has(2)&&e.has(4)&&(e.set("latitude",ua(...e.get(2),e.get(1))),e.set("longitude",ua(...e.get(4),e.get(3)))),e}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),void 0!==this.interopOffset||this.exif||await this.parseExifBlock(),void 0!==this.interopOffset))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(e=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||e))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),void 0===this.ifd1)return;let e=this.ifd1.get(513),t=this.ifd1.get(514);return this.chunk.getUint8Array(e,t)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let e,t,i,a={};for(t of zi)if(e=this[t],!pi(e))if(i=this.canTranslate?this.translateBlock(e,t):Object.fromEntries(e),this.options.mergeOutput){if("ifd1"===t)continue;Object.assign(a,i)}else a[t]=i;return this.makerNote&&(a.makerNote=this.makerNote),this.userComment&&(a.userComment=this.userComment),a}assignToOutput(e,t){if(this.globalOptions.mergeOutput)Object.assign(e,t);else for(let[i,a]of Object.entries(t))this.assignObjectToOutput(e,i,a)}}function ua(e,t,i,a){var s=e+t/60+i/3600;return"S"!==a&&"W"!==a||(s*=-1),s}di(ha,"type","tiff"),di(ha,"headerLength",10),Ai.set("tiff",ha);var pa=Object.freeze({__proto__:null,default:ia,Exifr:ea,fileParsers:Ci,segmentParsers:Ai,fileReaders:ki,tagKeys:Fi,tagValues:Ui,tagRevivers:Oi,createDictionary:$i,extendDictionary:Li,fetchUrlAsArrayBuffer:_i,readBlobAsArrayBuffer:Mi,chunkedProps:Ri,otherSegments:Ni,segments:Bi,tiffBlocks:zi,segmentsAndBlocks:Vi,tiffExtractables:ji,inheritables:Hi,allFormatters:Gi,Options:Xi,parse:ta});const ga={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},fa=Object.assign({},ga,{firstChunkSize:4e4,gps:[1,2,3,4]});async function ma(e){let t=new ea(fa);await t.read(e);let i=await t.parse();if(i&&i.gps){let{latitude:e,longitude:t}=i.gps;return{latitude:e,longitude:t}}}const ba=Object.assign({},ga,{tiff:!1,ifd1:!0,mergeOutput:!1});async function ya(e){let t=new ea(ba);await t.read(e);let i=await t.extractThumbnail();return i&&ni?si.from(i):i}async function va(e){let t=await this.thumbnail(e);if(void 0!==t){let e=new Blob([t]);return URL.createObjectURL(e)}}const wa=Object.assign({},ga,{firstChunkSize:4e4,ifd0:[274]});async function xa(e){let t=new ea(wa);await t.read(e);let i=await t.parse();if(i&&i.ifd0)return i.ifd0[274]}const Sa=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let Ca=!0,Aa=!0;if("object"==typeof navigator){let e=navigator.userAgent;if(e.includes("iPad")||e.includes("iPhone")){let t=e.match(/OS (\d+)_(\d+)/);if(t){let[,e,i]=t,a=Number(e)+.1*Number(i);Ca=a<13.4,Aa=!1}}else if(e.includes("OS X 10")){let[,t]=e.match(/OS X 10[_.](\d+)/);Ca=Aa=Number(t)<15}if(e.includes("Chrome/")){let[,t]=e.match(/Chrome\/(\d+)/);Ca=Aa=Number(t)<81}else if(e.includes("Firefox/")){let[,t]=e.match(/Firefox\/(\d+)/);Ca=Aa=Number(t)<77}}async function ka(e){let t=await xa(e);return Object.assign({canvas:Ca,css:Aa},Sa[t])}class Ia extends wi{constructor(...e){super(...e),di(this,"ranges",new Da),0!==this.byteLength&&this.ranges.add(0,this.byteLength)}_tryExtend(e,t,i){if(0===e&&0===this.byteLength&&i){let e=new DataView(i.buffer||i,i.byteOffset,i.byteLength);this._swapDataView(e)}else{let i=e+t;if(i>this.byteLength){let{dataView:e}=this._extend(i);this._swapDataView(e)}}}_extend(e){let t;t=ni?si.allocUnsafe(e):new Uint8Array(e);let i=new DataView(t.buffer,t.byteOffset,t.byteLength);return t.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:t,dataView:i}}subarray(e,t,i=!1){return t=t||this._lengthToEnd(e),i&&this._tryExtend(e,t),this.ranges.add(e,t),super.subarray(e,t)}set(e,t,i=!1){i&&this._tryExtend(t,e.byteLength,e);let a=super.set(e,t);return this.ranges.add(t,a.byteLength),a}async ensureChunk(e,t){this.chunked&&(this.ranges.available(e,t)||await this.readChunk(e,t))}available(e,t){return this.ranges.available(e,t)}}class Da{constructor(){di(this,"list",[])}get length(){return this.list.length}add(e,t,i=0){let a=e+t,s=this.list.filter(t=>Pa(e,t.offset,a)||Pa(e,t.end,a));if(s.length>0){e=Math.min(e,...s.map(e=>e.offset)),a=Math.max(a,...s.map(e=>e.end)),t=a-e;let i=s.shift();i.offset=e,i.length=t,i.end=a,this.list=this.list.filter(e=>!s.includes(e))}else this.list.push({offset:e,length:t,end:a})}available(e,t){let i=e+t;return this.list.some(t=>t.offset<=e&&i<=t.end)}}function Pa(e,t,i){return e<=t&&t<=i}class Ta extends Ia{constructor(e,t){super(0),di(this,"chunksRead",0),this.input=e,this.options=t}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(e=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let t=this.options.chunkSize,i=await this.readChunk(e,t);return!!i&&i.byteLength===t}async readChunk(e,t){if(this.chunksRead++,0!==(t=this.safeWrapAddress(e,t)))return this._readChunk(e,t)}safeWrapAddress(e,t){return void 0!==this.size&&e+t>this.size?Math.max(0,this.size-e):t}get nextChunkOffset(){if(0!==this.ranges.list.length)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return void 0!==this.size&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}ki.set("blob",class extends Ta{async readWhole(){this.chunked=!1;let e=await Mi(this.input);this._swapArrayBuffer(e)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(e,t){let i=t?e+t:void 0,a=this.input.slice(e,i),s=await Mi(a);return this.set(s,e,!0)}});var _a=Object.freeze({__proto__:null,default:pa,Exifr:ea,fileParsers:Ci,segmentParsers:Ai,fileReaders:ki,tagKeys:Fi,tagValues:Ui,tagRevivers:Oi,createDictionary:$i,extendDictionary:Li,fetchUrlAsArrayBuffer:_i,readBlobAsArrayBuffer:Mi,chunkedProps:Ri,otherSegments:Ni,segments:Bi,tiffBlocks:zi,segmentsAndBlocks:Vi,tiffExtractables:ji,inheritables:Hi,allFormatters:Gi,Options:Xi,parse:ta,gpsOnlyOptions:fa,gps:ma,thumbnailOnlyOptions:ba,thumbnail:ya,thumbnailUrl:va,orientationOnlyOptions:wa,orientation:xa,rotations:Sa,get rotateCanvas(){return Ca},get rotateCss(){return Aa},rotation:ka});ki.set("url",class extends Ta{async readWhole(){this.chunked=!1;let e=await _i(this.input);e instanceof ArrayBuffer?this._swapArrayBuffer(e):e instanceof Uint8Array&&this._swapBuffer(e)}async _readChunk(e,t){let i=t?e+t-1:void 0,a=this.options.httpHeaders||{};(e||i)&&(a.range=`bytes=${[e,i].join("-")}`);let s=await ci(this.input,{headers:a}),r=await s.arrayBuffer(),n=r.byteLength;if(416!==s.status)return n!==t&&(this.size=e+n),this.set(r,e,!0)}}),wi.prototype.getUint64=function(e){let t=this.getUint32(e),i=this.getUint32(e+4);return t<1048575?t<<32|i:void 0!==typeof ri?ri(t)<<ri(32)|ri(i):void gi("Trying to read 64b value but JS can only handle 53b numbers.")};class Ma extends aa{parseBoxes(e=0){let t=[];for(;e<this.file.byteLength-4;){let i=this.parseBoxHead(e);if(t.push(i),0===i.length)break;e+=i.length}return t}parseSubBoxes(e){e.boxes=this.parseBoxes(e.start)}findBox(e,t){return void 0===e.boxes&&this.parseSubBoxes(e),e.boxes.find(e=>e.kind===t)}parseBoxHead(e){let t=this.file.getUint32(e),i=this.file.getString(e+4,4),a=e+8;return 1===t&&(t=this.file.getUint64(e+8),a+=8),{offset:e,length:t,kind:i,start:a}}parseBoxFullHead(e){if(void 0!==e.version)return;let t=this.file.getUint32(e.start);e.version=t>>24,e.start+=4}}class Ea extends Ma{static canHandle(e,t){if(0!==t)return!1;let i=e.getUint16(2);if(i>50)return!1;let a=16,s=[];for(;a<i;)s.push(e.getString(a,4)),a+=4;return s.includes(this.type)}async parse(){let e=this.file.getUint32(0),t=this.parseBoxHead(e);for(;"meta"!==t.kind;)e+=t.length,await this.file.ensureChunk(e,16),t=this.parseBoxHead(e);await this.file.ensureChunk(t.offset,t.length),this.parseBoxFullHead(t),this.parseSubBoxes(t),this.options.icc.enabled&&await this.findIcc(t),this.options.tiff.enabled&&await this.findExif(t)}async registerSegment(e,t,i){await this.file.ensureChunk(t,i);let a=this.file.subarray(t,i);this.createParser(e,a)}async findIcc(e){let t=this.findBox(e,"iprp");if(void 0===t)return;let i=this.findBox(t,"ipco");if(void 0===i)return;let a=this.findBox(i,"colr");void 0!==a&&await this.registerSegment("icc",a.offset+12,a.length)}async findExif(e){let t=this.findBox(e,"iinf");if(void 0===t)return;let i=this.findBox(e,"iloc");if(void 0===i)return;let a=this.findExifLocIdInIinf(t),s=this.findExtentInIloc(i,a);if(void 0===s)return;let[r,n]=s;await this.file.ensureChunk(r,n);let o=4+this.file.getUint32(r);r+=o,n-=o,await this.registerSegment("tiff",r,n)}findExifLocIdInIinf(e){this.parseBoxFullHead(e);let t,i,a,s,r=e.start,n=this.file.getUint16(r);for(r+=2;n--;){if(t=this.parseBoxHead(r),this.parseBoxFullHead(t),i=t.start,t.version>=2&&(a=3===t.version?4:2,s=this.file.getString(i+a+2,4),"Exif"===s))return this.file.getUintBytes(i,a);r+=t.length}}get8bits(e){let t=this.file.getUint8(e);return[t>>4,15&t]}findExtentInIloc(e,t){this.parseBoxFullHead(e);let i=e.start,[a,s]=this.get8bits(i++),[r,n]=this.get8bits(i++),o=2===e.version?4:2,l=1===e.version||2===e.version?2:0,c=n+a+s,d=2===e.version?4:2,h=this.file.getUintBytes(i,d);for(i+=d;h--;){let e=this.file.getUintBytes(i,o);i+=o+l+2+r;let d=this.file.getUint16(i);if(i+=2,e===t)return[this.file.getUintBytes(i+n,a),this.file.getUintBytes(i+n+a,s)];i+=d*c}}}class $a extends Ea{}di($a,"type","heic");class La extends Ea{}di(La,"type","avif"),Ci.set("heic",$a),Ci.set("avif",La),$i(Fi,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),$i(Fi,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),$i(Fi,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),$i(Ui,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);let Fa=$i(Ui,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]);const Ua={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};Fa.set(37392,Ua),Fa.set(41488,Ua);const Oa={0:"Normal",1:"Low",2:"High"};function Ra(e){return"object"==typeof e&&void 0!==e.length?e[0]:e}function Na(e){let t=Array.from(e).slice(1);return t[1]>15&&(t=t.map(e=>String.fromCharCode(e))),"0"!==t[2]&&0!==t[2]||t.pop(),t.join(".")}function Ba(e){if("string"==typeof e){var[t,i,a,s,r,n]=e.trim().split(/[-: ]/g).map(Number),o=new Date(t,i-1,a);return Number.isNaN(s)||Number.isNaN(r)||Number.isNaN(n)||(o.setHours(s),o.setMinutes(r),o.setSeconds(n)),Number.isNaN(+o)?e:o}}function za(e){if("string"==typeof e)return e;let t=[];if(0===e[1]&&0===e[e.length-1])for(let i=0;i<e.length;i+=2)t.push(Va(e[i+1],e[i]));else for(let i=0;i<e.length;i+=2)t.push(Va(e[i],e[i+1]));return fi(String.fromCodePoint(...t))}function Va(e,t){return e<<8|t}Fa.set(41992,Oa),Fa.set(41993,Oa),Fa.set(41994,Oa),$i(Oi,["ifd0","ifd1"],[[50827,function(e){return"string"!=typeof e?vi(e):e}],[306,Ba],[40091,za],[40092,za],[40093,za],[40094,za],[40095,za]]),$i(Oi,"exif",[[40960,Na],[36864,Na],[36867,Ba],[36868,Ba],[40962,Ra],[40963,Ra]]),$i(Oi,"gps",[[0,e=>Array.from(e).join(".")],[7,e=>Array.from(e).join(":")]]);class ja extends sa{static canHandle(e,t){return 225===e.getUint8(t+1)&&1752462448===e.getUint32(t+4)&&"http://ns.adobe.com/"===e.getString(t+4,20)}static headerLength(e,t){return"http://ns.adobe.com/xmp/extension/"===e.getString(t+4,34)?79:33}static findPosition(e,t){let i=super.findPosition(e,t);return i.multiSegment=i.extended=79===i.headerLength,i.multiSegment?(i.chunkCount=e.getUint8(t+72),i.chunkNumber=e.getUint8(t+76),0!==e.getUint8(t+77)&&i.chunkNumber++):(i.chunkCount=1/0,i.chunkNumber=-1),i}static handleMultiSegments(e){return e.map(e=>e.chunk.getString()).join("")}normalizeInput(e){return"string"==typeof e?e:wi.from(e).getString()}parse(e=this.chunk){if(!this.localOptions.parse)return e;e=function(e){let t={},i={};for(let a of Ja)t[a]=[],i[a]=0;return e.replace(Za,(e,a,s)=>{if("<"===a){let a=++i[s];return t[s].push(a),`${e}#${a}`}return`${e}#${t[s].pop()}`})}(e);let t=Ga.findAll(e,"rdf","Description");0===t.length&&t.push(new Ga("rdf","Description",void 0,e));let i,a={};for(let s of t)for(let e of s.properties)i=Qa(e.ns,a),Wa(e,i);return function(e){let t;for(let i in e)t=e[i]=hi(e[i]),void 0===t&&delete e[i];return hi(e)}(a)}assignToOutput(e,t){if(this.localOptions.parse)for(let[i,a]of Object.entries(t))switch(i){case"tiff":this.assignObjectToOutput(e,"ifd0",a);break;case"exif":this.assignObjectToOutput(e,"exif",a);break;case"xmlns":break;default:this.assignObjectToOutput(e,i,a)}else e.xmp=t}}di(ja,"type","xmp"),di(ja,"multiSegment",!0),Ai.set("xmp",ja);class Ha{static findAll(e){return Xa(e,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(Ha.unpackMatch)}static unpackMatch(e){let t=e[1],i=e[2],a=e[3].slice(1,-1);return a=Ya(a),new Ha(t,i,a)}constructor(e,t,i){this.ns=e,this.name=t,this.value=i}serialize(){return this.value}}class Ga{static findAll(e,t,i){if(void 0!==t||void 0!==i){t=t||"[\\w\\d-]+",i=i||"[\\w\\d-]+";var a=new RegExp(`<(${t}):(${i})(#\\d+)?((\\s+?[\\w\\d-:]+=("[^"]*"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)`,"gm")}else a=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return Xa(e,a).map(Ga.unpackMatch)}static unpackMatch(e){let t=e[1],i=e[2],a=e[4],s=e[8];return new Ga(t,i,a,s)}constructor(e,t,i,a){this.ns=e,this.name=t,this.attrString=i,this.innerXml=a,this.attrs=Ha.findAll(i),this.children=Ga.findAll(a),this.value=0===this.children.length?Ya(a):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return void 0!==this.value&&0===this.attrs.length&&0===this.children.length}get isListContainer(){return 1===this.children.length&&this.children[0].isList}get isList(){let{ns:e,name:t}=this;return"rdf"===e&&("Seq"===t||"Bag"===t||"Alt"===t)}get isListItem(){return"rdf"===this.ns&&"li"===this.name}serialize(){if(0===this.properties.length&&void 0===this.value)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return Ka(this.children.map(qa));if(this.isListItem&&1===this.children.length&&0===this.attrs.length)return this.children[0].serialize();let e={};for(let t of this.properties)Wa(t,e);return void 0!==this.value&&(e.value=this.value),hi(e)}}function Wa(e,t){let i=e.serialize();void 0!==i&&(t[e.name]=i)}var qa=e=>e.serialize(),Ka=e=>1===e.length?e[0]:e,Qa=(e,t)=>t[e]?t[e]:t[e]={};function Xa(e,t){let i,a=[];if(!e)return a;for(;null!==(i=t.exec(e));)a.push(i);return a}function Ya(e){if(null==(t=e)||"null"===t||"undefined"===t||""===t||""===t.trim())return;var t;let i=Number(e);if(!Number.isNaN(i))return i;let a=e.toLowerCase();return"true"===a||"false"!==a&&e.trim()}const Ja=["rdf:li","rdf:Seq","rdf:Bag","rdf:Alt","rdf:Description"],Za=new RegExp(`(<|\\/)(${Ja.join("|")})`,"g");var es=Object.freeze({__proto__:null,default:_a,Exifr:ea,fileParsers:Ci,segmentParsers:Ai,fileReaders:ki,tagKeys:Fi,tagValues:Ui,tagRevivers:Oi,createDictionary:$i,extendDictionary:Li,fetchUrlAsArrayBuffer:_i,readBlobAsArrayBuffer:Mi,chunkedProps:Ri,otherSegments:Ni,segments:Bi,tiffBlocks:zi,segmentsAndBlocks:Vi,tiffExtractables:ji,inheritables:Hi,allFormatters:Gi,Options:Xi,parse:ta,gpsOnlyOptions:fa,gps:ma,thumbnailOnlyOptions:ba,thumbnail:ya,thumbnailUrl:va,orientationOnlyOptions:wa,orientation:xa,rotations:Sa,get rotateCanvas(){return Ca},get rotateCss(){return Aa},rotation:ka});const ts=["xmp","icc","iptc","tiff"],is=()=>{};async function as(e,t,i){let a=i[e];return a.enabled=!0,a.parse=!0,Ai.get(e).parse(t,a)}let ss=li("fs",e=>e.promises);ki.set("fs",class extends Ta{async readWhole(){this.chunked=!1,this.fs=await ss;let e=await this.fs.readFile(this.input);this._swapBuffer(e)}async readChunked(){this.chunked=!0,this.fs=await ss,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){void 0===this.fh&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(e,t){void 0===this.fh&&await this.open(),e+t>this.size&&(t=this.size-e);var i=this.subarray(e,t,!0);return await this.fh.read(i.dataView,0,t,e),i}async close(){if(this.fh){let e=this.fh;this.fh=void 0,await e.close()}}}),ki.set("base64",class extends Ta{constructor(...e){super(...e),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(e,t){let i,a,s=this.input;void 0===e?(e=0,i=0,a=0):(i=4*Math.floor(e/3),a=e-i/4*3),void 0===t&&(t=this.size);let r=e+t,n=i+4*Math.ceil(r/3);s=s.slice(i,n);let o=Math.min(t,this.size-e);if(ni){let t=si.from(s,"base64").slice(a,a+o);return this.set(t,e,!0)}{let t=this.subarray(e,o,!0),i=atob(s),r=t.toUint8();for(let e=0;e<o;e++)r[e]=i.charCodeAt(a+e);return t}}});class rs extends aa{static canHandle(e,t){return 18761===t||19789===t}extendOptions(e){let{ifd0:t,xmp:i,iptc:a,icc:s}=e;i.enabled&&t.deps.add(700),a.enabled&&t.deps.add(33723),s.enabled&&t.deps.add(34675),t.finalizeFilters()}async parse(){let{tiff:e,xmp:t,iptc:i,icc:a}=this.options;if(e.enabled||t.enabled||i.enabled||a.enabled){let e=Math.max(mi(this.options),this.options.chunkSize);await this.file.ensureChunk(0,e),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(e){if(this.parsers.tiff[e]){let t=this.parsers.tiff[e];this.injectSegment(e,t)}}}di(rs,"type","tiff"),Ci.set("tiff",rs);let ns=li("zlib");const os=["ihdr","iccp","text","itxt","exif"];class ls extends aa{constructor(...e){super(...e),di(this,"catchError",e=>this.errors.push(e)),di(this,"metaChunks",[]),di(this,"unknownChunks",[])}static canHandle(e,t){return 35152===t&&2303741511===e.getUint32(0)&&218765834===e.getUint32(4)}async parse(){let{file:e}=this;await this.findPngChunksInRange(8,e.byteLength),await this.readSegments(this.metaChunks),this.findIhdr(),this.parseTextChunks(),await this.findExif().catch(this.catchError),await this.findXmp().catch(this.catchError),await this.findIcc().catch(this.catchError)}async findPngChunksInRange(e,t){let{file:i}=this;for(;e<t;){let t=i.getUint32(e),a=i.getUint32(e+4),s=i.getString(e+4,4).toLowerCase(),r=t+4+4+4,n={type:s,offset:e,length:r,start:e+4+4,size:t,marker:a};os.includes(s)?this.metaChunks.push(n):this.unknownChunks.push(n),e+=r}}parseTextChunks(){let e=this.metaChunks.filter(e=>"text"===e.type);for(let t of e){let[e,i]=this.file.getString(t.start,t.size).split("\0");this.injectKeyValToIhdr(e,i)}}injectKeyValToIhdr(e,t){let i=this.parsers.ihdr;i&&i.raw.set(e,t)}findIhdr(){let e=this.metaChunks.find(e=>"ihdr"===e.type);e&&!1!==this.options.ihdr.enabled&&this.createParser("ihdr",e.chunk)}async findExif(){let e=this.metaChunks.find(e=>"exif"===e.type);e&&this.injectSegment("tiff",e.chunk)}async findXmp(){let e=this.metaChunks.filter(e=>"itxt"===e.type);for(let t of e)"XML:com.adobe.xmp"===t.chunk.getString(0,17)&&this.injectSegment("xmp",t.chunk)}async findIcc(){let e=this.metaChunks.find(e=>"iccp"===e.type);if(!e)return;let{chunk:t}=e,i=t.getUint8Array(0,81),a=0;for(;a<80&&0!==i[a];)a++;let s=a+2,r=t.getString(0,a);if(this.injectKeyValToIhdr("ProfileName",r),ai){let e=await ns,i=t.getUint8Array(s);i=e.inflateSync(i),this.injectSegment("icc",i)}}}di(ls,"type","png"),Ci.set("png",ls),$i(Fi,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),Li(Fi,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);let cs=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];Li(Fi,"ifd0",cs),Li(Fi,"exif",cs),$i(Ui,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);class ds extends sa{static canHandle(e,t){return 224===e.getUint8(t+1)&&1246120262===e.getUint32(t+4)&&0===e.getUint8(t+8)}parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint16(0)],[2,this.chunk.getUint8(2)],[3,this.chunk.getUint16(3)],[5,this.chunk.getUint16(5)],[7,this.chunk.getUint8(7)],[8,this.chunk.getUint8(8)]])}}di(ds,"type","jfif"),di(ds,"headerLength",9),Ai.set("jfif",ds),$i(Fi,"jfif",[[0,"JFIFVersion"],[2,"ResolutionUnit"],[3,"XResolution"],[5,"YResolution"],[7,"ThumbnailWidth"],[8,"ThumbnailHeight"]]);class hs extends sa{parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint32(0)],[4,this.chunk.getUint32(4)],[8,this.chunk.getUint8(8)],[9,this.chunk.getUint8(9)],[10,this.chunk.getUint8(10)],[11,this.chunk.getUint8(11)],[12,this.chunk.getUint8(12)],...Array.from(this.raw)])}}di(hs,"type","ihdr"),Ai.set("ihdr",hs),$i(Fi,"ihdr",[[0,"ImageWidth"],[4,"ImageHeight"],[8,"BitDepth"],[9,"ColorType"],[10,"Compression"],[11,"Filter"],[12,"Interlace"]]),$i(Ui,"ihdr",[[9,{0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha",DEFAULT:"Unknown"}],[10,{0:"Deflate/Inflate",DEFAULT:"Unknown"}],[11,{0:"Adaptive",DEFAULT:"Unknown"}],[12,{0:"Noninterlaced",1:"Adam7 Interlace",DEFAULT:"Unknown"}]]);class us extends sa{static canHandle(e,t){return 226===e.getUint8(t+1)&&1229144927===e.getUint32(t+4)}static findPosition(e,t){let i=super.findPosition(e,t);return i.chunkNumber=e.getUint8(t+16),i.chunkCount=e.getUint8(t+17),i.multiSegment=i.chunkCount>1,i}static handleMultiSegments(e){return function(e){let t=function(e){let t=e[0].constructor,i=0;for(let r of e)i+=r.length;let a=new t(i),s=0;for(let r of e)a.set(r,s),s+=r.length;return a}(e.map(e=>e.chunk.toUint8()));return new wi(t)}(e)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:e}=this;this.chunk.byteLength<84&&gi("ICC header is too short");for(let[t,i]of Object.entries(ps)){t=parseInt(t,10);let a=i(this.chunk,t);"\0\0\0\0"!==a&&e.set(t,a)}}parseTags(){let e,t,i,a,s,{raw:r}=this,n=this.chunk.getUint32(128),o=132,l=this.chunk.byteLength;for(;n--;){if(e=this.chunk.getString(o,4),t=this.chunk.getUint32(o+4),i=this.chunk.getUint32(o+8),a=this.chunk.getString(t,4),t+i>l)return;s=this.parseTag(a,t,i),void 0!==s&&"\0\0\0\0"!==s&&r.set(e,s),o+=12}}parseTag(e,t,i){switch(e){case"desc":return this.parseDesc(t);case"mluc":return this.parseMluc(t);case"text":return this.parseText(t,i);case"sig ":return this.parseSig(t)}if(!(t+i>this.chunk.byteLength))return this.chunk.getUint8Array(t,i)}parseDesc(e){let t=this.chunk.getUint32(e+8)-1;return fi(this.chunk.getString(e+12,t))}parseText(e,t){return fi(this.chunk.getString(e+8,t-8))}parseSig(e){return fi(this.chunk.getString(e+8,4))}parseMluc(e){let{chunk:t}=this,i=t.getUint32(e+8),a=t.getUint32(e+12),s=e+16,r=[];for(let n=0;n<i;n++){let i=t.getString(s+0,2),n=t.getString(s+2,2),o=t.getUint32(s+4),l=t.getUint32(s+8)+e,c=fi(t.getUnicodeString(l,o));r.push({lang:i,country:n,text:c}),s+=a}return 1===i?r[0].text:r}translateValue(e,t){return"string"==typeof e?t[e]||t[e.toLowerCase()]||e:t[e]||e}}di(us,"type","icc"),di(us,"multiSegment",!0),di(us,"headerLength",18);const ps={4:gs,8:function(e,t){return[e.getUint8(t),e.getUint8(t+1)>>4,e.getUint8(t+1)%16].map(e=>e.toString(10)).join(".")},12:gs,16:gs,20:gs,24:function(e,t){const i=e.getUint16(t),a=e.getUint16(t+2)-1,s=e.getUint16(t+4),r=e.getUint16(t+6),n=e.getUint16(t+8),o=e.getUint16(t+10);return new Date(Date.UTC(i,a,s,r,n,o))},36:gs,40:gs,48:gs,52:gs,64:(e,t)=>e.getUint32(t),80:gs};function gs(e,t){return fi(e.getString(t,4))}Ai.set("icc",us),$i(Fi,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);const fs={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},ms={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};$i(Ui,"icc",[[4,fs],[12,ms],[40,Object.assign({},fs,ms)],[48,fs],[80,fs],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);class bs extends sa{static canHandle(e,t,i){return 237===e.getUint8(t+1)&&"Photoshop"===e.getString(t+4,9)&&void 0!==this.containsIptc8bim(e,t,i)}static headerLength(e,t,i){let a,s=this.containsIptc8bim(e,t,i);if(void 0!==s)return a=e.getUint8(t+s+7),a%2!=0&&(a+=1),0===a&&(a=4),s+8+a}static containsIptc8bim(e,t,i){for(let a=0;a<i;a++)if(this.isIptcSegmentHead(e,t+a))return a}static isIptcSegmentHead(e,t){return 56===e.getUint8(t)&&943868237===e.getUint32(t)&&1028===e.getUint16(t+4)}parse(){let{raw:e}=this,t=this.chunk.byteLength-1,i=!1;for(let a=0;a<t;a++)if(28===this.chunk.getUint8(a)&&2===this.chunk.getUint8(a+1)){i=!0;let t=this.chunk.getUint16(a+3),s=this.chunk.getUint8(a+2),r=this.chunk.getLatin1String(a+5,t);e.set(s,this.pluralizeValue(e.get(s),r)),a+=4+t}else if(i)break;return this.translate(),this.output}pluralizeValue(e,t){return void 0!==e?e instanceof Array?(e.push(t),e):[e,t]:t}}di(bs,"type","iptc"),di(bs,"translateValues",!1),di(bs,"reviveValues",!1),Ai.set("iptc",bs),$i(Fi,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),$i(Ui,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);const ys=Object.freeze(Object.defineProperty({__proto__:null,Exifr:ea,Options:Xi,allFormatters:Gi,chunkedProps:Ri,createDictionary:$i,default:es,extendDictionary:Li,fetchUrlAsArrayBuffer:_i,fileParsers:Ci,fileReaders:ki,gps:ma,gpsOnlyOptions:fa,inheritables:Hi,orientation:xa,orientationOnlyOptions:wa,otherSegments:Ni,parse:ta,readBlobAsArrayBuffer:Mi,get rotateCanvas(){return Ca},get rotateCss(){return Aa},rotation:ka,rotations:Sa,segmentParsers:Ai,segments:Bi,segmentsAndBlocks:Vi,sidecar:async function(e,t,i){let a=new Xi(t);a.chunked=!1,void 0===i&&"string"==typeof e&&(i=function(e){let t=e.toLowerCase().split(".").pop();return"exif"===(i=t)||"tiff"===i||"tif"===i?"tiff":ts.includes(t)?t:void 0;var i}(e));let s=await Ii(e,a);if(i){if(ts.includes(i))return as(i,s,a);gi("Invalid segment type")}else{if(function(e){let t=e.getString(0,50).trim();return t.includes("<?xpacket")||t.includes("<x:")}(s))return as("xmp",s,a);for(let[e]of Ai){if(!ts.includes(e))continue;let t=await as(e,s,a).catch(is);if(t)return t}gi("Unknown file format")}},tagKeys:Fi,tagRevivers:Oi,tagValues:Ui,thumbnail:ya,thumbnailOnlyOptions:ba,thumbnailUrl:va,tiffBlocks:zi,tiffExtractables:ji},Symbol.toStringTag,{value:"Module"}));return e.AUDIO_EXTENSIONS=rt,e.BrowserStorage=xe,e.ContentParser=Fe,e.DOCUMENT_EXTENSIONS=st,e.FILTER_CONFIG=Be,e.IMAGE_EXTENSIONS=it,e.MEDIA_EXTENSIONS=nt,e.MediaLibrary=Zt,e.VIDEO_EXTENSIONS=at,e.applyFilter=ze,e.calculateFilteredMediaData=We,e.calculateFilteredMediaDataFromIndex=qe,e.clearProcessedDataCache=function(){Xe=null,Ye=null},e.copyImageToClipboard=gt,e.copyMediaToClipboard=ft,e.createElement=function(e,t={},i=void 0){const a=document.createElement(e);return t&&Object.entries(t).forEach(([e,t])=>{switch(e){case"className":a.className=t;break;case"dataset":Object.assign(a.dataset,t);break;case"textContent":a.textContent=t;break;case"innerHTML":a.innerHTML=t;break;case"style":"object"==typeof t?Object.assign(a.style,t):a.style.cssText=t;break;case"events":Object.entries(t).forEach(([e,t])=>{a.addEventListener(e,t)});break;default:a.setAttribute(e,t)}}),i&&(Array.isArray(i)?a.append(...i):i instanceof HTMLElement||i instanceof SVGElement?a.append(i):a.insertAdjacentHTML("beforeend",i)),a},e.createHash=function(e){let t=0;if(0===e.length)return t.toString(36).padStart(10,"0");for(let i=0;i<e.length;i+=1)t=(33*t+e.charCodeAt(i))%2147483647;return Math.abs(t).toString(36).padStart(10,"0")},e.createMediaLibrary=Jt,e.createSearchSuggestion=Ke,e.detectMediaTypeFromExtension=lt,e.extractFileExtension=ot,e.extractMediaLocation=function(e){try{const t=new URL(e);return{origin:t.origin,path:t.pathname,fullUrl:e}}catch(t){return{origin:"",path:e,fullUrl:e}}},e.extractRelativePath=function(e){if(!e)return e;const t=e.split("/").filter(Boolean);return t.length>=2?`/${t.slice(2).join("/")}`:e},e.formatFileSize=function(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/1024**t).toFixed(2))} ${["Bytes","KB","MB","GB"][t]}`},e.generateSearchSuggestions=Qe,e.getAvailableFilters=function(){return Object.keys(Be)},e.getCategoryFilters=Ve,e.getDisplayMediaType=function(e){if(e.type){if(e.type.includes(" > ")){const[t,i]=e.type.split(" > ");return`${{img:"IMAGE",video:"VIDEO","video-source":"VIDEO SOURCE",link:"LINK",background:"BACKGROUND"}[t]||t.toUpperCase()} (${i.toUpperCase()})`}return{img:"IMAGE",video:"VIDEO","video-source":"VIDEO SOURCE",link:"LINK",background:"BACKGROUND"}[e.type]||e.type.toUpperCase()}const t=ot(e.url||"");return it.includes(t)?"IMAGE":"mp4"===t?"VIDEO":"pdf"===t?"DOCUMENT":"UNKNOWN"},e.getDisplayName=function(e){if(!e)return"";const t=e.split("/").filter(Boolean);return t[t.length-1].replace(/\.[^/.]+$/,"")},e.getFileName=function(e){try{const t=new URL(e),{pathname:i}=t;return i.split("/").pop()||""}catch{return e.split("/").pop()||""}},e.getFilterCounts=function(e){return e&&e.filterCounts?e.filterCounts:{}},e.getFilteredItems=function(e,t){return e&&e.filterArrays?"all"===t?e.filterArrays.all||[]:t&&e.filterArrays[t]?e.filterArrays[t]:[]:[]},e.getGroupingKey=Ue,e.getItemByHash=function(e,t){return e&&Array.isArray(e)&&e.find(e=>e.hash===t)||null},e.getMediaType=ct,e.getSubtype=function(e){const t=e.type||"";if(!t.includes(" > "))return"";const[,i]=t.split(" > ");return i.toUpperCase()},e.getUsageData=function(e,t){if(!e||!e.usageData)return[];const i=Ue(t),a=e.usageData[i];return a&&a.hashes||[]},e.getVideoThumbnail=dt,e.groupUsagesByPath=function(e){const t=new Map;return e.forEach(e=>{const i=e.doc||"Unknown Document";t.has(i)||t.set(i,[]),t.get(i).push(e)}),Array.from(t.entries()).map(([e,t])=>({path:e,usages:t,count:t.length}))},e.i18n=fe,e.initializeMediaLibrary=Yt,e.initializeProcessedData=Je,e.isExternalVideoUrl=ht,e.isImage=mt,e.isMediaFile=function(e){let t=e;t&&t.startsWith(".")&&(t=t.substring(1));const i=null==t?void 0:t.toLowerCase();return nt.includes(i)},e.isPdf=function(e){return"pdf"===ot(e)},e.isSvgFile=function(e){const t=e.type||"";return"img > svg"===t||"link > svg"===t},e.isVideo=bt,e.normalizeUrl=ut,e.parseColonSyntax=je,e.processMediaData=Ze,e.processNewItems=async function(e,t,i=null){for(let s=0;s<e.length;s+=100)e.slice(s,s+100).forEach(e=>{if(e.hash){if(e.url){const i=Ue(e.url);if(t.usageData[i]||(t.usageData[i]={hashes:[],uniqueDocs:new Set,count:0}),!t.usageData[i].hashes.includes(e.hash)){t.usageData[i].hashes.push(e.hash),e.doc&&t.usageData[i].uniqueDocs.add(e.doc);const a=t.usageData[i];a.count=a.hashes.length}}et(e,t.searchIndex),tt(e,t.filterArrays),t.totalCount+=1}}),i&&i((s+100)/e.length*100),await new Promise(e=>{setTimeout(e,0)});var a;return a=t,Object.keys(a.filterArrays).forEach(e=>{a.filterCounts[e]=a.filterArrays[e].length}),t},e.searchProcessedData=function(e,t){if(!e||!e.searchIndex||!t)return[];const i=t.toLowerCase().trim(),a=new Set;return Object.keys(e.searchIndex).forEach(t=>{const s=e.searchIndex[t];Object.keys(s).forEach(e=>{e.includes(i)&&s[e].forEach(e=>a.add(e))})}),Array.from(a)},e.sortMediaData=function(e){return[...e].sort((e,t)=>{const i=new Date(e.lastUsedAt||0),a=new Date(t.lastUsedAt||0)-i;if(0!==a)return a;const s=(e.name||"").toLowerCase(),r=(t.name||"").toLowerCase();return s.localeCompare(r)})},e.updateUsageCounts=async function(e,t,i){if(!e||0===e.length)return;let a=0;for(let s=0;s<e.length;s+=100){const r=e.slice(s,s+100);for(const e of r){const{hash:i}=e;i&&(t.usageData[i]||(t.usageData[i]={count:0,urls:new Set,docs:new Set}),t.usageData[i].count+=1,e.url&&t.usageData[i].urls.add(e.url),e.doc&&t.usageData[i].docs.add(e.doc))}a+=r.length,i&&i(a/e.length*100),s+100<e.length&&await new Promise(e=>{setTimeout(e,1)})}},e.urlsMatch=pt,e.waitForMediaLibraryReady=Xt,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),e}({});
